(this.webpackJsonp=this.webpackJsonp||[]).push([[104],{3085:function(e,t,n){"use strict";n.d(t,"a",(function(){return v.a}));var a=n(41),s=n(289),i=n(32),r=n(3),o=n.n(r),c=n(179),l=n(10),u=n.n(l),d=n(1),f=n(57),b=n(429),j=n(73),h=n(43),m=n(39),O=n(125),g=n(20),p=n(115),w=n(14),_=n(178),v=n(653),x=n(757),y=n(103),M=n(162),k=n(770),A=n.n(k),E=n(652),S=n(3104),P=n(332),C=n(1166),L=n(0),I=function(e){var t=e.onOk,n=e.hideTitle,s=e.placeCenter,r=Object(b.a)(),c=Object(d.useRef)(),l=Object(m.e)((function(e){return e.settings.enableLocalAuthentication})),u=Object(E.a)({mode:"onBlur",reValidateMode:"onBlur",defaultValues:{password:""}}),f=u.control,j=u.handleSubmit,O=u.setError,g=Object(S.a)({useFormReturn:u,revalidate:!1,clearErrorIfEmpty:!0}).formValues,w=j(function(){var e=o()((function*(e){(yield h.a.serviceApp.verifyPassword(e.password))?null==t||t(e.password,!1):O("password",{message:r.formatMessage({id:"msg__wrong_password"})})}));return function(t){return e.apply(this,arguments)}}()),_=Object(d.useMemo)((function(){return A()(w,1e3,{trailing:!1})}),[w]),v=Object(d.useCallback)((function(e){null==t||t(e,!0)}),[t]);Object(d.useEffect)((function(){l?Object(P.b)().then((function(e){e||setTimeout((function(){var e;return null==(e=c.current)?void 0:e.focus()}),100)})):setTimeout((function(){var e;return null==(e=c.current)?void 0:e.focus()}),100)}),[]);var k=Object(d.useMemo)((function(){return Object(L.jsxs)(L.Fragment,{children:[n?null:Object(L.jsxs)(i.a,{mb:"8",children:[Object(L.jsx)(a.h.DisplayLarge,{textAlign:"center",mb:2,children:r.formatMessage({id:"Verify_Password"})}),Object(L.jsx)(a.h.Body1,{textAlign:"center",color:"text-subdued",children:r.formatMessage({id:"Verify_password_to_continue"})})]}),Object(L.jsxs)(M.a,{children:[Object(L.jsx)(M.a.Item,{name:"password",defaultValue:"",control:f,rules:{minLength:{value:8,message:r.formatMessage({id:"msg__password_validation"})},maxLength:{value:128,message:r.formatMessage({id:"msg__password_validation"})}},children:Object(L.jsx)(M.a.PasswordInput,{ref:c,onSubmitEditing:w})}),Object(L.jsx)(y.a,{isDisabled:!(null!=g&&g.password),type:"primary",size:"xl",onPress:_,children:r.formatMessage({id:"action__continue",defaultMessage:"Continue"})})]}),Object(L.jsx)(p.a,{mt:"8",children:Object(L.jsx)(C.a,{onOk:v})})]})}),[f,null==g?void 0:g.password,n,r,v,w,_]);return s?Object(L.jsx)(x.a,{px:{base:n?0:4,md:0},children:Object(L.jsx)(p.a,{testID:"Validation",w:"full",h:"full",bg:"background-default",children:Object(L.jsx)(i.a,{maxW:"96",w:"full",h:"full",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:k})})}):Object(L.jsx)(x.a,{px:{base:n?0:4,md:0},children:k})},T=function(e){var t=e.field,n=e.onOk,a=e.hideTitle,i=e.placeCenter,r=Object(d.useState)(!1),c=u()(r,2),l=c[0],f=c[1],b=Object(d.useState)(!1),j=u()(b,2),m=j[0],O=j[1],g=Object(d.useState)(),x=u()(g,2),y=x[0],M=x[1],k=Object(_.h)((function(e){return e.settings.validationSetting})),A=Object(d.useMemo)((function(){var e=!!t&&!(null==k||!k[t]);return!(!t||t!==v.a.Secret)||e}),[k,t]);Object(d.useEffect)((function(){function e(){return(e=o()((function*(){var e=yield h.a.servicePassword.getPassword();e&&(O(!0),w.a.isNative?setTimeout((function(){return null==n?void 0:n(e,!1)}),500):null==n||n(e,!1)),M(!!e),f(!0)}))).apply(this,arguments)}A||function(){e.apply(this,arguments)}()}),[]);var E=Object(d.useCallback)(function(){var e=o()((function*(e,t){O(!0),yield h.a.servicePassword.savePassword(e),null==n||n(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),[n]);if(!m){if(A)return Object(L.jsx)(I,{onOk:E,hideTitle:a,placeCenter:i});if(l&&!y)return Object(L.jsx)(I,{onOk:E,hideTitle:a,placeCenter:i})}return Object(L.jsx)(p.a,{w:"full",h:"full",children:Object(L.jsx)(s.b,{size:"lg"})})},V=function(e){var t=e.onOk,n=e.skipSavePassword,s=e.hideTitle,r=e.isAutoHeight,l=Object(b.a)(),u=Object(_.l)().isOk,f=Object(_.h)((function(e){return e.status.boardingCompleted})),j=Object(_.h)((function(e){return e.status.authenticationType})),m=Object(E.a)({mode:"onBlur",reValidateMode:"onBlur",defaultValues:{password:"",confirmPassword:""}}),O=m.control,g=m.handleSubmit,p=m.getValues,w=Object(S.a)({useFormReturn:m,revalidate:!1,clearErrorIfEmpty:!0}).formValues,v=Object(d.useMemo)((function(){return!(null!=w&&w.password)||!(null!=w&&w.confirmPassword)}),[null==w?void 0:w.confirmPassword,null==w?void 0:w.password]),k=Object(d.useCallback)(function(){var e=o()((function*(e){e.password===e.confirmPassword?(f&&!n&&(yield h.a.serviceApp.updatePassword("",e.password)),null==t||t(e.password,e.withEnableAuthentication)):c.a.show({title:l.formatMessage({id:"msg__password_needs_to_be_the_same"})},{type:"error"})}));return function(t){return e.apply(this,arguments)}}(),[f,n,t,l]),A="FACIAL"===j?l.formatMessage({id:"content__face_id"}):l.formatMessage({id:"content__touch_id"});return Object(L.jsxs)(x.a,{h:r?{base:"full",sm:"auto"}:"full",px:{base:s?0:4,md:0},children:[s?null:Object(L.jsxs)(i.a,{mb:"8",children:[Object(L.jsxs)(a.h.DisplayLarge,{textAlign:"center",mb:2,children:["\ud83d\udd10"," ",l.formatMessage({id:"title__set_password",defaultMessage:"Set Password"})]}),Object(L.jsx)(a.h.Body1,{textAlign:"center",color:"text-subdued",children:l.formatMessage({id:"Only_you_can_unlock_your_wallet",defaultMessage:"Only you can unlock your wallet"})})]}),Object(L.jsxs)(M.a,{children:[Object(L.jsx)(M.a.Item,{name:"password",defaultValue:"",control:O,rules:{minLength:{value:8,message:l.formatMessage({id:"msg__password_validation"})},maxLength:{value:128,message:l.formatMessage({id:"msg__password_validation"})},validate:function(e){var t=p("confirmPassword");if(t&&e)return t!==e?l.formatMessage({id:"msg__password_needs_to_be_the_same"}):void 0}},children:Object(L.jsx)(M.a.PasswordInput,{autoFocus:!0,onSubmitEditing:g(k),placeholder:l.formatMessage({id:"form__rule_at_least_int_digits"},{0:8})})}),Object(L.jsx)(M.a.Item,{name:"confirmPassword",defaultValue:"",control:O,rules:{minLength:{value:8,message:l.formatMessage({id:"msg__password_validation"})},validate:function(e){var t=p("password");if(t&&e)return t!==e?l.formatMessage({id:"msg__password_needs_to_be_the_same"}):void 0}},children:Object(L.jsx)(M.a.PasswordInput,{onSubmitEditing:g(k),placeholder:l.formatMessage({id:"Confirm_password"})})}),u?Object(L.jsx)(M.a.Item,{name:"withEnableAuthentication",defaultValue:u,control:O,children:Object(L.jsx)(M.a.CheckBox,{title:l.formatMessage({id:"content__authentication_with"},{0:A})})}):null,Object(L.jsx)(y.a,{type:"primary",size:"xl",onPress:g(k),isDisabled:v,children:l.formatMessage({id:"action__continue",defaultMessage:"Continue"})})]})]})};t.b=Object(d.memo)((function(e){var t=e.children,n=e.skipSavePassword,r=e.field,l=e.walletId,p=e.hideTitle,w=e.isAutoHeight,_=e.placeCenter,v=Object(f.u)(),x=Object(m.i)(l),y=Object(b.a)(),M=h.a.engine,k=h.a.serviceHardware,A=h.a.serviceApp,E=Object(d.useState)(),S=u()(E,2),P=S[0],C=S[1],I=Object(d.useState)(""),B=u()(I,2),D=B[0],F=B[1],W=Object(d.useState)(),R=u()(W,2),z=R[0],H=R[1],G=Object(d.useState)(),J=u()(G,2),N=J[0],U=J[1],K=Object(m.g)().isPasswordSet,q=Object(d.useState)(K),Q=u()(q,1)[0],X=Object(d.useCallback)((function(e,t){U(t),F(e)}),[]),Y=Object(d.useCallback)((function(e,t){H(t),F(e)}),[]),Z=Object(d.useCallback)((function(){null!=v&&null!=v.canGoBack&&v.canGoBack()&&v.goBack()}),[v]),$="hw"===(null==x?void 0:x.type),ee=(null==x?void 0:x.type)===j.a;return Object(d.useEffect)((function(){A.checkUpdateStatus()}),[]),Object(d.useEffect)((function(){function e(){c.a.show({title:y.formatMessage({id:"action__connection_timeout"})}),Z()}function t(){return(t=o()((function*(){if(null!=x&&x.id){var t=yield M.getHWDeviceByWalletId(x.id);if(t){var n=null;try{var a=yield k.getFeatursByWalletId(x.id);a?(n=a,g.a.hardwareSDK.debug("use features cache: ",a)):n=yield k.getFeatures(t.mac)}catch(s){return Z(),void O.a.showErrorToast(s)}if(!n)return c.a.show({title:y.formatMessage({id:"action__connection_timeout"})}),void Z();C(n)}else e()}else e()}))).apply(this,arguments)}$&&function(){t.apply(this,arguments)}()}),[$,M,null==x?void 0:x.id,y,Z,k]),ee?Object(L.jsx)(i.a,{flex:1,children:t(D,{withEnableAuthentication:z,isLocalAuthentication:N})}):D?Object(L.jsx)(i.a,{w:"full",h:"full",children:t(D,{withEnableAuthentication:z,isLocalAuthentication:N})}):$?P?Object(L.jsx)(i.a,{w:"full",h:"full",children:t(D,{withEnableAuthentication:z,isLocalAuthentication:N,deviceFeatures:P})}):Object(L.jsxs)(i.a,{h:"100%",justifyContent:"center",alignItems:"center",children:[Object(L.jsx)(s.b,{size:"lg"}),Object(L.jsx)(a.h.DisplayMedium,{mt:6,children:y.formatMessage({id:"modal__device_status_check"})})]}):Q?Object(L.jsx)(T,{onOk:X,field:r,hideTitle:p,placeCenter:_}):Object(L.jsx)(V,{onOk:Y,skipSavePassword:n,hideTitle:p,isAutoHeight:w})}))},3104:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(185),s=n.n(a),i=n(10),r=n.n(i),o=n(1),c=n(1170);function l(e){var t=e.useFormReturn,n=e.wait,a=void 0===n?500:n,i=e.revalidate,l=void 0===i||i,u=e.clearErrorIfEmpty,d=void 0!==u&&u,f=e.clearErrorWhenTextChange,b=void 0!==f&&f,j=e.onChange,h=t.watch,m=t.trigger,O=t.formState,g=t.clearErrors,p=t.getValues,w=Object(o.useRef)(!1),_=Object(o.useState)(),v=r()(_,2),x=v[0],y=v[1];Object(o.useEffect)((function(){var e=p();y(e),setTimeout((function(){return m()}),0)}),[p,m]),Object(o.useEffect)((function(){var e=s()((function(e,t){var n=t.name,a=t.type;w.current=!1,"change"!==a&&void 0!==a||(y(e),j&&j(e,{name:n,type:a}),d&&""===(null==e?void 0:e[n])&&g(n),l&&m(n))}),a,{leading:!1,trailing:!0}),t=h((function(t,n){var a=n.name,s=n.type;w.current=!0,b&&g(a),e(t,{name:a,type:s})}));return function(){return t.unsubscribe()}}),[d,b,g,j,l,m,a,h]);var M=Object(c.a)(O.isValid&&!Object.keys(O.errors).length&&!O.isValidating,100);return{loadingRef:w,isLoading:w.current,formValues:x,isValid:M}}},3197:function(e,t,n){"use strict";n.r(t),n.d(t,"EnableLocalAuthenticationRoutes",(function(){return a}));var a,s=n(100),i=n(252),r=n(115),o=n(289),c=n(179),l=n(3),u=n.n(l),d=n(1),f=n(57),b=n(429),j=n(43),h=n(3085),m=n(39),O=n(1191),g=n(80),p=n(0),w=function(e){var t=e.password,n=e.isLocalAuthentication,a=j.a.dispatch,s=Object(b.a)(),i=Object(m.m)().enableLocalAuthentication,l=Object(O.a)(),h=l.localAuthenticate,w=l.savePassword,_=Object(f.u)();return Object(d.useEffect)((function(){function e(){return(e=u()((function*(){if(!i&&!n){var e=yield h();if(!e.success)return e.error.includes("cancelled")||c.a.show({title:s.formatMessage({id:"msg__verification_failure"})},{type:"error"}),void setTimeout((function(){null==_||null==_.goBack||_.goBack()}),1e3)}w(i?"":t),a(Object(g.U)()),setTimeout((function(){null==_||null==_.goBack||_.goBack()}),1e3)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(p.jsx)(r.a,{h:"full",w:"full",children:Object(p.jsx)(o.b,{size:"lg"})})},_=function(){return Object(p.jsx)(i.b,{footer:null,children:Object(p.jsx)(h.b,{walletId:null,children:function(e,t){var n=t.isLocalAuthentication;return Object(p.jsx)(w,{password:e,isLocalAuthentication:n})}})})};!function(e){e.EnableLocalAuthenticationModal="EnableLocalAuthenticationModal",e.EnableWebAuthn="EnableWebAuthn"}(a||(a={}));var v=n(20),x=n(969),y=function(){var e=Object(b.a)(),t=Object(m.e)((function(e){return e.settings.enableWebAuthn})),n=Object(f.u)();return Object(d.useEffect)((function(){function a(){return(a=u()((function*(){try{t?Object(x.a)():yield Object(x.b)(),c.a.show({title:e.formatMessage({id:"msg__success"})})}catch(a){v.a.common.error(a.message),a.message.includes("The operation either timed out or was not allowed")||c.a.show({title:e.formatMessage({id:"msg__unknown_error"})})}setTimeout((function(){null==n||null==n.goBack||n.goBack()}),1e3)}))).apply(this,arguments)}!function(){a.apply(this,arguments)}()}),[]),Object(p.jsx)(r.a,{h:"full",w:"full",children:Object(p.jsx)(o.b,{size:"lg"})})},M=function(){return Object(p.jsx)(i.b,{footer:null,children:Object(p.jsx)(h.b,{walletId:null,children:function(e){return Object(p.jsx)(y,{password:e})}})})},k=n(456),A=Object(k.a)(),E=[{name:a.EnableLocalAuthenticationModal,component:_},{name:a.EnableWebAuthn,component:M}];t.default=function(){var e=Object(s.a)();return Object(p.jsx)(A.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:E.map((function(e){return Object(p.jsx)(A.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);