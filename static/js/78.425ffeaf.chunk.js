(this.webpackJsonp=this.webpackJsonp||[]).push([[78],{3071:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(3),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(12),d=n.n(s),l=n(5),f=n.n(l);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var y=function(e){u()(n,e);var t=p(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=i()((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),a()(n)}(n(1147).a);!function(e){u()(n,e);var t=p(n);function n(){return t.apply(this,arguments)}a()(n)}(y)},3077:function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var r=n(10),i=n.n(r),o=n(2),a=n.n(o),c=n(3),u=n.n(c),s=n(6),d=n.n(s),l=n(9),f=n.n(l),p=n(12),y=n.n(p),h=n(5),v=n.n(h),g=n(20),w=n(19);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var x=function(e){f()(n,e);var t=T(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=u()((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new w.q("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return g.a.engine.info("signTransaction",this.networkId,e),b(b({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=u()((function*(e,t){var n=this,r=t.password;if("undefined"===typeof r)throw new w.q("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(r,[o.address])),c=i()(a,1)[0];return g.a.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,c)})))}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},d()(n)}(n(3071).a)},3093:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return S}));var r=n(2),i=n.n(r),o=n(146),a=n.n(o),c=n(3),u=n.n(c),s=n(6),d=n.n(s),l=n(9),f=n.n(l),p=n(12),y=n.n(p),h=n(5),v=n.n(h),g=n(26),w=n.n(g),m=n(11),b=n(20),T=n(14),x=n(53),O=n(19),A=n(184),I=n(658),P=n(56),E=n(1147);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}if(T.a.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var S=function(t){f()(r,t);var n=j(r);function r(){return n.apply(this,arguments)}var i=r.prototype;return i.init=function(){var e=u()((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),i.initKeyring=function(){var e=u()((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=u()((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),i.signAndSendTransaction=function(){var e=u()((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?k(k({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(k(k({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=u()((function*(e,t){b.a.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return b.a.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),k(k({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),i.buildEncodedTxFromBatchTransfer=function(){var e=u()((function*(e,t,n){throw new O.l}));return function(t,n,r){return e.apply(this,arguments)}}(),i.buildEncodedTxsFromSetApproveForAll=function(){var e=u()((function*(e,t){throw new O.l}));return function(t,n){return e.apply(this,arguments)}}(),i.activateAccount=function(){var e=u()((function*(){throw new O.l}));return function(){return e.apply(this,arguments)}}(),i.activateToken=function(){var e=u()((function*(e,t){throw new O.l}));return function(t,n){return e.apply(this,arguments)}}(),i.getTokenAllowance=function(){var e=u()((function*(e,t){throw new O.l}));return function(t,n){return e.apply(this,arguments)}}(),i.batchTokensAllowance=function(){var e=u()((function*(e,t){throw new O.l}));return function(t,n){return e.apply(this,arguments)}}(),i.getOutputAccount=function(){var e=u()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address}}));return function(){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=u()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=yield this.getDbAccount(),i=r.address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),n)}));return function(t){return e.apply(this,arguments)}}(),i.updatePendingTxs=function(){var e=u()((function*(e){throw new O.l}));return function(t){return e.apply(this,arguments)}}(),i.getAccountNonce=function(){var e=u()((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=u()((function*(e){var t,n,r,i,o=e.action,a=e.accountAddress;(o.direction=P.b.OTHER,o.type===P.a.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(n=o.nativeTransfer)?void 0:n.to)||"",address:a}));o.type===P.a.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),i.fixDecodedTx=function(){var e=u()((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=a()(r)?e.nonce:new w.a(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var c=e.actions[o];yield this.fixActionDirection({action:c,accountAddress:i})}if(e.outputActions)for(var u=0;u<e.outputActions.length;u+=1){var s=e.outputActions[u];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),i.fixHistoryTx=function(){var e=u()((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),T.a.isDev&&T.a.isDesktop&&Object.assign(e,{_tmpCreatedAtText:new Date(e.decodedTx.createdAt||0).toLocaleString(),_tmpUpdatedAtText:new Date(e.decodedTx.updatedAt||0).toLocaleString(),_tmpStatus:e.decodedTx.status,_tmpIsFinal:e.decodedTx.isFinal}),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),i.buildHistoryTx=function(){var e=u()((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var c=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=c,i&&(n.signer=c),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var u=k(k({id:this.networkId+"_"+a+"_"+this.accountId,isLocalCreated:Boolean(o)},t),{},{decodedTx:n});return u=yield this.fixHistoryTx(u),Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),i.checkIsScamHistoryTx=function(){var e=u()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=u()((function*(e){throw new O.l}));return function(t){return e.apply(this,arguments)}}(),i.fixAddressCase=function(e){return Promise.resolve(e)},i.buildTxActionDirection=function(){var e=u()((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?P.b.SELF:t&&t===r?P.b.OUT:n&&n===r?P.b.IN:P.b.OTHER}));return function(t){return e.apply(this,arguments)}}(),i.getNextNonce=function(){var e=u()((function*(e,t){var n,r,i=null!=(n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce)?n:0,o=(yield this.engine.getHistory(e,t.id,void 0,!1),yield x.a.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),c=yield x.a.history.getPendingNonceList({accountId:this.accountId,networkId:e}),u=Math.max(a()(o)?0:o+1,i);if(Number.isNaN(u)&&(u=i),u>i)for(var s=i;s<u;s+=1)if(!c.includes(s)){u=s;break}if(u<i&&(u=i),u-i>=m.y.PENDING_QUEUE_MAX_LENGTH)throw new O.v(m.y.PENDING_QUEUE_MAX_LENGTH);return u}));return function(t,n){return e.apply(this,arguments)}}(),i.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},i.notifyChainChanged=function(e,t){},i.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},i.getPrivateKeyByCredential=function(t){return Promise.resolve(e.from(t.startsWith("0x")?t.slice(2):t,"hex"))},i.getMinDepositAmount=function(){var e=u()((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),i.specialCheckEncodedTx=function(){var e=u()((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),d()(r)}(function(e){f()(n,e);var t=j(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=u()((function*(){var e=(yield this.getNetwork()).impl;a()(I.a[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=u()((function*(e){throw new O.l}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new O.l},r.getEthersProvider=function(){var e=u()((function*(){throw new O.l}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=u()((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=u()((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new O.f;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=u()((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=u()((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new O.i;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=u()((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=u()((function*(e){return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=u()((function*(e,t){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:k({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=u()((function*(e){return 0}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=u()((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=u()((function*(){var e=yield this.getNetwork();return Object(A.a)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=u()((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=u()((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=u()((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=u()((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),d()(n)}(E.a))}).call(this,n(22).Buffer)},3094:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var r=n(3),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(12),d=n.n(s),l=n(5),f=n.n(l),p=n(309),y=n(253);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var v=function(t){u()(r,t);var n=h(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getHardwareInfo=function(){var e=i()((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),o.getWalletPassphraseState=function(){var e=i()((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!Object(y.g)(e)}}));return function(){return e.apply(this,arguments)}}(),o.getHardwareSDKInstance=function(){var t=i()((function*(){var t,n,r,i,o;return null!=(o=yield null==(t=e)||null==(n=t.$backgroundApiProxy)||null==(r=n.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:p.b}));return function(){return t.apply(this,arguments)}}(),a()(r)}(n(3071).a)}).call(this,n(40))},3095:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(2),i=n.n(r),o=n(3),a=n.n(o),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(12),f=n.n(l),p=n(5),y=n.n(p),h=n(428),v=n(19);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var b=function(e){d()(n,e);var t=m(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=a()((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],i=n.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new v.q("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return Object(h.c)(a,o,e,i,r).reduce((function(e,t){var n;return w(w({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},u()(n)}(n(3077).a)},3096:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(3),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(12),d=n.n(s),l=n(5),f=n.n(l),p=n(19);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=i()((function*(e,t){if("undefined"!==typeof t)throw new p.l("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new p.q("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},a()(n)}(n(3077).a)},3097:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(3),i=n.n(r),o=n(6),a=n.n(o),c=n(9),u=n.n(c),s=n(12),d=n.n(s),l=n(5),f=n.n(l),p=n(19);function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var h=function(e){u()(n,e);var t=y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=i()((function*(e,t){throw new p.q("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=i()((function*(e,t){throw new p.q("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},a()(n)}(n(3071).a)},3098:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(42),i=n(70),o=n(20),a=n(14);function c(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.h({message:t}):t.includes("Bridge network error")?new i.e({message:t}):null}function u(e){var t,n=e||{},u=n.code,s=n.error,d=n.message,l=null!=(t=null!=s?s:d)?t:"Unknown error";if(c(u,l))return c(u,l);switch(o.a.hardwareSDK.info("Device Utils Convert Device Error:",u,l),u){case r.HardwareErrorCode.UnknownError:return new i.H(e);case r.HardwareErrorCode.DeviceFwException:return new i.t(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof l&&-1!==l.indexOf("ui-device_bootloader_mode")?new i.E(e):new i.H(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.m(e);case r.HardwareErrorCode.DeviceNotFound:return new i.k(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.E(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.K(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.F(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.v(e);case r.HardwareErrorCode.IframeTimeout:return new i.w(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.p(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.s(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.q(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.r(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.t(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.D(e);case r.HardwareErrorCode.NetworkError:return new i.C(e);case r.HardwareErrorCode.BlePermissionError:return new i.A(e);case r.HardwareErrorCode.BleLocationError:return new i.z({message:l});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.b({message:l});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.j(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.d(e);case r.HardwareErrorCode.BleScanError:return new i.c({message:l});case r.HardwareErrorCode.BleAlreadyConnected:return new i.a(e);case r.HardwareErrorCode.RuntimeError:return-1!==l.indexOf("EIP712 blind sign is disabled")?new i.G(e):-1!==l.indexOf("Unknown message")||-1!==l.indexOf("Failure_UnexpectedMessage")?new i.I(e):new i.H(e);case r.HardwareErrorCode.PinInvalid:return new i.x(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.y(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.n(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.l(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.J(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.i.NeedOneKeyBridge:return new i.B(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.e(e);case r.HardwareErrorCode.BridgeTimeoutError:return a.a.isDesktop&&(o.a.hardwareSDK.debug("desktop bridge timeout, restart desktop bridge."),window.desktopApi.reloadBridgeProcess()),new i.f(e);case r.HardwareErrorCode.PollingTimeout:return new i.h(e);case r.HardwareErrorCode.PollingStop:return new i.g(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.G(e);default:return new i.H(e)}}},4309:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return C}));var r=n(10),i=n.n(r),o=n(3),a=n.n(o),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(12),f=n.n(l),p=n(5),y=n.n(p),h=n(92),v=n(227),g=n(428),w=n(11),m=n(20),b=n(19),T=n(950),x=n(89),O=n(3095),A=n(293),I=n(609);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var E="m/44'/"+w.f+"'",C=function(t){d()(r,t);var n=P(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getSigners=function(){var e=a()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new b.q("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new b.q("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new b.q("Unable to get signer.");return(n={})[r.address]=new T.b(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=a()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=Object(g.d)("ed25519",i,t,E,n.map((function(e){return e.toString()+"'/0'/0'"})));if(o.length!==n.length)throw new b.q("Unable to get publick key.");var a=[],c=0;for(var u of o){var s=u.path,d=u.extendedKey.key,l=d.toString("hex"),f=v.sha3_256.create();f.update(d),f.update("\0");var p=Object(A.a)(f.hex()),y=(r||[])[c]||"APT #"+(n[c]+1);a.push({id:this.walletId+"--"+s,name:y,type:x.b.SIMPLE,path:s,coinType:w.f,pub:l,address:p}),c+=1}return a}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=a()((function*(e,t){var n,r;m.a.common.info("signTransaction result",e);var i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new h.AptosClient(o),c=(yield this.getSigners(t.password||"",[i.address]))[i.address],u=null==(n=e.inputs)||null==(r=n[0])?void 0:r.publicKey;if(!u)throw new b.q("Unable to get sender public key.");var s=yield Object(I.o)(a,e);return Object(I.u)(c,u,s)}));return function(t,n){return e.apply(this,arguments)}}(),o.signMessage=function(){var t=a()((function*(t,n){var r=yield this.getDbAccount(),o=(yield this.getSigners(n.password||"",[r.address]))[r.address];return Promise.all(t.map(function(){var t=a()((function*(t){var n=JSON.parse(t.message).fullMessage,r=yield o.sign(e.from(n)),a=i()(r,1)[0];return Object(A.a)(a.toString("hex"))}));return function(e){return t.apply(this,arguments)}}()))}));return function(e,n){return t.apply(this,arguments)}}(),u()(r)}(O.a)}).call(this,n(22).Buffer)},4310:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return P}));var r=n(10),i=n.n(r),o=n(3),a=n.n(o),c=n(6),u=n.n(c),s=n(9),d=n.n(s),l=n(12),f=n.n(l),p=n(5),y=n.n(p),h=n(92),v=n(227),g=n(514),w=n(11),m=n(19),b=n(950),T=n(89),x=n(3096),O=n(293),A=n(609);function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var P=function(t){d()(r,t);var n=I(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.getSigners=function(){var e=a()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new m.q("Starcoin signers number should be 1.");if(t[0]!==r.address)throw new m.q("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new m.q("Unable to get signer.");return(n={})[r.address]=new b.b(i,e,"ed25519"),n}));return function(t,n){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=a()((function*(e){var t=e.privateKey,n=e.name;if(32!==t.length)throw new m.q("Invalid private key.");var r=g.a.publicFromPrivate(t),i=r.toString("hex"),o=v.sha3_256.create();o.update(r),o.update("\0");var a=Object(O.a)(o.hex());return Promise.resolve([{id:"imported--"+w.f+"--"+i,name:n||"",type:T.b.SIMPLE,path:"",coinType:w.f,pub:i,address:a}])}));return function(t){return e.apply(this,arguments)}}(),o.signTransaction=function(){var e=a()((function*(e,t){var n,r,i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new h.AptosClient(o),c=yield this.getSigners(t.password||"",[i.address]),u=null==(n=e.inputs)||null==(r=n[0])?void 0:r.publicKey;if(!u)throw new m.q("Unable to get sender public key.");var s=c[i.address],d=yield Object(A.o)(a,e);return Object(A.u)(s,u,d)}));return function(t,n){return e.apply(this,arguments)}}(),o.signMessage=function(){var t=a()((function*(t,n){var r=yield this.getDbAccount(),o=(yield this.getSigners(n.password||"",[r.address]))[r.address];return Promise.all(t.map(function(){var t=a()((function*(t){var n=yield o.sign(e.from(t));return i()(n,1)[0].toString("hex")}));return function(e){return t.apply(this,arguments)}}()))}));return function(e,n){return t.apply(this,arguments)}}(),u()(r)}(x.a)}).call(this,n(22).Buffer)},5687:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return ue}));var r=n(15),i=n.n(r),o=n(430),a=n.n(o),c=n(2),u=n.n(c),s=n(10),d=n.n(s),l=n(789),f=n.n(l),p=n(146),y=n.n(p),h=n(158),v=n.n(h),g=n(3),w=n.n(g),m=n(6),b=n.n(m),T=n(9),x=n.n(T),O=n(12),A=n.n(O),I=n(5),P=n.n(I),E=n(59),C=n(92),k=n(26),j=n.n(k),S=n(126),D=n.n(S),B=n(117),R=n(136),_=n(47),N=n(759),H=n(20),F=n(19),U=n(56),K=n(465),M=n(293),L=n(3093),q=n(3098),W=n(11),z=n(89),G=n(3094),V=n(609);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P()(e);if(t){var i=P()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var $="m/44'/"+W.f+"'",Z=function(e){x()(n,e);var t=X(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPublicKey=function(){var e=w()((function*(e,t,n){var r,i=yield this.getHardwareSDKInstance(),o=yield this.getWalletPassphraseState();try{r=yield i.aptosGetPublicKey(e,t,Q({bundle:n.map((function(e){return{path:e}}))},o))}catch(a){throw H.a.common.error(a),new F.p(a)}if(!r.success)throw H.a.common.error(r.payload),Object(q.a)(r.payload);return r.payload.map((function(e){return e.publicKey})).filter((function(e){return!!e}))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=w()((function*(e){var t,n=e.type,r=e.indexes,i=e.names,o=r.map((function(e){return $+"/"+e+"'/0'/0'"})),a="SEARCH_ACCOUNTS"===n,c=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),s=u.connectId,d=u.deviceId,l=yield this.getWalletPassphraseState();try{t=yield c.aptosGetAddress(s,d,Q({bundle:o.map((function(e){return{path:e,showOnOneKey:!1}}))},l))}catch(x){throw H.a.common.error(x),new F.p(x)}if(!t.success)throw H.a.common.error(t.payload),Object(q.a)(t.payload);var f,p,y=[];a||(!(null==(f=t.payload)||null==(p=f[0])||!p.publicKey)||(y=yield this.getPublicKey(s,d,o)));var h=[],v=0;for(var g of t.payload){var w=g.address,m=g.path,b=g.publicKey;if(w){var T=(i||[])[v]||"APT #"+(r[v]+1);h.push({id:this.walletId+"--"+m,name:T,type:z.b.SIMPLE,path:m,coinType:W.f,pub:null!=b?b:y[v]||"",address:Object(M.a)(w)}),v+=1}}return h}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=w()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield n.aptosGetAddress(i,o,Q({path:e.path,showOnOneKey:e.showOnOneKey},a));if(c.success&&null!=(t=c.payload)&&t.address)return c.payload.address.toLowerCase();throw Object(q.a)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=w()((function*(e,t){H.a.common.info("signTransaction",e);var n=yield this.getDbAccount(),r=(yield this.engine.getNetwork(this.networkId)).rpcURL,i=new C.AptosClient(r),o=yield Object(V.o)(i,e),a=new C.BCS.Serializer;o.serialize(a);var c=yield this.getHardwareInfo(),u=c.connectId,s=c.deviceId,d=yield this.getWalletPassphraseState(),l=yield this.getHardwareSDKInstance(),f=yield l.aptosSignTransaction(u,s,Q({path:n.path,rawTx:Object(E.bytesToHex)(a.getBytes())},d));if(f.success){var p=f.payload,y=p.signature,h=p.public_key;return Object(V.h)(o,h,y)}throw Object(q.a)(f.payload)}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=w()((function*(e,t){H.a.common.info("signMessage",e);var n=yield this.getDbAccount(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),c=yield this.getHardwareSDKInstance();return Promise.all(e.map(function(){var e=w()((function*(e){var t,r,u=JSON.parse(e.message),s=yield c.aptosSignMessage(i,o,Q({path:n.path,payload:{message:u.message,address:u.address,application:u.application,chainId:null==u||null==(t=u.chainId)?void 0:t.toString(),nonce:null==u||null==(r=u.nonce)?void 0:r.toString()}},a));if(!s.success)throw Object(q.a)(s.payload);return Object(M.a)(s.payload.signature)}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,n){return e.apply(this,arguments)}}(),b()(n)}(G.a),Y=n(4309),ee=n(4310);function te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P()(e);if(t){var i=P()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var ne=function(e){x()(n,e);var t=te(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=w()((function*(e){var t=e.name,n=e.target,r=e.accountIdPrefix,i=yield this.vault.validateAddress(n);if("undefined"===typeof i)throw new F.f;return Promise.resolve([{id:r+"--"+W.f+"--"+n,name:t||"",type:z.b.SIMPLE,path:"",coinType:W.f,pub:"",address:i}])}));return function(t){return e.apply(this,arguments)}}(),b()(n)}(n(3097).a),re=n(2101),ie=["max_gas_amount"];function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P()(e);if(t){var i=P()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return A()(this,n)}}var ue=function(e){x()(n,e);var t=ce(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:Y.a,hw:Z,imported:ee.a,watching:ne,external:ne},e.settings=re.default,e.getClientCache=D()(function(){var t=w()((function*(t){return e.getAptosClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(_.b)({minute:3})}),e}var r=n.prototype;return r.getClient=function(){var e=w()((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),r.getAptosClient=function(e){return new C.AptosClient(e)},r.getClientEndpointStatus=function(){var e=w()((function*(e){var t=yield this.getClientCache(e),n=performance.now(),r=(yield t.getLedgerInfo()).block_height,i=parseInt(r);return{responseTime:Math.floor(performance.now()-n),latestBlock:i}}));return function(t){return e.apply(this,arguments)}}(),r._getPublicKey=function(){var e=w()((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.prefix,n=void 0===t||t,r=yield this.getDbAccount(),i=r.pub;return n&&(i=Object(M.a)(i)),Promise.resolve(i)}));return function(){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=w()((function*(e){return Object(_.e)(e)&&64===Object(M.d)(e).length?Promise.resolve(e):Promise.reject(new F.f)}));return function(t){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(){var e=w()((function*(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))}));return function(t){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=w()((function*(e){var t=yield this.getClient();try{var n=yield t.getAccount(Object(M.d)(e)),r=v()(n,"authentication_key",null);return!y()(r)}catch(i){if("resource_not_found"===v()(i,"errorCode",null))return!1;throw i}}));return function(t){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=w()((function*(e){var t=yield this.getClient(),n=f()(e,(function(e){return e.address})),r=new Map;return yield Promise.all(Object.entries(n).map(function(){var e=w()((function*(e){var n=d()(e,2),i=n[0],o=n[1];try{var a=yield Object(V.q)(t,i);o.forEach((function(e){var t=e.tokenAddress,n=V.a+"<"+(null!=t?t:V.b)+">",o=null==a?void 0:a.find((function(e){return e.type===n})),c=v()(o,"data.coin.value",0),u=i+"-"+(null!=t?t:V.b);try{r.set(u,new j.a(c))}catch(s){}}))}catch(c){}}));return function(t){return e.apply(this,arguments)}}())),e.map((function(e){var t,n=e.address,i=e.tokenAddress,o=n+"-"+(null!=i?i:V.b);return null!=(t=r.get(o))?t:new j.a(0)}))}));return function(t){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(){var e=w()((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=w()((function*(e){try{return yield Object(V.r)(t,e)}catch(n){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=w()((function*(){Object(N.a)("https://aptoslabs.com/testnet-faucet")}));return function(){return e.apply(this,arguments)}}(),r.activateToken=function(){var e=w()((function*(e,t){var n=(yield this.getDbAccount()).address;if(yield Object(V.p)(yield this.getClient(),n,e))return Promise.resolve(!0);var r=Object(V.k)(e);r.sender=n;var i=yield this.buildUnsignedTxFromEncodedTx(r);return i.payload=ae(ae({},i.payload),{},{encodedTx:r}),!!(yield this.signAndSendTransaction(i,{password:t},!1)).txid}));return function(t,n){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=w()((function*(e){var t=e.split("::"),n=d()(t,3),r=n[0],i=n[1],o=n[2];if(i&&o)try{return(yield this.validateAddress(Object(M.b)(r,{hexPad:"left"}))).toLowerCase()+"::"+i+"::"+o}catch(a){}throw new F.i}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=w()((function*(e){var t=e.feeInfoValue,n=t.price,r=t.limit;if("undefined"!==typeof n&&"string"!==typeof n)throw new F.q("Invalid gas price.");if("string"!==typeof r)throw new F.q("Invalid fee limit");var i=yield this.getNetwork(),o=Object(K.c)({value:n||"0.000000001",network:i}),c=e.encodedTx.bscTxn;if(!y()(c)&&!a()(c)){var u=new C.BCS.Deserializer(Object(E.hexToBytes)(c)),s=C.TxnBuilderTypes.RawTransaction.deserialize(u),d=new C.TxnBuilderTypes.RawTransaction(s.sender,s.sequence_number,s.payload,BigInt(r),BigInt(o),s.expiration_timestamp_secs,s.chain_id),l=new C.BCS.Serializer;d.serialize(l),c=Object(E.bytesToHex)(l.getBytes())}var f=ae(ae({},e.encodedTx),{},{gas_unit_price:o,max_gas_amount:r,bscTxn:c});return Promise.resolve(f)}));return function(t){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.decodeTx=function(){var e=w()((function*(e,t){var n,r=yield this.engine.getNetwork(this.networkId),i=yield this.getDbAccount(),o=yield this.engine.getNativeTokenInfo(this.networkId),a=e.type,c=e.function,u=e.type_arguments;null!=e&&e.sender||(e.sender=i.address);var s=null,l=Object(V.t)({type:null!=a?a:"entry_function_payload",function_name:c,type_arguments:u});if(l===U.a.NATIVE_TRANSFER||l===U.a.TOKEN_TRANSFER){var f,p=l===U.a.TOKEN_TRANSFER,y=e.sender,h=e.type_arguments||[],v=d()(h,1)[0],g=e.arguments||[],w=d()(g,2),m=w[0],b=w[1],T="nativeTransfer";if(p&&(T="tokenTransfer",!(o=yield this.engine.ensureTokenInDB(this.networkId,v)))){var x=yield this.fetchTokenInfos([v]),O=d()(x,1)[0];if(O&&(o={id:"1",isNative:!1,networkId:this.networkId,tokenIdOnNetwork:v,name:O.name,symbol:O.symbol,decimals:O.decimals,logoURI:""}),!o)throw new Error("Invalid token address")}var A={tokenInfo:o,from:null!=y?y:"",to:m,amount:new j.a(b).shiftedBy(-o.decimals).toFixed(),amountValue:b,extraInfo:null};(f={type:l})[T]=A,s=f}else if(l===U.a.FUNCTION_CALL){var I,P;s={type:U.a.FUNCTION_CALL,direction:U.b.OTHER,functionCall:{target:e.sender,functionName:null!=c?c:"",args:null!=(I=null==(P=e.arguments)?void 0:P.map((function(e){if("string"===typeof e||"number"===typeof e||"boolean"===typeof e||"bigint"===typeof e)return e.toString();if(e instanceof Array)try{return Object(M.b)(e)}catch(t){return JSON.stringify(e)}return""})))?I:[],extraInfo:{}}}}else s={type:U.a.UNKNOWN,direction:U.b.OTHER,unknownAction:{extraInfo:{}}};var E={txid:"",owner:i.address,signer:i.address,nonce:0,actions:[s],status:U.c.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:{price:Object(K.d)({value:null!=(n=e.gas_unit_price)?n:"1",network:r}),limit:e.max_gas_amount},extraInfo:null,encodedTx:e};return Promise.resolve(E)}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=w()((function*(e){var t,n=e.to,r=e.amount,i=e.token,o=(yield this.getDbAccount()).address;if(i&&""!==i){var a=yield this.engine.ensureTokenInDB(this.networkId,i);if("undefined"===typeof a)throw new F.q("Failed to get token info.");t=new j.a(r).shiftedBy(a.decimals).toFixed()}else{var c=yield this.getNetwork();t=new j.a(r).shiftedBy(c.decimals).toFixed()}return ae(ae({},Object(V.l)(n,t,i)),{},{sender:o})}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(e){throw new F.l},r.updateEncodedTxTokenApprove=function(e,t){throw new F.l},r.updateEncodedTx=function(){var e=w()((function*(e,t,n){var r,i=e;if("transfer"===n.type&&[V.c,V.e].includes(null!=(r=null==i?void 0:i.function)?r:"")){var o=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,a=t.amount,c=i.arguments||[],u=d()(c,1)[0];i.arguments=[u,new j.a(a).shiftedBy(o).toFixed()]}return Promise.resolve(i)}));return function(t,n,r){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=w()((function*(e){var t=e,n=BigInt(Math.floor(Date.now()/1e3)+100);if(y()(e.bscTxn)||a()(e.bscTxn))e.expiration_timestamp_secs&&BigInt(e.expiration_timestamp_secs)<n&&(t.expiration_timestamp_secs=n.toString());else{var r=new C.BCS.Deserializer(Object(E.hexToBytes)(e.bscTxn)),i=C.TxnBuilderTypes.RawTransaction.deserialize(r),o=new C.TxnBuilderTypes.RawTransaction(i.sender,i.sequence_number,i.payload,i.max_gas_amount,i.gas_unit_price,i.expiration_timestamp_secs>n?i.expiration_timestamp_secs:n,i.chain_id),c=new C.BCS.Serializer;o.serialize(c),t.bscTxn=Object(E.bytesToHex)(c.getBytes())}var u=yield this.getDbAccount();return Promise.resolve({inputs:[{address:Object(M.d)(u.address),value:new j.a(0),publicKey:Object(M.d)(u.pub)}],outputs:[],payload:{encodedTx:t},encodedTx:t})}));return function(t){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=w()((function*(e,t){var n,r,o=ae(ae({},e),{},{gas_unit_price:"100"}),a=(o.max_gas_amount,i()(o,ie)),c=yield this.getClient(),u=yield this.getNetwork();if(t){var s;if(e.bscTxn&&(null==(s=e.bscTxn)?void 0:s.length)>0){var l=new C.BCS.Deserializer(Object(E.hexToBytes)(e.bscTxn));n=(T=C.TxnBuilderTypes.RawTransaction.deserialize(l)).max_gas_amount.toString(),r=T.gas_unit_price.toString()}else{var f,p;n=null!=(f=e.gas_unit_price)?f:V.f,r=null!=(p=e.gas_unit_price)?p:"100"}return{nativeSymbol:u.symbol,nativeDecimals:u.decimals,feeSymbol:u.feeSymbol,feeDecimals:u.feeDecimals,limit:n,prices:[Object(K.d)({value:r,network:u})],defaultPresetIndex:"0"}}var y=yield Promise.all([c.client.transactions.estimateGasPrice(),this.buildUnsignedTxFromEncodedTx(a)]),h=d()(y,2),v=h[0],g=h[1];try{var w,m,b,T,x=g.encodedTx;if(x.bscTxn&&(null==(w=x.bscTxn)?void 0:w.length)>0){l=new C.BCS.Deserializer(Object(E.hexToBytes)(x.bscTxn));T=C.TxnBuilderTypes.RawTransaction.deserialize(l)}else T=yield Object(V.o)(c,g);var O=new Uint8Array(64),A=(yield Object(V.h)(T,null!=(m=null==(b=g.inputs)?void 0:b[0].publicKey)?m:"",Object(E.bytesToHex)(O))).rawTx,I=yield(yield this.getClient()).submitBCSSimulation(Object(E.hexToBytes)(A),{estimateGasUnitPrice:!0,estimateMaxGasAmount:!0});if(!I||0===I.length)throw new Error;var P=null==I?void 0:I[0],k=e.function===V.c,S=new j.a(P.gas_used);if(S.isEqualTo(0)||!k&&!P.success)throw Object(V.i)(P.vm_status);n=j.a.min(S.multipliedBy(2),new j.a(P.max_gas_amount)).toFixed(0),r=Object(K.d)({value:P.gas_unit_price,network:u})}catch(D){if(D instanceof F.n)throw D;n=e.function===V.c||e.function===V.e?V.f:V.g,r=Object(K.d)({value:v.gas_estimate.toString(),network:u})}return{nativeSymbol:u.symbol,nativeDecimals:u.decimals,feeSymbol:u.feeSymbol,feeDecimals:u.feeDecimals,limit:n,prices:[r],defaultPresetIndex:"0"}}));return function(t,n){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=w()((function*(e){var t=yield this.getClient();H.a.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var n=(yield t.submitSignedBCSTransaction(Object(E.hexToBytes)(e.rawTx))).hash;return H.a.engine.info("broadcastTransaction Done:",{txid:n,rawTx:e.rawTx}),yield Object(V.w)(t,n),H.a.engine.info("broadcastTransaction wait Pending END:",{txid:n,rawTx:e.rawTx}),ae(ae({},e),{},{txid:n})}catch(i){if(i instanceof F.q)throw i;var r=(i||{}).message;throw Object(V.i)(r)}}));return function(t){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=w()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),i=d()(r,1)[0];return"0x"+Object(B.a)(e,i).toString("hex")}throw new F.q("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=w()((function*(e){var t=this,n=e.localHistory,r=void 0===n?[]:n;if(e.tokenIdOnNetwork)return Promise.resolve([]);var i=yield this.getClient(),o=yield this.getDbAccount(),a=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,c=(yield i.getAccountTransactions(o.address)).map(function(){var e=w()((function*(e){var n=r.find((function(t){return t.decodedTx.txid===e.hash}));if(n&&n.decodedTx.isFinal)return Promise.resolve(null);try{var c,u=(null==e?void 0:e.payload)||{},s=u.arguments,l=u.type_arguments,f=u.function;u.code;if(null==e||!e.payload)return yield Promise.resolve(null);var p=d()(l,1)[0],y=v()(e,"sender",void 0),h=null==f?void 0:f.split("::"),g=d()(h,1)[0],w=Object(V.s)(e),m={from:y,to:g,value:""},b={type:U.a.UNKNOWN};if(w===U.a.NATIVE_TRANSFER||w===U.a.TOKEN_TRANSFER){var T,x=s||[],O=d()(x,2),A=O[0],I=O[1],P=w===U.a.TOKEN_TRANSFER,E=U.b.IN;y===o.address&&(E=A===o.address?U.b.SELF:U.b.OUT);var C=yield t.engine.getNativeTokenInfo(t.networkId),k="nativeTransfer";if(P){if(k="tokenTransfer","undefined"===typeof(C=yield t.engine.ensureTokenInDB(t.networkId,p)))throw new F.q("Failed to get token info.")}else m.to=A,m.value=I;(T={type:w,direction:E})[k]={tokenInfo:C,from:y,to:A,amount:new j.a(I).shiftedBy(-C.decimals).toFixed(),amountValue:I,extraInfo:null},b=T}else if(w===U.a.TOKEN_ACTIVATE){var S,D,B,R,N=yield t.engine.ensureTokenInDB(t.networkId,p),K={name:null!=(S=null==N?void 0:N.name)?S:"",symbol:null!=(D=null==N?void 0:N.symbol)?D:"",decimals:null!=(B=null==N?void 0:N.decimals)?B:6,logoURI:null!=(R=null==N?void 0:N.logoURI)?R:""};"undefined"===typeof N&&(K=ae(ae({},yield Object(V.r)(i,p)),{},{logoURI:""})),b={type:w,tokenActivate:ae(ae({},K),{},{tokenAddress:p,extraInfo:null})}}else w===U.a.FUNCTION_CALL&&(b={type:U.a.FUNCTION_CALL,direction:U.b.OTHER,functionCall:{target:y,functionName:null!=f?f:"",args:s,extraInfo:{}}});var M=new j.a(v()(e,"gas_used",0)).multipliedBy(v()(e,"gas_unit_price",0)),L=v()(e,"success",void 0),q=U.c.Pending;!1===L?q=U.c.Failed:!0===L&&(q=U.c.Confirmed);var W={txid:e.hash,owner:o.address,signer:y,nonce:0,actions:[b],status:q,networkId:t.networkId,accountId:t.accountId,encodedTx:m,extraInfo:null,totalFeeInNative:new j.a(M).shiftedBy(-a).toFixed()};return W.updatedAt=v()(e,"timestamp",Object(_.c)())/1e3,W.createdAt=null!=(c=null==n?void 0:n.decodedTx.createdAt)?c:W.updatedAt,W.isFinal=W.status===U.c.Confirmed,yield t.buildHistoryTx({decodedTx:W,historyTxToMerge:n})}catch(z){H.a.common.error(z)}return Promise.resolve(null)}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(c)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=w()((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=w()((function*(e){try{var n=yield t.getTransactionByHash(e),r=v()(n,"success",void 0),i=R.a.PENDING;return!1===r?i=R.a.CONFIRM_BUT_FAILED:!0===r&&(i=R.a.CONFIRM_AND_SUCCESS),yield Promise.resolve(i)}catch(o){if("transaction_not_found"===o.errorCode)return Promise.resolve(R.a.NOT_FOUND)}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionByHash=function(){var e=w()((function*(e){return(yield this.getClient()).getTransactionByHash(e)}));return function(t){return e.apply(this,arguments)}}(),b()(n)}(L.a)}}]);