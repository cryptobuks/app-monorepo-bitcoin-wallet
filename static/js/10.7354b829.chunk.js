(this.webpackJsonp=this.webpackJsonp||[]).push([[10],{3099:function(e,t,r){var n=r(3204),i=r(3139),o=n.tfJSON,s=n.TfTypeError,u=n.TfPropertyTypeError,a=n.tfSubError,c=n.getValueTypeName,f={arrayOf:function(e,t){function r(r,n){return!!i.Array(r)&&(!i.Nil(r)&&(!(void 0!==t.minLength&&r.length<t.minLength)&&(!(void 0!==t.maxLength&&r.length>t.maxLength)&&((void 0===t.length||r.length===t.length)&&r.every((function(t,r){try{return h(e,t,n)}catch(i){throw a(i,r)}}))))))}return e=p(e),t=t||{},r.toJSON=function(){var r="["+o(e)+"]";return void 0!==t.length?r+="{"+t.length+"}":void 0===t.minLength&&void 0===t.maxLength||(r+="{"+(void 0===t.minLength?0:t.minLength)+","+(void 0===t.maxLength?1/0:t.maxLength)+"}"),r},r},maybe:function e(t){function r(r,n){return i.Nil(r)||t(r,n,e)}return t=p(t),r.toJSON=function(){return"?"+o(t)},r},map:function(e,t){function r(r,n){if(!i.Object(r))return!1;if(i.Nil(r))return!1;for(var o in r){try{t&&h(t,o,n)}catch(u){throw a(u,o,"key")}try{var s=r[o];h(e,s,n)}catch(u){throw a(u,o)}}return!0}return e=p(e),t&&(t=p(t)),r.toJSON=t?function(){return"{"+o(t)+": "+o(e)+"}"}:function(){return"{"+o(e)+"}"},r},object:function(e){var t={};for(var r in e)t[r]=p(e[r]);function n(e,r){if(!i.Object(e))return!1;if(i.Nil(e))return!1;var n;try{for(n in t){h(t[n],e[n],r)}}catch(o){throw a(o,n)}if(r)for(n in e)if(!t[n])throw new u(void 0,n);return!0}return n.toJSON=function(){return o(t)},n},anyOf:function(){var e=[].slice.call(arguments).map(p);function t(t,r){return e.some((function(e){try{return h(e,t,r)}catch(n){return!1}}))}return t.toJSON=function(){return e.map(o).join("|")},t},allOf:function(){var e=[].slice.call(arguments).map(p);function t(t,r){return e.every((function(e){try{return h(e,t,r)}catch(n){return!1}}))}return t.toJSON=function(){return e.map(o).join(" & ")},t},quacksLike:function(e){function t(t){return e===c(t)}return t.toJSON=function(){return e},t},tuple:function(){var e=[].slice.call(arguments).map(p);function t(t,r){return!i.Nil(t)&&(!i.Nil(t.length)&&((!r||t.length===e.length)&&e.every((function(e,n){try{return h(e,t[n],r)}catch(i){throw a(i,n)}}))))}return t.toJSON=function(){return"("+e.map(o).join(", ")+")"},t},value:function(e){function t(t){return t===e}return t.toJSON=function(){return e},t}};function p(e){if(i.String(e))return"?"===e[0]?f.maybe(e.slice(1)):i[e]||f.quacksLike(e);if(e&&i.Object(e)){if(i.Array(e)){if(1!==e.length)throw new TypeError("Expected compile() parameter of type Array of length 1");return f.arrayOf(e[0])}return f.object(e)}return i.Function(e)?e:f.value(e)}function h(e,t,r,n){if(i.Function(e)){if(e(t,r))return!0;throw new s(n||e,t)}return h(p(e),t,r)}for(var l in f.oneOf=f.anyOf,i)h[l]=i[l];for(l in f)h[l]=f[l];var d=r(3312);for(l in d)h[l]=d[l];h.compile=p,h.TfTypeError=s,h.TfPropertyTypeError=u,e.exports=h},3101:function(e,t,r){"use strict";var n=r(657),i=r(3311);e.exports=i((function(e){var t=n("sha256").update(e).digest();return n("sha256").update(t).digest()}))},3126:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNSIGNED_TX=0]="UNSIGNED_TX",e[e.GLOBAL_XPUB=1]="GLOBAL_XPUB"}(t.GlobalTypes||(t.GlobalTypes={})),t.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"],function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.POR_COMMITMENT=9]="POR_COMMITMENT",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",e[e.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",e[e.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT"}(t.InputTypes||(t.InputTypes={})),t.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"],function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=2]="BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",e[e.TAP_TREE=6]="TAP_TREE",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"}(t.OutputTypes||(t.OutputTypes={})),t.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"]},3132:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oneOf=t.Null=t.BufferN=t.Function=t.UInt32=t.UInt8=t.tuple=t.maybe=t.Hex=t.Buffer=t.String=t.Boolean=t.Array=t.Number=t.Hash256bit=t.Hash160bit=t.Buffer256bit=t.isTaptree=t.isTapleaf=t.TAPLEAF_VERSION_MASK=t.Network=t.ECPoint=t.Satoshi=t.Signer=t.BIP32Path=t.UInt31=t.isPoint=t.typeforce=void 0;const n=r(22);t.typeforce=r(3099);const i=n.Buffer.alloc(32,0),o=n.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");t.isPoint=function(e){if(!n.Buffer.isBuffer(e))return!1;if(e.length<33)return!1;const t=e[0],r=e.slice(1,33);if(0===r.compare(i))return!1;if(r.compare(o)>=0)return!1;if((2===t||3===t)&&33===e.length)return!0;const s=e.slice(33);return 0!==s.compare(i)&&(!(s.compare(o)>=0)&&(4===t&&65===e.length))};const s=Math.pow(2,31)-1;function u(e){return t.typeforce.String(e)&&!!e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}t.UInt31=function(e){return t.typeforce.UInt32(e)&&e<=s},t.BIP32Path=u,u.toJSON=()=>"BIP32 derivation path",t.Signer=function(e){return(t.typeforce.Buffer(e.publicKey)||"function"===typeof e.getPublicKey)&&"function"===typeof e.sign};function a(e){return!(!e||!("output"in e))&&(!!n.Buffer.isBuffer(e.output)&&(void 0===e.version||(e.version&t.TAPLEAF_VERSION_MASK)===e.version))}t.Satoshi=function(e){return t.typeforce.UInt53(e)&&e<=21e14},t.ECPoint=t.typeforce.quacksLike("Point"),t.Network=t.typeforce.compile({messagePrefix:t.typeforce.oneOf(t.typeforce.Buffer,t.typeforce.String),bip32:{public:t.typeforce.UInt32,private:t.typeforce.UInt32},pubKeyHash:t.typeforce.UInt8,scriptHash:t.typeforce.UInt8,wif:t.typeforce.UInt8}),t.TAPLEAF_VERSION_MASK=254,t.isTapleaf=a,t.isTaptree=function e(r){return(0,t.Array)(r)?2===r.length&&r.every(t=>e(t)):a(r)},t.Buffer256bit=t.typeforce.BufferN(32),t.Hash160bit=t.typeforce.BufferN(20),t.Hash256bit=t.typeforce.BufferN(32),t.Number=t.typeforce.Number,t.Array=t.typeforce.Array,t.Boolean=t.typeforce.Boolean,t.String=t.typeforce.String,t.Buffer=t.typeforce.Buffer,t.Hex=t.typeforce.Hex,t.maybe=t.typeforce.maybe,t.tuple=t.typeforce.tuple,t.UInt8=t.typeforce.UInt8,t.UInt32=t.typeforce.UInt32,t.Function=t.typeforce.Function,t.BufferN=t.typeforce.BufferN,t.Null=t.typeforce.Null,t.oneOf=t.typeforce.oneOf},3139:function(e,t){var r={Array:function(e){return null!==e&&void 0!==e&&e.constructor===Array},Boolean:function(e){return"boolean"===typeof e},Function:function(e){return"function"===typeof e},Nil:function(e){return void 0===e||null===e},Number:function(e){return"number"===typeof e},Object:function(e){return"object"===typeof e},String:function(e){return"string"===typeof e},"":function(){return!0}};for(var n in r.Null=r.Nil,r)r[n].toJSON=function(e){return e}.bind(null,n);e.exports=r},3145:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.signature=t.number=t.isCanonicalScriptSignature=t.isDefinedHashType=t.isCanonicalPubKey=t.toStack=t.fromASM=t.toASM=t.decompile=t.compile=t.isPushOnly=t.OPS=void 0;const n=r(3822),i=r(3585);Object.defineProperty(t,"OPS",{enumerable:!0,get:function(){return i.OPS}});const o=r(4178),s=r(4179),u=r(4180),a=r(3132),{typeforce:c}=a,f=i.OPS.OP_RESERVED;function p(e){return a.Buffer(e)||function(e){return a.Number(e)&&(e===i.OPS.OP_0||e>=i.OPS.OP_1&&e<=i.OPS.OP_16||e===i.OPS.OP_1NEGATE)}(e)}function h(e){return a.Array(e)&&e.every(p)}function l(e){return 0===e.length?i.OPS.OP_0:1===e.length?e[0]>=1&&e[0]<=16?f+e[0]:129===e[0]?i.OPS.OP_1NEGATE:void 0:void 0}function d(t){return e.isBuffer(t)}function y(t){return e.isBuffer(t)}function w(t){if(d(t))return t;c(a.Array,t);const r=t.reduce((e,t)=>y(t)?1===t.length&&void 0!==l(t)?e+1:e+o.encodingLength(t.length)+t.length:e+1,0),n=e.allocUnsafe(r);let i=0;if(t.forEach(e=>{if(y(e)){const t=l(e);if(void 0!==t)return n.writeUInt8(t,i),void(i+=1);i+=o.encode(n,e.length,i),e.copy(n,i),i+=e.length}else n.writeUInt8(e,i),i+=1}),i!==n.length)throw new Error("Could not decode chunks");return n}function g(e){if(t=e,a.Array(t))return e;var t;c(a.Buffer,e);const r=[];let n=0;for(;n<e.length;){const t=e[n];if(t>i.OPS.OP_0&&t<=i.OPS.OP_PUSHDATA4){const t=o.decode(e,n);if(null===t)return null;if(n+=t.size,n+t.number>e.length)return null;const i=e.slice(n,n+t.number);n+=t.number;const s=l(i);void 0!==s?r.push(s):r.push(i)}else r.push(t),n+=1}return r}function E(e){const t=-129&e;return t>0&&t<4}t.isPushOnly=h,t.compile=w,t.decompile=g,t.toASM=function(e){return d(e)&&(e=g(e)),e.map(e=>{if(y(e)){const t=l(e);if(void 0===t)return e.toString("hex");e=t}return i.REVERSE_OPS[e]}).join(" ")},t.fromASM=function(t){return c(a.String,t),w(t.split(" ").map(t=>void 0!==i.OPS[t]?i.OPS[t]:(c(a.Hex,t),e.from(t,"hex"))))},t.toStack=function(t){return t=g(t),c(h,t),t.map(t=>y(t)?t:t===i.OPS.OP_0?e.allocUnsafe(0):s.encode(t-f))},t.isCanonicalPubKey=function(e){return a.isPoint(e)},t.isDefinedHashType=E,t.isCanonicalScriptSignature=function(t){return!!e.isBuffer(t)&&(!!E(t[t.length-1])&&n.check(t.slice(0,-1)))},t.number=s,t.signature=u}).call(this,r(22).Buffer)},3203:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testnet=t.regtest=t.bitcoin=void 0,t.bitcoin={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},t.regtest={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},t.testnet={messagePrefix:"\x18Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}},3204:function(e,t,r){var n=r(3139);function i(e){return e.name||e.toString().match(/function (.*?)\s*\(/)[1]}function o(e){return n.Nil(e)?"":i(e.constructor)}function s(e,t){Error.captureStackTrace&&Error.captureStackTrace(e,t)}function u(e){return n.Function(e)?e.toJSON?e.toJSON():i(e):n.Array(e)?"Array":e&&n.Object(e)?"Object":void 0!==e?e:""}function a(e,t,r){var i=function(e){return n.Function(e)?"":n.String(e)?JSON.stringify(e):e&&n.Object(e)?"":e}(t);return"Expected "+u(e)+", got"+(""!==r?" "+r:"")+(""!==i?" "+i:"")}function c(e,t,r){r=r||o(t),this.message=a(e,t,r),s(this,c),this.__type=e,this.__value=t,this.__valueTypeName=r}function f(e,t,r,n,i){e?(i=i||o(n),this.message=function(e,t,r,n,i){var o='" of type ';return"key"===t&&(o='" with key type '),a('property "'+u(r)+o+u(e),n,i)}(e,r,t,n,i)):this.message='Unexpected property "'+t+'"',s(this,c),this.__label=r,this.__property=t,this.__type=e,this.__value=n,this.__valueTypeName=i}c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,f.prototype=Object.create(Error.prototype),f.prototype.constructor=c,e.exports={TfTypeError:c,TfPropertyTypeError:f,tfCustomError:function(e,t){return new c(e,{},t)},tfSubError:function(e,t,r){return e instanceof f?(t=t+"."+e.__property,e=new f(e.__type,t,e.__label,e.__value,e.__valueTypeName)):e instanceof c&&(e=new f(e.__type,t,r,e.__value,e.__valueTypeName)),s(e),e},tfJSON:u,getValueTypeName:o}},3255:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.taggedHash=t.hash256=t.hash160=t.sha256=t.sha1=t.ripemd160=void 0;const n=r(657),i=r(1173);function o(e){try{return n("rmd160").update(e).digest()}catch(t){try{return n("ripemd160").update(e).digest()}catch(r){return(new i).update(e).digest()}}}function s(e){return n("sha256").update(e).digest()}t.ripemd160=o,t.sha1=function(e){return n("sha1").update(e).digest()},t.sha256=s,t.hash160=function(e){return o(s(e))},t.hash256=function(e){return s(s(e))};const u=Object.fromEntries(["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"].map(t=>{const r=s(e.from(t));return[t,e.concat([r,r])]}));t.taggedHash=function(t,r){return s(e.concat([u[t],r]))}}).call(this,r(22).Buffer)},3291:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.value=t.prop=void 0,t.prop=function(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){const e=r.call(this);return this[t]=e,e},set(e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})}})},t.value=function(e){let t;return()=>(void 0!==t||(t=e()),t)}},3292:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});function r(e){if(e<0||e>9007199254740991||e%1!==0)throw new RangeError("value out of range")}function n(e){return r(e),e<253?1:e<=65535?3:e<=4294967295?5:9}t.encode=function t(i,o,s){if(r(i),o||(o=e.allocUnsafe(n(i))),!e.isBuffer(o))throw new TypeError("buffer must be a Buffer instance");return s||(s=0),i<253?(o.writeUInt8(i,s),Object.assign(t,{bytes:1})):i<=65535?(o.writeUInt8(253,s),o.writeUInt16LE(i,s+1),Object.assign(t,{bytes:3})):i<=4294967295?(o.writeUInt8(254,s),o.writeUInt32LE(i,s+1),Object.assign(t,{bytes:5})):(o.writeUInt8(255,s),o.writeUInt32LE(i>>>0,s+1),o.writeUInt32LE(i/4294967296|0,s+5),Object.assign(t,{bytes:9})),o},t.decode=function t(n,i){if(!e.isBuffer(n))throw new TypeError("buffer must be a Buffer instance");i||(i=0);const o=n.readUInt8(i);if(o<253)return Object.assign(t,{bytes:1}),o;if(253===o)return Object.assign(t,{bytes:3}),n.readUInt16LE(i+1);if(254===o)return Object.assign(t,{bytes:5}),n.readUInt32LE(i+1);{Object.assign(t,{bytes:9});const e=n.readUInt32LE(i+1),o=4294967296*n.readUInt32LE(i+5)+e;return r(o),o}},t.encodingLength=n}).call(this,r(22).Buffer)},3311:function(e,t,r){"use strict";var n=r(68),i=r(241).Buffer;e.exports=function(e){function t(t){var r=t.slice(0,-4),n=t.slice(-4),i=e(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(t){var r=e(t);return n.encode(i.concat([t,r],t.length+4))},decode:function(e){var r=t(n.decode(e));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(e){var r=n.decodeUnsafe(e);if(r)return t(r)}}}},3312:function(e,t,r){(function(t){var n=r(3139),i=r(3204);function o(e){return t.isBuffer(e)}function s(e){return"string"===typeof e&&/^([0-9a-f]{2})+$/i.test(e)}function u(e,t){var r=e.toJSON();function n(n){if(!e(n))return!1;if(n.length===t)return!0;throw i.tfCustomError(r+"(Length: "+t+")",r+"(Length: "+n.length+")")}return n.toJSON=function(){return r},n}var a=u.bind(null,n.Array),c=u.bind(null,o),f=u.bind(null,s),p=u.bind(null,n.String);var h=Math.pow(2,53)-1;var l={ArrayN:a,Buffer:o,BufferN:c,Finite:function(e){return"number"===typeof e&&isFinite(e)},Hex:s,HexN:f,Int8:function(e){return e<<24>>24===e},Int16:function(e){return e<<16>>16===e},Int32:function(e){return(0|e)===e},Int53:function(e){return"number"===typeof e&&e>=-h&&e<=h&&Math.floor(e)===e},Range:function(e,t,r){function i(n,i){return r(n,i)&&n>e&&n<t}return r=r||n.Number,i.toJSON=function(){return`${r.toJSON()} between [${e}, ${t}]`},i},StringN:p,UInt8:function(e){return(255&e)===e},UInt16:function(e){return(65535&e)===e},UInt32:function(e){return e>>>0===e},UInt53:function(e){return"number"===typeof e&&e>=0&&e<=h&&Math.floor(e)===e}};for(var d in l)l[d].toJSON=function(e){return e}.bind(null,d);e.exports=l}).call(this,r(22).Buffer)},3349:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initEccLib=t.Transaction=t.opcodes=t.Psbt=t.Block=t.script=t.payments=t.networks=t.crypto=t.address=void 0;const n=r(3821);t.address=n;const i=r(3255);t.crypto=i;const o=r(3203);t.networks=o;const s=r(3383);t.payments=s;const u=r(3145);t.script=u;var a=r(4188);Object.defineProperty(t,"Block",{enumerable:!0,get:function(){return a.Block}});var c=r(4190);Object.defineProperty(t,"Psbt",{enumerable:!0,get:function(){return c.Psbt}});var f=r(3585);Object.defineProperty(t,"opcodes",{enumerable:!0,get:function(){return f.OPS}});var p=r(3384);Object.defineProperty(t,"Transaction",{enumerable:!0,get:function(){return p.Transaction}});var h=r(3586);Object.defineProperty(t,"initEccLib",{enumerable:!0,get:function(){return h.initEccLib}})},3383:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.p2tr=t.p2wsh=t.p2wpkh=t.p2sh=t.p2pkh=t.p2pk=t.p2ms=t.embed=void 0;const n=r(4177);Object.defineProperty(t,"embed",{enumerable:!0,get:function(){return n.p2data}});const i=r(4181);Object.defineProperty(t,"p2ms",{enumerable:!0,get:function(){return i.p2ms}});const o=r(4182);Object.defineProperty(t,"p2pk",{enumerable:!0,get:function(){return o.p2pk}});const s=r(4183);Object.defineProperty(t,"p2pkh",{enumerable:!0,get:function(){return s.p2pkh}});const u=r(4184);Object.defineProperty(t,"p2sh",{enumerable:!0,get:function(){return u.p2sh}});const a=r(4185);Object.defineProperty(t,"p2wpkh",{enumerable:!0,get:function(){return a.p2wpkh}});const c=r(4186);Object.defineProperty(t,"p2wsh",{enumerable:!0,get:function(){return c.p2wsh}});const f=r(4187);Object.defineProperty(t,"p2tr",{enumerable:!0,get:function(){return f.p2tr}})},3384:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction=void 0;const n=r(3455),i=r(3255),o=r(3145),s=r(3145),u=r(3132),{typeforce:a}=u;function c(e){const t=e.length;return n.varuint.encodingLength(t)+t}const f=e.allocUnsafe(0),p=[],h=e.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),l=e.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),d=e.from("ffffffffffffffff","hex"),y={script:f,valueBuffer:d};class w{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(e,t){const r=new n.BufferReader(e),i=new w;i.version=r.readInt32();const o=r.readUInt8(),s=r.readUInt8();let u=!1;o===w.ADVANCED_TRANSACTION_MARKER&&s===w.ADVANCED_TRANSACTION_FLAG?u=!0:r.offset-=2;const a=r.readVarInt();for(let n=0;n<a;++n)i.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:p});const c=r.readVarInt();for(let n=0;n<c;++n)i.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(u){for(let e=0;e<a;++e)i.ins[e].witness=r.readVector();if(!i.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(i.locktime=r.readUInt32(),t)return i;if(r.offset!==e.length)throw new Error("Transaction has unexpected data");return i}static fromHex(t){return w.fromBuffer(e.from(t,"hex"),!1)}static isCoinbaseHash(e){a(u.Hash256bit,e);for(let t=0;t<32;++t)if(0!==e[t])return!1;return!0}isCoinbase(){return 1===this.ins.length&&w.isCoinbaseHash(this.ins[0].hash)}addInput(e,t,r,n){return a(u.tuple(u.Hash256bit,u.UInt32,u.maybe(u.UInt32),u.maybe(u.Buffer)),arguments),u.Null(r)&&(r=w.DEFAULT_SEQUENCE),this.ins.push({hash:e,index:t,script:n||f,sequence:r,witness:p})-1}addOutput(e,t){return a(u.tuple(u.Buffer,u.Satoshi),arguments),this.outs.push({script:e,value:t})-1}hasWitnesses(){return this.ins.some(e=>0!==e.witness.length)}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(e=!0){const t=e&&this.hasWitnesses();return(t?10:8)+n.varuint.encodingLength(this.ins.length)+n.varuint.encodingLength(this.outs.length)+this.ins.reduce((e,t)=>e+40+c(t.script),0)+this.outs.reduce((e,t)=>e+8+c(t.script),0)+(t?this.ins.reduce((e,t)=>e+function(e){const t=e.length;return n.varuint.encodingLength(t)+e.reduce((e,t)=>e+c(t),0)}(t.witness),0):0)}clone(){const e=new w;return e.version=this.version,e.locktime=this.locktime,e.ins=this.ins.map(e=>({hash:e.hash,index:e.index,script:e.script,sequence:e.sequence,witness:e.witness})),e.outs=this.outs.map(e=>({script:e.script,value:e.value})),e}hashForSignature(t,r,n){if(a(u.tuple(u.UInt32,u.Buffer,u.Number),arguments),t>=this.ins.length)return l;const c=o.compile(o.decompile(r).filter(e=>e!==s.OPS.OP_CODESEPARATOR)),p=this.clone();if((31&n)===w.SIGHASH_NONE)p.outs=[],p.ins.forEach((e,r)=>{r!==t&&(e.sequence=0)});else if((31&n)===w.SIGHASH_SINGLE){if(t>=this.outs.length)return l;p.outs.length=t+1;for(let e=0;e<t;e++)p.outs[e]=y;p.ins.forEach((e,r)=>{r!==t&&(e.sequence=0)})}n&w.SIGHASH_ANYONECANPAY?(p.ins=[p.ins[t]],p.ins[0].script=c):(p.ins.forEach(e=>{e.script=f}),p.ins[t].script=c);const h=e.allocUnsafe(p.byteLength(!1)+4);return h.writeInt32LE(n,h.length-4),p.__toBuffer(h,0,!1),i.hash256(h)}hashForWitnessV1(t,r,o,s,p,h){if(a(u.tuple(u.UInt32,a.arrayOf(u.Buffer),a.arrayOf(u.Satoshi),u.UInt32),arguments),o.length!==this.ins.length||r.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const l=s===w.SIGHASH_DEFAULT?w.SIGHASH_ALL:s&w.SIGHASH_OUTPUT_MASK,d=(s&w.SIGHASH_INPUT_MASK)===w.SIGHASH_ANYONECANPAY,y=l===w.SIGHASH_NONE,g=l===w.SIGHASH_SINGLE;let E=f,S=f,m=f,b=f,_=f;if(!d){let e=n.BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach(t=>{e.writeSlice(t.hash),e.writeUInt32(t.index)}),E=i.sha256(e.end()),e=n.BufferWriter.withCapacity(8*this.ins.length),o.forEach(t=>e.writeUInt64(t)),S=i.sha256(e.end()),e=n.BufferWriter.withCapacity(r.map(c).reduce((e,t)=>e+t)),r.forEach(t=>e.writeVarSlice(t)),m=i.sha256(e.end()),e=n.BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach(t=>e.writeUInt32(t.sequence)),b=i.sha256(e.end())}if(y||g){if(g&&t<this.outs.length){const e=this.outs[t],r=n.BufferWriter.withCapacity(8+c(e.script));r.writeUInt64(e.value),r.writeVarSlice(e.script),_=i.sha256(r.end())}}else{const e=this.outs.map(e=>8+c(e.script)).reduce((e,t)=>e+t),t=n.BufferWriter.withCapacity(e);this.outs.forEach(e=>{t.writeUInt64(e.value),t.writeVarSlice(e.script)}),_=i.sha256(t.end())}const T=(p?2:0)+(h?1:0),I=174-(d?49:0)-(y?32:0)+(h?32:0)+(p?37:0),k=n.BufferWriter.withCapacity(I);if(k.writeUInt8(s),k.writeInt32(this.version),k.writeUInt32(this.locktime),k.writeSlice(E),k.writeSlice(S),k.writeSlice(m),k.writeSlice(b),y||g||k.writeSlice(_),k.writeUInt8(T),d){const e=this.ins[t];k.writeSlice(e.hash),k.writeUInt32(e.index),k.writeUInt64(o[t]),k.writeVarSlice(r[t]),k.writeUInt32(e.sequence)}else k.writeUInt32(t);if(h){const e=n.BufferWriter.withCapacity(c(h));e.writeVarSlice(h),k.writeSlice(i.sha256(e.end()))}return g&&k.writeSlice(_),p&&(k.writeSlice(p),k.writeUInt8(0),k.writeUInt32(4294967295)),i.taggedHash("TapSighash",e.concat([e.of(0),k.end()]))}hashForWitnessV0(t,r,o,s){a(u.tuple(u.UInt32,u.Buffer,u.Satoshi,u.UInt32),arguments);let f,p=e.from([]),l=h,d=h,y=h;if(s&w.SIGHASH_ANYONECANPAY||(p=e.allocUnsafe(36*this.ins.length),f=new n.BufferWriter(p,0),this.ins.forEach(e=>{f.writeSlice(e.hash),f.writeUInt32(e.index)}),d=i.hash256(p)),s&w.SIGHASH_ANYONECANPAY||(31&s)===w.SIGHASH_SINGLE||(31&s)===w.SIGHASH_NONE||(p=e.allocUnsafe(4*this.ins.length),f=new n.BufferWriter(p,0),this.ins.forEach(e=>{f.writeUInt32(e.sequence)}),y=i.hash256(p)),(31&s)!==w.SIGHASH_SINGLE&&(31&s)!==w.SIGHASH_NONE){const t=this.outs.reduce((e,t)=>e+8+c(t.script),0);p=e.allocUnsafe(t),f=new n.BufferWriter(p,0),this.outs.forEach(e=>{f.writeUInt64(e.value),f.writeVarSlice(e.script)}),l=i.hash256(p)}else if((31&s)===w.SIGHASH_SINGLE&&t<this.outs.length){const r=this.outs[t];p=e.allocUnsafe(8+c(r.script)),f=new n.BufferWriter(p,0),f.writeUInt64(r.value),f.writeVarSlice(r.script),l=i.hash256(p)}p=e.allocUnsafe(156+c(r)),f=new n.BufferWriter(p,0);const g=this.ins[t];return f.writeInt32(this.version),f.writeSlice(d),f.writeSlice(y),f.writeSlice(g.hash),f.writeUInt32(g.index),f.writeVarSlice(r),f.writeUInt64(o),f.writeUInt32(g.sequence),f.writeSlice(l),f.writeUInt32(this.locktime),f.writeUInt32(s),i.hash256(p)}getHash(t){return t&&this.isCoinbase()?e.alloc(32,0):i.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return(0,n.reverseBuffer)(this.getHash(!1)).toString("hex")}toBuffer(e,t){return this.__toBuffer(e,t,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(e,t){a(u.tuple(u.Number,u.Buffer),arguments),this.ins[e].script=t}setWitness(e,t){a(u.tuple(u.Number,[u.Buffer]),arguments),this.ins[e].witness=t}__toBuffer(t,r,i=!1){t||(t=e.allocUnsafe(this.byteLength(i)));const o=new n.BufferWriter(t,r||0);o.writeInt32(this.version);const s=i&&this.hasWitnesses();return s&&(o.writeUInt8(w.ADVANCED_TRANSACTION_MARKER),o.writeUInt8(w.ADVANCED_TRANSACTION_FLAG)),o.writeVarInt(this.ins.length),this.ins.forEach(e=>{o.writeSlice(e.hash),o.writeUInt32(e.index),o.writeVarSlice(e.script),o.writeUInt32(e.sequence)}),o.writeVarInt(this.outs.length),this.outs.forEach(e=>{void 0!==e.value?o.writeUInt64(e.value):o.writeSlice(e.valueBuffer),o.writeVarSlice(e.script)}),s&&this.ins.forEach(e=>{o.writeVector(e.witness)}),o.writeUInt32(this.locktime),void 0!==r?t.slice(r,o.offset):t}}t.Transaction=w,w.DEFAULT_SEQUENCE=4294967295,w.SIGHASH_DEFAULT=0,w.SIGHASH_ALL=1,w.SIGHASH_NONE=2,w.SIGHASH_SINGLE=3,w.SIGHASH_ANYONECANPAY=128,w.SIGHASH_OUTPUT_MASK=3,w.SIGHASH_INPUT_MASK=128,w.ADVANCED_TRANSACTION_MARKER=0,w.ADVANCED_TRANSACTION_FLAG=1}).call(this,r(22).Buffer)},3453:function(e,t){function r(e){return 41+(e.script?e.script.length:107)}function n(e){return 9+(e.script?e.script.length:25)}function i(e,t){return 3*r({})}function o(e,t){return 10+e.reduce((function(e,t){return e+r(t)}),0)+t.reduce((function(e,t){return e+n(t)}),0)}function s(e){return"number"!==typeof e?NaN:isFinite(e)?Math.floor(e)!==e||e<0?NaN:e:NaN}function u(e){return e.reduce((function(e,t){return e+s(t.value)}),0)}var a=n({});e.exports={dustThreshold:i,finalize:function(e,t,r){var n=o(e,t),s=r*(n+a),c=u(e)-(u(t)+s);c>i()&&(t=t.concat({value:c}));var f=u(e)-u(t);return isFinite(f)?{inputs:e,outputs:t,fee:f}:{fee:r*n}},inputBytes:r,outputBytes:n,sumOrNaN:u,sumForgiving:function(e){return e.reduce((function(e,t){return e+(isFinite(t.value)?t.value:0)}),0)},transactionBytes:o,uintOrNaN:s}},3455:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=t.BufferWriter=t.cloneBuffer=t.reverseBuffer=t.writeUInt64LE=t.readUInt64LE=t.varuint=void 0;const n=r(3132),{typeforce:i}=n,o=r(3456);function s(e,t){if("number"!==typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function u(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,s(n+r,9007199254740991),n+r}function a(e,t,r){return s(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}t.varuint=o,t.readUInt64LE=u,t.writeUInt64LE=a,t.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},t.cloneBuffer=function(t){const r=e.allocUnsafe(t.length);return t.copy(r),r};class c{static withCapacity(t){return new c(e.alloc(t))}constructor(e,t=0){this.buffer=e,this.offset=t,i(n.tuple(n.Buffer,n.UInt32),[e,t])}writeUInt8(e){this.offset=this.buffer.writeUInt8(e,this.offset)}writeInt32(e){this.offset=this.buffer.writeInt32LE(e,this.offset)}writeUInt32(e){this.offset=this.buffer.writeUInt32LE(e,this.offset)}writeUInt64(e){this.offset=a(this.buffer,e,this.offset)}writeVarInt(e){o.encode(e,this.buffer,this.offset),this.offset+=o.encode.bytes}writeSlice(e){if(this.buffer.length<this.offset+e.length)throw new Error("Cannot write slice out of bounds");this.offset+=e.copy(this.buffer,this.offset)}writeVarSlice(e){this.writeVarInt(e.length),this.writeSlice(e)}writeVector(e){this.writeVarInt(e.length),e.forEach(e=>this.writeVarSlice(e))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}t.BufferWriter=c;t.BufferReader=class{constructor(e,t=0){this.buffer=e,this.offset=t,i(n.tuple(n.Buffer,n.UInt32),[e,t])}readUInt8(){const e=this.buffer.readUInt8(this.offset);return this.offset++,e}readInt32(){const e=this.buffer.readInt32LE(this.offset);return this.offset+=4,e}readUInt32(){const e=this.buffer.readUInt32LE(this.offset);return this.offset+=4,e}readUInt64(){const e=u(this.buffer,this.offset);return this.offset+=8,e}readVarInt(){const e=o.decode(this.buffer,this.offset);return this.offset+=o.decode.bytes,e}readSlice(e){if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const e=this.readVarInt(),t=[];for(let r=0;r<e;r++)t.push(this.readVarSlice());return t}}}).call(this,r(22).Buffer)},3456:function(e,t,r){"use strict";var n=r(241).Buffer;function i(e){if(e<0||e>9007199254740991||e%1!==0)throw new RangeError("value out of range")}function o(e){return i(e),e<253?1:e<=65535?3:e<=4294967295?5:9}e.exports={encode:function e(t,r,s){if(i(t),r||(r=n.allocUnsafe(o(t))),!n.isBuffer(r))throw new TypeError("buffer must be a Buffer instance");return s||(s=0),t<253?(r.writeUInt8(t,s),e.bytes=1):t<=65535?(r.writeUInt8(253,s),r.writeUInt16LE(t,s+1),e.bytes=3):t<=4294967295?(r.writeUInt8(254,s),r.writeUInt32LE(t,s+1),e.bytes=5):(r.writeUInt8(255,s),r.writeUInt32LE(t>>>0,s+1),r.writeUInt32LE(t/4294967296|0,s+5),e.bytes=9),r},decode:function e(t,r){if(!n.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");r||(r=0);var o=t.readUInt8(r);if(o<253)return e.bytes=1,o;if(253===o)return e.bytes=3,t.readUInt16LE(r+1);if(254===o)return e.bytes=5,t.readUInt32LE(r+1);e.bytes=9;var s=t.readUInt32LE(r+1),u=4294967296*t.readUInt32LE(r+5)+s;return i(u),u},encodingLength:o}},3585:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REVERSE_OPS=t.OPS=void 0;const n={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};t.OPS=n;const i={};t.REVERSE_OPS=i;for(const o of Object.keys(n)){i[n[o]]=o}},3586:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.getEccLib=t.initEccLib=void 0;const r={};t.initEccLib=function(t){var s;t?t!==r.eccLib&&(i("function"===typeof(s=t).isXOnlyPoint),i(s.isXOnlyPoint(n("79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"))),i(s.isXOnlyPoint(n("fffffffffffffffffffffffffffffffffffffffffffffffffffffffeeffffc2e"))),i(s.isXOnlyPoint(n("f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9"))),i(s.isXOnlyPoint(n("0000000000000000000000000000000000000000000000000000000000000001"))),i(!s.isXOnlyPoint(n("0000000000000000000000000000000000000000000000000000000000000000"))),i(!s.isXOnlyPoint(n("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"))),i("function"===typeof s.xOnlyPointAddTweak),o.forEach(t=>{const r=s.xOnlyPointAddTweak(n(t.pubkey),n(t.tweak));null===t.result?i(null===r):(i(null!==r),i(r.parity===t.parity),i(e.from(r.xOnlyPubkey).equals(n(t.result))))}),r.eccLib=t):r.eccLib=t},t.getEccLib=function(){if(!r.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return r.eccLib};const n=t=>e.from(t,"hex");function i(e){if(!e)throw new Error("ecc library invalid")}const o=[{pubkey:"79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",tweak:"fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364140",parity:-1,result:null},{pubkey:"1617d38ed8d8657da4d4761e8057bc396ea9e4b9d29776d4be096016dbd2509b",tweak:"a8397a935f0dfceba6ba9618f6451ef4d80637abf4e6af2669fbc9de6a8fd2ac",parity:1,result:"e478f99dab91052ab39a33ea35fd5e6e4933f4d28023cd597c9a1f6760346adf"},{pubkey:"2c0b7cf95324a07d05398b240174dc0c2be444d96b159aa6c7f7b1e668680991",tweak:"823c3cd2142744b075a87eade7e1b8678ba308d566226a0056ca2b7a76f86b47",parity:0,result:"9534f8dc8c6deda2dc007655981c78b49c5d96c778fbf363462a11ec9dfd948c"}]}).call(this,r(22).Buffer)},3587:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tweakKey=t.tapTweakHash=t.tapleafHash=t.findScriptPath=t.toHashTree=t.rootHashFromPath=t.MAX_TAPTREE_DEPTH=t.LEAF_VERSION_TAPSCRIPT=void 0;const n=r(22),i=r(3586),o=r(3255),s=r(3455),u=r(3132);t.LEAF_VERSION_TAPSCRIPT=192,t.MAX_TAPTREE_DEPTH=128;function a(e){const r=e.version||t.LEAF_VERSION_TAPSCRIPT;return o.taggedHash("TapLeaf",n.Buffer.concat([n.Buffer.from([r]),p(e.output)]))}function c(e,t){return o.taggedHash("TapTweak",n.Buffer.concat(t?[e,t]:[e]))}function f(e,t){return o.taggedHash("TapBranch",n.Buffer.concat([e,t]))}function p(e){const t=s.varuint.encodingLength(e.length),r=n.Buffer.allocUnsafe(t);return s.varuint.encode(e.length,r),n.Buffer.concat([r,e])}t.rootHashFromPath=function(e,t){if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);const r=(e.length-33)/32;let n=t;for(let i=0;i<r;i++){const t=e.slice(33+32*i,65+32*i);n=n.compare(t)<0?f(n,t):f(t,n)}return n},t.toHashTree=function e(t){if((0,u.isTapleaf)(t))return{hash:a(t)};const r=[e(t[0]),e(t[1])];r.sort((e,t)=>e.hash.compare(t.hash));const[n,i]=r;return{hash:f(n.hash,i.hash),left:n,right:i}},t.findScriptPath=function e(t,r){if("left"in(n=t)&&"right"in n){const n=e(t.left,r);if(void 0!==n)return[...n,t.right.hash];const i=e(t.right,r);if(void 0!==i)return[...i,t.left.hash]}else if(t.hash.equals(r))return[];var n},t.tapleafHash=a,t.tapTweakHash=c,t.tweakKey=function(e,t){if(!n.Buffer.isBuffer(e))return null;if(32!==e.length)return null;if(t&&32!==t.length)return null;const r=c(e,t),o=(0,i.getEccLib)().xOnlyPointAddTweak(e,r);return o&&null!==o.xOnlyPubkey?{parity:o.parity,x:n.Buffer.from(o.xOnlyPubkey)}:null}},3588:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126),i=r(4193),o=r(4194),s=r(4195),u=r(4196),a=r(4197),c=r(4198),f=r(4199),p=r(4200),h=r(4201),l=r(4202),d=r(4203),y=r(4204),w=r(4205),g=r(4206),E=r(3825),S=r(4207),m=r(4208),b=r(4209),_=r(4210),T=r(4211),I={unsignedTx:o,globalXpub:i,checkPubkey:S.makeChecker([])};t.globals=I;const k={nonWitnessUtxo:a,partialSig:c,sighashType:p,finalScriptSig:s,finalScriptWitness:u,porCommitment:f,witnessUtxo:w,bip32Derivation:E.makeConverter(n.InputTypes.BIP32_DERIVATION),redeemScript:m.makeConverter(n.InputTypes.REDEEM_SCRIPT),witnessScript:T.makeConverter(n.InputTypes.WITNESS_SCRIPT),checkPubkey:S.makeChecker([n.InputTypes.PARTIAL_SIG,n.InputTypes.BIP32_DERIVATION]),tapKeySig:h,tapScriptSig:y,tapLeafScript:l,tapBip32Derivation:b.makeConverter(n.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:_.makeConverter(n.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:d};t.inputs=k;const v={bip32Derivation:E.makeConverter(n.OutputTypes.BIP32_DERIVATION),redeemScript:m.makeConverter(n.OutputTypes.REDEEM_SCRIPT),witnessScript:T.makeConverter(n.OutputTypes.WITNESS_SCRIPT),checkPubkey:S.makeChecker([n.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:b.makeConverter(n.OutputTypes.TAP_BIP32_DERIVATION),tapTree:g,tapInternalKey:_.makeConverter(n.OutputTypes.TAP_INTERNAL_KEY)};t.outputs=v},3589:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3292);function i(t){const r=t.key.length,i=t.value.length,o=n.encodingLength(r),s=n.encodingLength(i),u=e.allocUnsafe(o+r+s+i);return n.encode(r,u,0),t.key.copy(u,o),n.encode(i,u,o+r),t.value.copy(u,o+r+s),u}function o(e,t){if("number"!==typeof e)throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}t.range=e=>[...Array(e).keys()],t.reverseBuffer=function(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e},t.keyValsToBuffer=function(t){const r=t.map(i);return r.push(e.from([0])),e.concat(r)},t.keyValToBuffer=i,t.readUInt64LE=function(e,t){const r=e.readUInt32LE(t);let n=e.readUInt32LE(t+4);return n*=4294967296,o(n+r,9007199254740991),n+r},t.writeUInt64LE=function(e,t,r){return o(t,9007199254740991),e.writeInt32LE(-1&t,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}}).call(this,r(22).Buffer)},3590:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3588);function i(e,t){const r=e[t];if(void 0===r)throw new Error("No input #"+t);return r}function o(e,t){const r=e[t];if(void 0===r)throw new Error("No output #"+t);return r}function s(e,t,r,n){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function u(e){return(t,r)=>{for(const i of Object.keys(t)){const o=t[i],{canAdd:u,canAddToArray:a,check:c,expected:f}=n[e+"s"][i]||{},p=!!a;if(c)if(p){if(!Array.isArray(o)||r[i]&&!Array.isArray(r[i]))throw new Error(`Key type ${i} must be an array`);o.every(c)||s(e,i,f,o);const t=r[i]||[],n=new Set;if(!o.every(e=>a(t,e,n)))throw new Error("Can not add duplicate data to array");r[i]=t.concat(o)}else{if(c(o)||s(e,i,f,o),!u(r,o))throw new Error("Can not add duplicate data to "+e);r[i]=o}}}}t.checkForInput=i,t.checkForOutput=o,t.checkHasKey=function(e,t,r){if(e.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&0!==t.filter(t=>t.key.equals(e.key)).length)throw new Error("Duplicate Key: "+e.key.toString("hex"))},t.getEnumLength=function(e){let t=0;return Object.keys(e).forEach(e=>{Number(isNaN(Number(e)))&&t++}),t},t.inputCheckUncleanFinalized=function(e,t){let r=!1;if(t.nonWitnessUtxo||t.witnessUtxo){const e=!!t.redeemScript,n=!!t.witnessScript,i=!e||!!t.finalScriptSig,o=!n||!!t.finalScriptWitness,s=!!t.finalScriptSig||!!t.finalScriptWitness;r=i&&o&&s}if(!1===r)throw new Error(`Input #${e} has too much or too little data to clean`)},t.updateGlobal=u("global"),t.updateInput=u("input"),t.updateOutput=u("output"),t.addInputAttributes=function(e,r){const n=i(e,e.length-1);t.updateInput(r,n)},t.addOutputAttributes=function(e,r){const n=o(e,e.length-1);t.updateOutput(r,n)},t.defaultVersionSetter=function(t,r){if(!e.isBuffer(r)||r.length<4)throw new Error("Set Version: Invalid Transaction");return r.writeUInt32LE(t,0),r},t.defaultLocktimeSetter=function(t,r){if(!e.isBuffer(r)||r.length<4)throw new Error("Set Locktime: Invalid Transaction");return r.writeUInt32LE(t,r.length-4),r}}).call(this,r(22).Buffer)},3591:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.checkTaprootInputForSigs=t.tapTreeFromList=t.tapTreeToList=t.tweakInternalPubKey=t.checkTaprootOutputFields=t.checkTaprootInputFields=t.isTaprootOutput=t.isTaprootInput=t.serializeTaprootSignature=t.tapScriptFinalizer=t.toXOnly=void 0;const n=r(3132),i=r(3384),o=r(3592),s=r(3587),u=r(3383),a=r(3592);function c(e){return e&&!!(e.tapInternalKey||e.tapMerkleRoot||e.tapLeafScript&&e.tapLeafScript.length||e.tapBip32Derivation&&e.tapBip32Derivation.length||e.witnessUtxo&&(0,o.isP2TR)(e.witnessUtxo.script))}function f(e,t){return e&&!!(e.tapInternalKey||e.tapTree||e.tapBip32Derivation&&e.tapBip32Derivation.length||t&&(0,o.isP2TR)(t))}function p(e=[]){return 1===e.length&&0===e[0].depth?{output:e[0].script,version:e[0].leafVersion}:function(e){let t;for(const r of e)if(t=l(r,t),!t)throw new Error("No room left to insert tapleaf in tree");return t}(e)}function h(e){return{signature:e.slice(0,64),hashType:e.slice(64)[0]||i.Transaction.SIGHASH_DEFAULT}}function l(e,t,r=0){if(r>s.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(e.depth===r)return t?void 0:{output:e.script,version:e.leafVersion};if((0,n.isTapleaf)(t))return;const i=l(e,t&&t[0],r+1);if(i)return[i,t&&t[1]];const o=l(e,t&&t[1],r+1);return o?[t&&t[0],o]:void 0}function d(e,t){if(!t)return!0;const r=(0,s.tapleafHash)({output:e.script,version:e.leafVersion});return(0,s.rootHashFromPath)(e.controlBlock,r).equals(t)}function y(e){return e&&!!(e.redeemScript||e.witnessScript||e.bip32Derivation&&e.bip32Derivation.length)}t.toXOnly=e=>32===e.length?e:e.slice(1,33),t.tapScriptFinalizer=function(e,t,r){const n=function(e,t,r){if(!e.tapScriptSig||!e.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${t}. No tapleaf script signature provided.`);const n=(e.tapLeafScript||[]).sort((e,t)=>e.controlBlock.length-t.controlBlock.length).find(t=>function(e,t,r){const n=(0,s.tapleafHash)({output:e.script,version:e.leafVersion});return(!r||r.equals(n))&&void 0!==t.find(e=>e.leafHash.equals(n))}(t,e.tapScriptSig,r));if(!n)throw new Error(`Can not finalize taproot input #${t}. Signature for tapleaf script not found.`);return n}(t,e,r);try{const e=function(e,t){const r=(0,s.tapleafHash)({output:t.script,version:t.leafVersion});return(e.tapScriptSig||[]).filter(e=>e.leafHash.equals(r)).map(e=>function(e,t){return Object.assign({positionInScript:(0,o.pubkeyPositionInScript)(t.pubkey,e)},t)}(t.script,e)).sort((e,t)=>t.positionInScript-e.positionInScript).map(e=>e.signature)}(t,n).concat(n.script).concat(n.controlBlock);return{finalScriptWitness:(0,o.witnessStackToScriptWitness)(e)}}catch(i){throw new Error(`Can not finalize taproot input #${e}: ${i}`)}},t.serializeTaprootSignature=function(t,r){const n=r?e.from([r]):e.from([]);return e.concat([t,n])},t.isTaprootInput=c,t.isTaprootOutput=f,t.checkTaprootInputFields=function(e,t,r){!function(e,t,r){const n=c(e)&&y(t),i=y(e)&&c(t),o=e===t&&c(t)&&y(t);if(n||i||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(e,t,r),function(e,t,r){if(t.tapMerkleRoot){const n=(t.tapLeafScript||[]).every(e=>d(e,t.tapMerkleRoot)),i=(e.tapLeafScript||[]).every(e=>d(e,t.tapMerkleRoot));if(!n||!i)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(e.tapMerkleRoot){if(!(t.tapLeafScript||[]).every(t=>d(t,e.tapMerkleRoot)))throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}}(e,t,r)},t.checkTaprootOutputFields=function(e,t,r){!function(e,t,r){const n=f(e)&&y(t),i=y(e)&&f(t),o=e===t&&f(t)&&y(t);if(n||i||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(e,t,r),function(e,t){if(!t.tapTree&&!t.tapInternalKey)return;const r=t.tapInternalKey||e.tapInternalKey,n=t.tapTree||e.tapTree;if(r){const{script:t}=e,i=function(e,t){const r=t&&p(t.leaves),{output:n}=(0,u.p2tr)({internalPubkey:e,scriptTree:r});return n}(r,n);if(t&&!t.equals(i))throw new Error("Error adding output. Script or address missmatch.")}}(e,t)},t.tweakInternalPubKey=function(e,t){const r=t.tapInternalKey,n=r&&(0,s.tweakKey)(r,t.tapMerkleRoot);if(!n)throw new Error(`Cannot tweak tap internal key for input #${e}. Public key: ${r&&r.toString("hex")}`);return n.x},t.tapTreeToList=function(e){if(!(0,n.isTaptree)(e))throw new Error("Cannot convert taptree to tapleaf list. Expecting a tapree structure.");return function e(t,r=[],i=0){if(i>s.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(!t)return[];if((0,n.isTapleaf)(t))return r.push({depth:i,leafVersion:t.version||s.LEAF_VERSION_TAPSCRIPT,script:t.output}),r;t[0]&&e(t[0],r,i+1);t[1]&&e(t[1],r,i+1);return r}(e)},t.tapTreeFromList=p,t.checkTaprootInputForSigs=function(e,t){return function(e){const t=[];e.tapKeySig&&t.push(e.tapKeySig);e.tapScriptSig&&t.push(...e.tapScriptSig.map(e=>e.signature));if(!t.length){const r=function(e){if(!e)return;const t=e.slice(2);if(64===t.length||65===t.length)return t}(e.finalScriptWitness);r&&t.push(r)}return t}(e).some(e=>(0,a.signatureBlocksAction)(e,h,t))}}).call(this,r(22).Buffer)},3592:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.signatureBlocksAction=t.checkInputForSig=t.pubkeyInScript=t.pubkeyPositionInScript=t.witnessStackToScriptWitness=t.isP2TR=t.isP2SHScript=t.isP2WSHScript=t.isP2WPKH=t.isP2PKH=t.isP2PK=t.isP2MS=void 0;const n=r(3292),i=r(3145),o=r(3384),s=r(3255),u=r(3383);function a(e){return t=>{try{return e({output:t}),!0}catch(r){return!1}}}function c(e,t){const r=(0,s.hash160)(e),n=e.slice(1,33),o=i.decompile(t);if(null===o)throw new Error("Unknown script error");return o.findIndex(t=>"number"!==typeof t&&(t.equals(e)||t.equals(r)||t.equals(n)))}function f(e,t,r){const{hashType:n}=t(e),i=[];n&o.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput");switch(31&n){case o.Transaction.SIGHASH_ALL:break;case o.Transaction.SIGHASH_SINGLE:case o.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}return-1===i.indexOf(r)}t.isP2MS=a(u.p2ms),t.isP2PK=a(u.p2pk),t.isP2PKH=a(u.p2pkh),t.isP2WPKH=a(u.p2wpkh),t.isP2WSHScript=a(u.p2wsh),t.isP2SHScript=a(u.p2sh),t.isP2TR=a(u.p2tr),t.witnessStackToScriptWitness=function(t){let r=e.allocUnsafe(0);function i(t){const i=r.length,o=n.encodingLength(t);r=e.concat([r,e.allocUnsafe(o)]),n.encode(t,r,i)}function o(t){i(t.length),function(t){r=e.concat([r,e.from(t)])}(t)}var s;return i((s=t).length),s.forEach(o),r},t.pubkeyPositionInScript=c,t.pubkeyInScript=function(e,t){return-1!==c(e,t)},t.checkInputForSig=function(t,r){return function(t){let r=[];if(0===(t.partialSig||[]).length){if(!t.finalScriptSig&&!t.finalScriptWitness)return[];r=function(t){const r=t.finalScriptSig&&i.decompile(t.finalScriptSig)||[],n=t.finalScriptWitness&&i.decompile(t.finalScriptWitness)||[];return r.concat(n).filter(t=>e.isBuffer(t)&&i.isCanonicalScriptSignature(t)).map(e=>({signature:e}))}(t)}else r=t.partialSig;return r.map(e=>e.signature)}(t).some(e=>f(e,i.signature.decode,r))},t.signatureBlocksAction=f}).call(this,r(22).Buffer)},3821:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.toOutputScript=t.fromOutputScript=t.toBech32=t.toBase58Check=t.fromBech32=t.fromBase58Check=void 0;const n=r(3203),i=r(3383),o=r(3145),s=r(3132),u=r(296),a=r(3101);function c(e){const t=a.decode(e);if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");return{version:t.readUInt8(0),hash:t.slice(1)}}function f(t){let r,n;try{r=u.bech32.decode(t)}catch(o){}if(r){if(n=r.words[0],0!==n)throw new TypeError(t+" uses wrong encoding")}else if(r=u.bech32m.decode(t),n=r.words[0],0===n)throw new TypeError(t+" uses wrong encoding");const i=u.bech32.fromWords(r.words.slice(1));return{version:n,prefix:r.prefix,data:e.from(i)}}function p(e,t,r){const n=u.bech32.toWords(e);return n.unshift(t),0===t?u.bech32.encode(r,n):u.bech32m.encode(r,n)}t.fromBase58Check=c,t.fromBech32=f,t.toBase58Check=function(t,r){(0,s.typeforce)((0,s.tuple)(s.Hash160bit,s.UInt8),arguments);const n=e.allocUnsafe(21);return n.writeUInt8(r,0),t.copy(n,1),a.encode(n)},t.toBech32=p,t.fromOutputScript=function(e,t){t=t||n.bitcoin;try{return i.p2pkh({output:e,network:t}).address}catch(r){}try{return i.p2sh({output:e,network:t}).address}catch(r){}try{return i.p2wpkh({output:e,network:t}).address}catch(r){}try{return i.p2wsh({output:e,network:t}).address}catch(r){}try{return i.p2tr({output:e,network:t}).address}catch(r){}try{return function(e,t){const r=e.slice(2);if(r.length<2||r.length>40)throw new TypeError("Invalid program length for segwit address");const n=e[0]-80;if(n<2||n>16)throw new TypeError("Invalid version for segwit address");if(e[1]!==r.length)throw new TypeError("Invalid script for segwit address");return p(r,n,t.bech32)}(e,t)}catch(r){}throw new Error(o.toASM(e)+" has no matching Address")},t.toOutputScript=function(e,t){let r,s;t=t||n.bitcoin;try{r=c(e)}catch(u){}if(r){if(r.version===t.pubKeyHash)return i.p2pkh({hash:r.hash}).output;if(r.version===t.scriptHash)return i.p2sh({hash:r.hash}).output}else{try{s=f(e)}catch(u){}if(s){if(s.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(0===s.version){if(20===s.data.length)return i.p2wpkh({hash:s.data}).output;if(32===s.data.length)return i.p2wsh({hash:s.data}).output}else if(1===s.version){if(32===s.data.length)return i.p2tr({pubkey:s.data}).output}else if(s.version>=2&&s.version<=16&&s.data.length>=2&&s.data.length<=40)return o.compile([s.version+80,s.data])}}throw new Error(e+" has no matching Script")}}).call(this,r(22).Buffer)},3822:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decode=t.check=void 0,t.check=function(e){if(e.length<8)return!1;if(e.length>72)return!1;if(48!==e[0])return!1;if(e[1]!==e.length-2)return!1;if(2!==e[2])return!1;const t=e[3];if(0===t)return!1;if(5+t>=e.length)return!1;if(2!==e[4+t])return!1;const r=e[5+t];return 0!==r&&(6+t+r===e.length&&(!(128&e[4])&&(!(t>1&&0===e[4]&&!(128&e[5]))&&(!(128&e[t+6])&&!(r>1&&0===e[t+6]&&!(128&e[t+7]))))))},t.decode=function(e){if(e.length<8)throw new Error("DER sequence length is too short");if(e.length>72)throw new Error("DER sequence length is too long");if(48!==e[0])throw new Error("Expected DER sequence");if(e[1]!==e.length-2)throw new Error("DER sequence length is invalid");if(2!==e[2])throw new Error("Expected DER integer");const t=e[3];if(0===t)throw new Error("R length is zero");if(5+t>=e.length)throw new Error("R length is too long");if(2!==e[4+t])throw new Error("Expected DER integer (2)");const r=e[5+t];if(0===r)throw new Error("S length is zero");if(6+t+r!==e.length)throw new Error("S length is invalid");if(128&e[4])throw new Error("R value is negative");if(t>1&&0===e[4]&&!(128&e[5]))throw new Error("R value excessively padded");if(128&e[t+6])throw new Error("S value is negative");if(r>1&&0===e[t+6]&&!(128&e[t+7]))throw new Error("S value excessively padded");return{r:e.slice(4,4+t),s:e.slice(6+t)}},t.encode=function(t,r){const n=t.length,i=r.length;if(0===n)throw new Error("R length is zero");if(0===i)throw new Error("S length is zero");if(n>33)throw new Error("R length is too long");if(i>33)throw new Error("S length is too long");if(128&t[0])throw new Error("R value is negative");if(128&r[0])throw new Error("S value is negative");if(n>1&&0===t[0]&&!(128&t[1]))throw new Error("R value excessively padded");if(i>1&&0===r[0]&&!(128&r[1]))throw new Error("S value excessively padded");const o=e.allocUnsafe(6+n+i);return o[0]=48,o[1]=o.length-2,o[2]=2,o[3]=t.length,t.copy(o,4),o[4+n]=2,o[5+n]=r.length,r.copy(o,6+n),o}}).call(this,r(22).Buffer)},3823:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(4191),i=r(3824),o=r(3126),s=r(3590);t.Psbt=class{constructor(e){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:e}}static fromBase64(t,r){const n=e.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r){const n=e.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(e,t){const r=i.psbtFromBuffer(e,t),n=new this(r.globalMap.unsignedTx);return Object.assign(n,r),n}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return i.psbtToBuffer(this)}updateGlobal(e){return s.updateGlobal(e,this.globalMap),this}updateInput(e,t){const r=s.checkForInput(this.inputs,e);return s.updateInput(t,r),this}updateOutput(e,t){const r=s.checkForOutput(this.outputs,e);return s.updateOutput(t,r),this}addUnknownKeyValToGlobal(e){return s.checkHasKey(e,this.globalMap.unknownKeyVals,s.getEnumLength(o.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(e),this}addUnknownKeyValToInput(e,t){const r=s.checkForInput(this.inputs,e);return s.checkHasKey(t,r.unknownKeyVals,s.getEnumLength(o.InputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addUnknownKeyValToOutput(e,t){const r=s.checkForOutput(this.outputs,e);return s.checkHasKey(t,r.unknownKeyVals,s.getEnumLength(o.OutputTypes)),r.unknownKeyVals||(r.unknownKeyVals=[]),r.unknownKeyVals.push(t),this}addInput(e){this.globalMap.unsignedTx.addInput(e),this.inputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.inputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach(e=>this.addUnknownKeyValToInput(r,e)),s.addInputAttributes(this.inputs,e),this}addOutput(e){this.globalMap.unsignedTx.addOutput(e),this.outputs.push({unknownKeyVals:[]});const t=e.unknownKeyVals||[],r=this.outputs.length-1;if(!Array.isArray(t))throw new Error("unknownKeyVals must be an Array");return t.forEach(e=>this.addUnknownKeyValToInput(r,e)),s.addOutputAttributes(this.outputs,e),this}clearFinalizedInput(e){const t=s.checkForInput(this.inputs,e);s.inputCheckUncleanFinalized(e,t);for(const r of Object.keys(t))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(r)||delete t[r];return this}combine(...e){const t=n.combine([this].concat(e));return Object.assign(this,t),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}}}).call(this,r(22).Buffer)},3824:function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(4192)),n(r(4212))},3825:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const r=e=>33===e.length&&[2,3].includes(e[0])||65===e.length&&4===e[0];t.makeConverter=function(t,n=r){return{decode:function(e){if(e.key[0]!==t)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+e.key.toString("hex"));const r=e.key.slice(1);if(!n(r))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!==0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");const i={masterFingerprint:e.value.slice(0,4),pubkey:r,path:"m"};for(const t of(o=e.value.length/4-1,[...Array(o).keys()])){const r=e.value.readUInt32LE(4*t+4),n=!!(2147483648&r),o=2147483647&r;i.path+="/"+o.toString(10)+(n?"'":"")}var o;return i},encode:function(r){const n=e.from([t]),i=e.concat([n,r.pubkey]),o=r.path.split("/"),s=e.allocUnsafe(4*o.length);r.masterFingerprint.copy(s,0);let u=4;return o.slice(1).forEach(e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),s.writeUInt32LE(r,u),u+=4}),{key:i,value:s}},check:function(t){return e.isBuffer(t.pubkey)&&e.isBuffer(t.masterFingerprint)&&"string"===typeof t.path&&n(t.pubkey)&&4===t.masterFingerprint.length},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }",canAddToArray:function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.pubkey.equals(t.pubkey)).length)}}}}).call(this,r(22).Buffer)},4173:function(e,t,r){var n=r(4174),i=r(4175),o=r(3453);function s(e,t){return e.value-t*o.inputBytes(e)}e.exports=function(e,t,r){e=e.concat().sort((function(e,t){return s(t,r)-s(e,r)}));var o=i(e,t,r);return o.inputs?o:n(e,t,r)}},4174:function(e,t,r){var n=r(3453);e.exports=function(e,t,r){if(!isFinite(n.uintOrNaN(r)))return{};for(var i=n.transactionBytes([],t),o=0,s=[],u=n.sumOrNaN(t),a=0;a<e.length;++a){var c=e[a],f=n.inputBytes(c),p=r*f,h=n.uintOrNaN(c.value);if(p>c.value){if(a===e.length-1)return{fee:r*(i+f)}}else if(i+=f,o+=h,s.push(c),!(o<u+r*i))return n.finalize(s,t,r)}return{fee:r*i}}},4175:function(e,t,r){var n=r(3453);e.exports=function(e,t,r){if(!isFinite(n.uintOrNaN(r)))return{};for(var i=n.transactionBytes([],t),o=0,s=[],u=n.sumOrNaN(t),a=n.dustThreshold({},r),c=0;c<e.length;++c){var f=e[c],p=n.inputBytes(f),h=r*(i+p),l=n.uintOrNaN(f.value);if(!(o+l>u+h+a)&&(i+=p,o+=l,s.push(f),!(o<u+h)))return n.finalize(s,t,r)}return{fee:r*i}}},4176:function(e,t,r){var n=r(3453);e.exports=function(e,t,r){if(!isFinite(n.uintOrNaN(r)))return{};var i=n.transactionBytes(e,t),o=r*i;if(0===t.length)return{fee:o};var s=n.sumOrNaN(e)-n.sumForgiving(t)-o;if(!isFinite(s)||s<0)return{fee:o};var u=t.reduce((function(e,t){return e+!isFinite(t.value)}),0);if(0===s&&0===u)return n.finalize(e,t,r);var a=t.reduce((function(e,t){return e+!t.value}),0),c=Math.floor(s/a);return t.every((function(e){return void 0!==e.value||c>n.dustThreshold(e,r)}))?(t=t.map((function(e){if(void 0!==e.value)return e;var t={};for(var r in e)t[r]=e[r];return t.value=c,t})),n.finalize(e,t,r)):{fee:o}}},4177:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.p2data=void 0;const n=r(3203),i=r(3145),o=r(3132),s=r(3291),u=i.OPS;t.p2data=function(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,o.typeforce)({network:o.typeforce.maybe(o.typeforce.Object),output:o.typeforce.maybe(o.typeforce.Buffer),data:o.typeforce.maybe(o.typeforce.arrayOf(o.typeforce.Buffer))},e);const r={name:"embed",network:e.network||n.bitcoin};if(s.prop(r,"output",()=>{if(e.data)return i.compile([u.OP_RETURN].concat(e.data))}),s.prop(r,"data",()=>{if(e.output)return i.decompile(e.output).slice(1)}),t.validate&&e.output){const t=i.decompile(e.output);if(t[0]!==u.OP_RETURN)throw new TypeError("Output is invalid");if(!t.slice(1).every(o.typeforce.Buffer))throw new TypeError("Output is invalid");if(e.data&&!function(e,t){return e.length===t.length&&e.every((e,r)=>e.equals(t[r]))}(e.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,e)}},4178:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=t.encodingLength=void 0;const n=r(3585);function i(e){return e<n.OPS.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}t.encodingLength=i,t.encode=function(e,t,r){const o=i(t);return 1===o?e.writeUInt8(t,r):2===o?(e.writeUInt8(n.OPS.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):3===o?(e.writeUInt8(n.OPS.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(n.OPS.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),o},t.decode=function(e,t){const r=e.readUInt8(t);let i,o;if(r<n.OPS.OP_PUSHDATA1)i=r,o=1;else if(r===n.OPS.OP_PUSHDATA1){if(t+2>e.length)return null;i=e.readUInt8(t+1),o=2}else if(r===n.OPS.OP_PUSHDATA2){if(t+3>e.length)return null;i=e.readUInt16LE(t+1),o=3}else{if(t+5>e.length)return null;if(r!==n.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");i=e.readUInt32LE(t+1),o=5}return{opcode:r,number:i,size:o}}},4179:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decode=void 0,t.decode=function(e,t,r){t=t||4,r=void 0===r||r;const n=e.length;if(0===n)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&0===(127&e[n-1])&&(n<=1||0===(128&e[n-2])))throw new Error("Non-minimally encoded script number");if(5===n){const t=e.readUInt32LE(0),r=e.readUInt8(4);return 128&r?-(4294967296*(-129&r)+t):4294967296*r+t}let i=0;for(let o=0;o<n;++o)i|=e[o]<<8*o;return 128&e[n-1]?-(i&~(128<<8*(n-1))):i},t.encode=function(t){let r=Math.abs(t);const n=(i=r)>2147483647?5:i>8388607?4:i>32767?3:i>127?2:i>0?1:0;var i;const o=e.allocUnsafe(n),s=t<0;for(let e=0;e<n;++e)o.writeUInt8(255&r,e),r>>=8;return 128&o[n-1]?o.writeUInt8(s?128:0,n-1):s&&(o[n-1]|=128),o}}).call(this,r(22).Buffer)},4180:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decode=void 0;const n=r(3822),i=r(3132),{typeforce:o}=i,s=e.alloc(1,0);function u(t){let r=0;for(;0===t[r];)++r;return r===t.length?s:128&(t=t.slice(r))[0]?e.concat([s,t],1+t.length):t}function a(t){0===t[0]&&(t=t.slice(1));const r=e.alloc(32,0),n=Math.max(0,32-t.length);return t.copy(r,n),r}t.decode=function(t){const r=t.readUInt8(t.length-1),i=-129&r;if(i<=0||i>=4)throw new Error("Invalid hashType "+r);const o=n.decode(t.slice(0,-1)),s=a(o.r),u=a(o.s);return{signature:e.concat([s,u],64),hashType:r}},t.encode=function(t,r){o({signature:i.BufferN(64),hashType:i.UInt8},{signature:t,hashType:r});const s=-129&r;if(s<=0||s>=4)throw new Error("Invalid hashType "+r);const a=e.allocUnsafe(1);a.writeUInt8(r,0);const c=u(t.slice(0,32)),f=u(t.slice(32,64));return e.concat([n.encode(c,f),a])}}).call(this,r(22).Buffer)},4181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.p2ms=void 0;const n=r(3203),i=r(3145),o=r(3132),s=r(3291),u=i.OPS,a=u.OP_RESERVED;function c(e,t){return e.length===t.length&&e.every((e,r)=>e.equals(t[r]))}t.p2ms=function(e,t){if(!e.input&&!e.output&&(!e.pubkeys||void 0===e.m)&&!e.signatures)throw new TypeError("Not enough data");function r(e){return i.isCanonicalScriptSignature(e)||void 0!==(t.allowIncomplete&&e===u.OP_0)}t=Object.assign({validate:!0},t||{}),(0,o.typeforce)({network:o.typeforce.maybe(o.typeforce.Object),m:o.typeforce.maybe(o.typeforce.Number),n:o.typeforce.maybe(o.typeforce.Number),output:o.typeforce.maybe(o.typeforce.Buffer),pubkeys:o.typeforce.maybe(o.typeforce.arrayOf(o.isPoint)),signatures:o.typeforce.maybe(o.typeforce.arrayOf(r)),input:o.typeforce.maybe(o.typeforce.Buffer)},e);const f={network:e.network||n.bitcoin};let p=[],h=!1;function l(e){h||(h=!0,p=i.decompile(e),f.m=p[0]-a,f.n=p[p.length-2]-a,f.pubkeys=p.slice(1,-2))}if(s.prop(f,"output",()=>{if(e.m&&f.n&&e.pubkeys)return i.compile([].concat(a+e.m,e.pubkeys,a+f.n,u.OP_CHECKMULTISIG))}),s.prop(f,"m",()=>{if(f.output)return l(f.output),f.m}),s.prop(f,"n",()=>{if(f.pubkeys)return f.pubkeys.length}),s.prop(f,"pubkeys",()=>{if(e.output)return l(e.output),f.pubkeys}),s.prop(f,"signatures",()=>{if(e.input)return i.decompile(e.input).slice(1)}),s.prop(f,"input",()=>{if(e.signatures)return i.compile([u.OP_0].concat(e.signatures))}),s.prop(f,"witness",()=>{if(f.input)return[]}),s.prop(f,"name",()=>{if(f.m&&f.n)return`p2ms(${f.m} of ${f.n})`}),t.validate){if(e.output){if(l(e.output),!o.typeforce.Number(p[0]))throw new TypeError("Output is invalid");if(!o.typeforce.Number(p[p.length-2]))throw new TypeError("Output is invalid");if(p[p.length-1]!==u.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(f.m<=0||f.n>16||f.m>f.n||f.n!==p.length-3)throw new TypeError("Output is invalid");if(!f.pubkeys.every(e=>(0,o.isPoint)(e)))throw new TypeError("Output is invalid");if(void 0!==e.m&&e.m!==f.m)throw new TypeError("m mismatch");if(void 0!==e.n&&e.n!==f.n)throw new TypeError("n mismatch");if(e.pubkeys&&!c(e.pubkeys,f.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(void 0!==e.n&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(f.n=e.pubkeys.length,f.n<f.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<f.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>f.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==u.OP_0)throw new TypeError("Input is invalid");if(0===f.signatures.length||!f.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!c(e.signatures,f.signatures))throw new TypeError("Signature mismatch");if(void 0!==e.m&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(f,e)}},4182:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.p2pk=void 0;const n=r(3203),i=r(3145),o=r(3132),s=r(3291),u=i.OPS;t.p2pk=function(e,t){if(!e.input&&!e.output&&!e.pubkey&&!e.input&&!e.signature)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,o.typeforce)({network:o.typeforce.maybe(o.typeforce.Object),output:o.typeforce.maybe(o.typeforce.Buffer),pubkey:o.typeforce.maybe(o.isPoint),signature:o.typeforce.maybe(i.isCanonicalScriptSignature),input:o.typeforce.maybe(o.typeforce.Buffer)},e);const r=s.value(()=>i.decompile(e.input)),a={name:"p2pk",network:e.network||n.bitcoin};if(s.prop(a,"output",()=>{if(e.pubkey)return i.compile([e.pubkey,u.OP_CHECKSIG])}),s.prop(a,"pubkey",()=>{if(e.output)return e.output.slice(1,-1)}),s.prop(a,"signature",()=>{if(e.input)return r()[0]}),s.prop(a,"input",()=>{if(e.signature)return i.compile([e.signature])}),s.prop(a,"witness",()=>{if(a.input)return[]}),t.validate){if(e.output){if(e.output[e.output.length-1]!==u.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,o.isPoint)(a.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(a.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(a.input))throw new TypeError("Signature mismatch");if(e.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!i.isCanonicalScriptSignature(a.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(a,e)}},4183:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.p2pkh=void 0;const n=r(3255),i=r(3203),o=r(3145),s=r(3132),u=r(3291),a=r(3101),c=o.OPS;t.p2pkh=function(t,r){if(!t.address&&!t.hash&&!t.output&&!t.pubkey&&!t.input)throw new TypeError("Not enough data");r=Object.assign({validate:!0},r||{}),(0,s.typeforce)({network:s.typeforce.maybe(s.typeforce.Object),address:s.typeforce.maybe(s.typeforce.String),hash:s.typeforce.maybe(s.typeforce.BufferN(20)),output:s.typeforce.maybe(s.typeforce.BufferN(25)),pubkey:s.typeforce.maybe(s.isPoint),signature:s.typeforce.maybe(o.isCanonicalScriptSignature),input:s.typeforce.maybe(s.typeforce.Buffer)},t);const f=u.value(()=>{const e=a.decode(t.address);return{version:e.readUInt8(0),hash:e.slice(1)}}),p=u.value(()=>o.decompile(t.input)),h=t.network||i.bitcoin,l={name:"p2pkh",network:h};if(u.prop(l,"address",()=>{if(!l.hash)return;const t=e.allocUnsafe(21);return t.writeUInt8(h.pubKeyHash,0),l.hash.copy(t,1),a.encode(t)}),u.prop(l,"hash",()=>t.output?t.output.slice(3,23):t.address?f().hash:t.pubkey||l.pubkey?n.hash160(t.pubkey||l.pubkey):void 0),u.prop(l,"output",()=>{if(l.hash)return o.compile([c.OP_DUP,c.OP_HASH160,l.hash,c.OP_EQUALVERIFY,c.OP_CHECKSIG])}),u.prop(l,"pubkey",()=>{if(t.input)return p()[1]}),u.prop(l,"signature",()=>{if(t.input)return p()[0]}),u.prop(l,"input",()=>{if(t.pubkey&&t.signature)return o.compile([t.signature,t.pubkey])}),u.prop(l,"witness",()=>{if(l.input)return[]}),r.validate){let r=e.from([]);if(t.address){if(f().version!==h.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==f().hash.length)throw new TypeError("Invalid address");r=f().hash}if(t.hash){if(r.length>0&&!r.equals(t.hash))throw new TypeError("Hash mismatch");r=t.hash}if(t.output){if(25!==t.output.length||t.output[0]!==c.OP_DUP||t.output[1]!==c.OP_HASH160||20!==t.output[2]||t.output[23]!==c.OP_EQUALVERIFY||t.output[24]!==c.OP_CHECKSIG)throw new TypeError("Output is invalid");const e=t.output.slice(3,23);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch");r=e}if(t.pubkey){const e=n.hash160(t.pubkey);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch");r=e}if(t.input){const e=p();if(2!==e.length)throw new TypeError("Input is invalid");if(!o.isCanonicalScriptSignature(e[0]))throw new TypeError("Input has invalid signature");if(!(0,s.isPoint)(e[1]))throw new TypeError("Input has invalid pubkey");if(t.signature&&!t.signature.equals(e[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(e[1]))throw new TypeError("Pubkey mismatch");const i=n.hash160(e[1]);if(r.length>0&&!r.equals(i))throw new TypeError("Hash mismatch")}}return Object.assign(l,t)}}).call(this,r(22).Buffer)},4184:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.p2sh=void 0;const n=r(3255),i=r(3203),o=r(3145),s=r(3132),u=r(3291),a=r(3101),c=o.OPS;t.p2sh=function(t,r){if(!t.address&&!t.hash&&!t.output&&!t.redeem&&!t.input)throw new TypeError("Not enough data");r=Object.assign({validate:!0},r||{}),(0,s.typeforce)({network:s.typeforce.maybe(s.typeforce.Object),address:s.typeforce.maybe(s.typeforce.String),hash:s.typeforce.maybe(s.typeforce.BufferN(20)),output:s.typeforce.maybe(s.typeforce.BufferN(23)),redeem:s.typeforce.maybe({network:s.typeforce.maybe(s.typeforce.Object),output:s.typeforce.maybe(s.typeforce.Buffer),input:s.typeforce.maybe(s.typeforce.Buffer),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer))}),input:s.typeforce.maybe(s.typeforce.Buffer),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer))},t);let f=t.network;f||(f=t.redeem&&t.redeem.network||i.bitcoin);const p={network:f},h=u.value(()=>{const e=a.decode(t.address);return{version:e.readUInt8(0),hash:e.slice(1)}}),l=u.value(()=>o.decompile(t.input)),d=u.value(()=>{const r=l(),n=r[r.length-1];return{network:f,output:n===c.OP_FALSE?e.from([]):n,input:o.compile(r.slice(0,-1)),witness:t.witness||[]}});if(u.prop(p,"address",()=>{if(!p.hash)return;const t=e.allocUnsafe(21);return t.writeUInt8(p.network.scriptHash,0),p.hash.copy(t,1),a.encode(t)}),u.prop(p,"hash",()=>t.output?t.output.slice(2,22):t.address?h().hash:p.redeem&&p.redeem.output?n.hash160(p.redeem.output):void 0),u.prop(p,"output",()=>{if(p.hash)return o.compile([c.OP_HASH160,p.hash,c.OP_EQUAL])}),u.prop(p,"redeem",()=>{if(t.input)return d()}),u.prop(p,"input",()=>{if(t.redeem&&t.redeem.input&&t.redeem.output)return o.compile([].concat(o.decompile(t.redeem.input),t.redeem.output))}),u.prop(p,"witness",()=>p.redeem&&p.redeem.witness?p.redeem.witness:p.input?[]:void 0),u.prop(p,"name",()=>{const e=["p2sh"];return void 0!==p.redeem&&void 0!==p.redeem.name&&e.push(p.redeem.name),e.join("-")}),r.validate){let r=e.from([]);if(t.address){if(h().version!==f.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==h().hash.length)throw new TypeError("Invalid address");r=h().hash}if(t.hash){if(r.length>0&&!r.equals(t.hash))throw new TypeError("Hash mismatch");r=t.hash}if(t.output){if(23!==t.output.length||t.output[0]!==c.OP_HASH160||20!==t.output[1]||t.output[22]!==c.OP_EQUAL)throw new TypeError("Output is invalid");const e=t.output.slice(2,22);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch");r=e}const i=e=>{if(e.output){const t=o.decompile(e.output);if(!t||t.length<1)throw new TypeError("Redeem.output too short");const i=n.hash160(e.output);if(r.length>0&&!r.equals(i))throw new TypeError("Hash mismatch");r=i}if(e.input){const t=e.input.length>0,r=e.witness&&e.witness.length>0;if(!t&&!r)throw new TypeError("Empty input");if(t&&r)throw new TypeError("Input and witness provided");if(t){const t=o.decompile(e.input);if(!o.isPushOnly(t))throw new TypeError("Non push-only scriptSig")}}};if(t.input){const t=l();if(!t||t.length<1)throw new TypeError("Input too short");if(!e.isBuffer(d().output))throw new TypeError("Input is invalid");i(d())}if(t.redeem){if(t.redeem.network&&t.redeem.network!==f)throw new TypeError("Network mismatch");if(t.input){const e=d();if(t.redeem.output&&!t.redeem.output.equals(e.output))throw new TypeError("Redeem.output mismatch");if(t.redeem.input&&!t.redeem.input.equals(e.input))throw new TypeError("Redeem.input mismatch")}i(t.redeem)}if(t.witness&&t.redeem&&t.redeem.witness&&!function(e,t){return e.length===t.length&&e.every((e,r)=>e.equals(t[r]))}(t.redeem.witness,t.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(p,t)}}).call(this,r(22).Buffer)},4185:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.p2wpkh=void 0;const n=r(3255),i=r(3203),o=r(3145),s=r(3132),u=r(3291),a=r(296),c=o.OPS,f=e.alloc(0);t.p2wpkh=function(t,r){if(!t.address&&!t.hash&&!t.output&&!t.pubkey&&!t.witness)throw new TypeError("Not enough data");r=Object.assign({validate:!0},r||{}),(0,s.typeforce)({address:s.typeforce.maybe(s.typeforce.String),hash:s.typeforce.maybe(s.typeforce.BufferN(20)),input:s.typeforce.maybe(s.typeforce.BufferN(0)),network:s.typeforce.maybe(s.typeforce.Object),output:s.typeforce.maybe(s.typeforce.BufferN(22)),pubkey:s.typeforce.maybe(s.isPoint),signature:s.typeforce.maybe(o.isCanonicalScriptSignature),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer))},t);const p=u.value(()=>{const r=a.bech32.decode(t.address),n=r.words.shift(),i=a.bech32.fromWords(r.words);return{version:n,prefix:r.prefix,data:e.from(i)}}),h=t.network||i.bitcoin,l={name:"p2wpkh",network:h};if(u.prop(l,"address",()=>{if(!l.hash)return;const e=a.bech32.toWords(l.hash);return e.unshift(0),a.bech32.encode(h.bech32,e)}),u.prop(l,"hash",()=>t.output?t.output.slice(2,22):t.address?p().data:t.pubkey||l.pubkey?n.hash160(t.pubkey||l.pubkey):void 0),u.prop(l,"output",()=>{if(l.hash)return o.compile([c.OP_0,l.hash])}),u.prop(l,"pubkey",()=>t.pubkey?t.pubkey:t.witness?t.witness[1]:void 0),u.prop(l,"signature",()=>{if(t.witness)return t.witness[0]}),u.prop(l,"input",()=>{if(l.witness)return f}),u.prop(l,"witness",()=>{if(t.pubkey&&t.signature)return[t.signature,t.pubkey]}),r.validate){let r=e.from([]);if(t.address){if(h&&h.bech32!==p().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==p().version)throw new TypeError("Invalid address version");if(20!==p().data.length)throw new TypeError("Invalid address data");r=p().data}if(t.hash){if(r.length>0&&!r.equals(t.hash))throw new TypeError("Hash mismatch");r=t.hash}if(t.output){if(22!==t.output.length||t.output[0]!==c.OP_0||20!==t.output[1])throw new TypeError("Output is invalid");if(r.length>0&&!r.equals(t.output.slice(2)))throw new TypeError("Hash mismatch");r=t.output.slice(2)}if(t.pubkey){const e=n.hash160(t.pubkey);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch");if(r=e,!(0,s.isPoint)(t.pubkey)||33!==t.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(t.witness){if(2!==t.witness.length)throw new TypeError("Witness is invalid");if(!o.isCanonicalScriptSignature(t.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,s.isPoint)(t.witness[1])||33!==t.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(t.signature&&!t.signature.equals(t.witness[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(t.witness[1]))throw new TypeError("Pubkey mismatch");const e=n.hash160(t.witness[1]);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch")}}return Object.assign(l,t)}}).call(this,r(22).Buffer)},4186:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.p2wsh=void 0;const n=r(3255),i=r(3203),o=r(3145),s=r(3132),u=r(3291),a=r(296),c=o.OPS,f=e.alloc(0);function p(t){return!(!e.isBuffer(t)||65!==t.length||4!==t[0]||!(0,s.isPoint)(t))}t.p2wsh=function(t,r){if(!t.address&&!t.hash&&!t.output&&!t.redeem&&!t.witness)throw new TypeError("Not enough data");r=Object.assign({validate:!0},r||{}),(0,s.typeforce)({network:s.typeforce.maybe(s.typeforce.Object),address:s.typeforce.maybe(s.typeforce.String),hash:s.typeforce.maybe(s.typeforce.BufferN(32)),output:s.typeforce.maybe(s.typeforce.BufferN(34)),redeem:s.typeforce.maybe({input:s.typeforce.maybe(s.typeforce.Buffer),network:s.typeforce.maybe(s.typeforce.Object),output:s.typeforce.maybe(s.typeforce.Buffer),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer))}),input:s.typeforce.maybe(s.typeforce.BufferN(0)),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer))},t);const h=u.value(()=>{const r=a.bech32.decode(t.address),n=r.words.shift(),i=a.bech32.fromWords(r.words);return{version:n,prefix:r.prefix,data:e.from(i)}}),l=u.value(()=>o.decompile(t.redeem.input));let d=t.network;d||(d=t.redeem&&t.redeem.network||i.bitcoin);const y={network:d};if(u.prop(y,"address",()=>{if(!y.hash)return;const e=a.bech32.toWords(y.hash);return e.unshift(0),a.bech32.encode(d.bech32,e)}),u.prop(y,"hash",()=>t.output?t.output.slice(2):t.address?h().data:y.redeem&&y.redeem.output?n.sha256(y.redeem.output):void 0),u.prop(y,"output",()=>{if(y.hash)return o.compile([c.OP_0,y.hash])}),u.prop(y,"redeem",()=>{if(t.witness)return{output:t.witness[t.witness.length-1],input:f,witness:t.witness.slice(0,-1)}}),u.prop(y,"input",()=>{if(y.witness)return f}),u.prop(y,"witness",()=>{if(t.redeem&&t.redeem.input&&t.redeem.input.length>0&&t.redeem.output&&t.redeem.output.length>0){const e=o.toStack(l());return y.redeem=Object.assign({witness:e},t.redeem),y.redeem.input=f,[].concat(e,t.redeem.output)}if(t.redeem&&t.redeem.output&&t.redeem.witness)return[].concat(t.redeem.witness,t.redeem.output)}),u.prop(y,"name",()=>{const e=["p2wsh"];return void 0!==y.redeem&&void 0!==y.redeem.name&&e.push(y.redeem.name),e.join("-")}),r.validate){let r=e.from([]);if(t.address){if(h().prefix!==d.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==h().version)throw new TypeError("Invalid address version");if(32!==h().data.length)throw new TypeError("Invalid address data");r=h().data}if(t.hash){if(r.length>0&&!r.equals(t.hash))throw new TypeError("Hash mismatch");r=t.hash}if(t.output){if(34!==t.output.length||t.output[0]!==c.OP_0||32!==t.output[1])throw new TypeError("Output is invalid");const e=t.output.slice(2);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch");r=e}if(t.redeem){if(t.redeem.network&&t.redeem.network!==d)throw new TypeError("Network mismatch");if(t.redeem.input&&t.redeem.input.length>0&&t.redeem.witness&&t.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(t.redeem.output){if(0===o.decompile(t.redeem.output).length)throw new TypeError("Redeem.output is invalid");const e=n.sha256(t.redeem.output);if(r.length>0&&!r.equals(e))throw new TypeError("Hash mismatch");r=e}if(t.redeem.input&&!o.isPushOnly(l()))throw new TypeError("Non push-only scriptSig");if(t.witness&&t.redeem.witness&&!function(e,t){return e.length===t.length&&e.every((e,r)=>e.equals(t[r]))}(t.witness,t.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(t.redeem.input&&l().some(p)||t.redeem.output&&(o.decompile(t.redeem.output)||[]).some(p))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(t.witness&&t.witness.length>0){const e=t.witness[t.witness.length-1];if(t.redeem&&t.redeem.output&&!t.redeem.output.equals(e))throw new TypeError("Witness and redeem.output mismatch");if(t.witness.some(p)||(o.decompile(e)||[]).some(p))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(y,t)}}).call(this,r(22).Buffer)},4187:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.p2tr=void 0;const n=r(22),i=r(3203),o=r(3145),s=r(3132),u=r(3586),a=r(3587),c=r(3291),f=r(296),p=o.OPS;t.p2tr=function(e,t){if(!e.address&&!e.output&&!e.pubkey&&!e.internalPubkey&&!(e.witness&&e.witness.length>1))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,s.typeforce)({address:s.typeforce.maybe(s.typeforce.String),input:s.typeforce.maybe(s.typeforce.BufferN(0)),network:s.typeforce.maybe(s.typeforce.Object),output:s.typeforce.maybe(s.typeforce.BufferN(34)),internalPubkey:s.typeforce.maybe(s.typeforce.BufferN(32)),hash:s.typeforce.maybe(s.typeforce.BufferN(32)),pubkey:s.typeforce.maybe(s.typeforce.BufferN(32)),signature:s.typeforce.maybe(s.typeforce.BufferN(64)),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer)),scriptTree:s.typeforce.maybe(s.isTaptree),redeem:s.typeforce.maybe({output:s.typeforce.maybe(s.typeforce.Buffer),redeemVersion:s.typeforce.maybe(s.typeforce.Number),witness:s.typeforce.maybe(s.typeforce.arrayOf(s.typeforce.Buffer))}),redeemVersion:s.typeforce.maybe(s.typeforce.Number)},e);const r=c.value(()=>{const t=f.bech32m.decode(e.address),r=t.words.shift(),i=f.bech32m.fromWords(t.words);return{version:r,prefix:t.prefix,data:n.Buffer.from(i)}}),h=c.value(()=>{if(e.witness&&e.witness.length)return e.witness.length>=2&&80===e.witness[e.witness.length-1][0]?e.witness.slice(0,-1):e.witness.slice()}),l=c.value(()=>e.scriptTree?(0,a.toHashTree)(e.scriptTree):e.hash?{hash:e.hash}:void 0),d=e.network||i.bitcoin,y={name:"p2tr",network:d};if(c.prop(y,"address",()=>{if(!y.pubkey)return;const e=f.bech32m.toWords(y.pubkey);return e.unshift(1),f.bech32m.encode(d.bech32,e)}),c.prop(y,"hash",()=>{const e=l();if(e)return e.hash;const t=h();if(t&&t.length>1){const e=t[t.length-1],r=e[0]&s.TAPLEAF_VERSION_MASK,n=t[t.length-2],i=(0,a.tapleafHash)({output:n,version:r});return(0,a.rootHashFromPath)(e,i)}return null}),c.prop(y,"output",()=>{if(y.pubkey)return o.compile([p.OP_1,y.pubkey])}),c.prop(y,"redeemVersion",()=>e.redeemVersion?e.redeemVersion:e.redeem&&void 0!==e.redeem.redeemVersion&&null!==e.redeem.redeemVersion?e.redeem.redeemVersion:a.LEAF_VERSION_TAPSCRIPT),c.prop(y,"redeem",()=>{const e=h();if(e&&!(e.length<2))return{output:e[e.length-2],witness:e.slice(0,-2),redeemVersion:e[e.length-1][0]&s.TAPLEAF_VERSION_MASK}}),c.prop(y,"pubkey",()=>{if(e.pubkey)return e.pubkey;if(e.output)return e.output.slice(2);if(e.address)return r().data;if(y.internalPubkey){const e=(0,a.tweakKey)(y.internalPubkey,y.hash);if(e)return e.x}}),c.prop(y,"internalPubkey",()=>{if(e.internalPubkey)return e.internalPubkey;const t=h();return t&&t.length>1?t[t.length-1].slice(1,33):void 0}),c.prop(y,"signature",()=>{if(e.signature)return e.signature;const t=h();return t&&1===t.length?t[0]:void 0}),c.prop(y,"witness",()=>{if(e.witness)return e.witness;const t=l();if(t&&e.redeem&&e.redeem.output&&e.internalPubkey){const r=(0,a.tapleafHash)({output:e.redeem.output,version:y.redeemVersion}),i=(0,a.findScriptPath)(t,r);if(!i)return;const o=(0,a.tweakKey)(e.internalPubkey,t.hash);if(!o)return;const s=n.Buffer.concat([n.Buffer.from([y.redeemVersion|o.parity]),e.internalPubkey].concat(i));return[e.redeem.output,s]}return e.signature?[e.signature]:void 0}),t.validate){let t=n.Buffer.from([]);if(e.address){if(d&&d.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(1!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");t=r().data}if(e.pubkey){if(t.length>0&&!t.equals(e.pubkey))throw new TypeError("Pubkey mismatch");t=e.pubkey}if(e.output){if(34!==e.output.length||e.output[0]!==p.OP_1||32!==e.output[1])throw new TypeError("Output is invalid");if(t.length>0&&!t.equals(e.output.slice(2)))throw new TypeError("Pubkey mismatch");t=e.output.slice(2)}if(e.internalPubkey){const r=(0,a.tweakKey)(e.internalPubkey,y.hash);if(t.length>0&&!t.equals(r.x))throw new TypeError("Pubkey mismatch");t=r.x}if(t&&t.length&&!(0,u.getEccLib)().isXOnlyPoint(t))throw new TypeError("Invalid pubkey for p2tr");const i=l();if(e.hash&&i&&!e.hash.equals(i.hash))throw new TypeError("Hash mismatch");if(e.redeem&&e.redeem.output&&i){const t=(0,a.tapleafHash)({output:e.redeem.output,version:y.redeemVersion});if(!(0,a.findScriptPath)(i,t))throw new TypeError("Redeem script not in tree")}const c=h();if(e.redeem&&y.redeem){if(e.redeem.redeemVersion&&e.redeem.redeemVersion!==y.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(e.redeem.output){if(0===o.decompile(e.redeem.output).length)throw new TypeError("Redeem.output is invalid");if(y.redeem.output&&!e.redeem.output.equals(y.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(e.redeem.witness&&y.redeem.witness&&!function(e,t){return e.length===t.length&&e.every((e,r)=>e.equals(t[r]))}(e.redeem.witness,y.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(c&&c.length)if(1===c.length){if(e.signature&&!e.signature.equals(c[0]))throw new TypeError("Signature mismatch")}else{const r=c[c.length-1];if(r.length<33)throw new TypeError(`The control-block length is too small. Got ${r.length}, expected min 33.`);if((r.length-33)%32!==0)throw new TypeError(`The control-block length of ${r.length} is incorrect!`);const n=(r.length-33)/32;if(n>128)throw new TypeError(`The script path is too long. Got ${n}, expected max 128.`);const i=r.slice(1,33);if(e.internalPubkey&&!e.internalPubkey.equals(i))throw new TypeError("Internal pubkey mismatch");if(!(0,u.getEccLib)().isXOnlyPoint(i))throw new TypeError("Invalid internalPubkey for p2tr witness");const o=r[0]&s.TAPLEAF_VERSION_MASK,f=c[c.length-2],p=(0,a.tapleafHash)({output:f,version:o}),h=(0,a.rootHashFromPath)(r,p),l=(0,a.tweakKey)(i,h);if(!l)throw new TypeError("Invalid outputKey for p2tr witness");if(t.length&&!t.equals(l.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(l.parity!==(1&r[0]))throw new Error("Incorrect parity")}}return Object.assign(y,e)}},4188:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.Block=void 0;const n=r(3455),i=r(3255),o=r(4189),s=r(3384),u=r(3132),{typeforce:a}=u,c=new TypeError("Cannot compute merkle root for zero transactions"),f=new TypeError("Cannot compute witness commit for non-segwit block");class p{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(e){if(e.length<80)throw new Error("Buffer too small (< 80 bytes)");const t=new n.BufferReader(e),r=new p;if(r.version=t.readInt32(),r.prevHash=t.readSlice(32),r.merkleRoot=t.readSlice(32),r.timestamp=t.readUInt32(),r.bits=t.readUInt32(),r.nonce=t.readUInt32(),80===e.length)return r;const i=()=>{const e=s.Transaction.fromBuffer(t.buffer.slice(t.offset),!0);return t.offset+=e.byteLength(),e},o=t.readVarInt();r.transactions=[];for(let n=0;n<o;++n){const e=i();r.transactions.push(e)}const u=r.getWitnessCommit();return u&&(r.witnessCommit=u),r}static fromHex(t){return p.fromBuffer(e.from(t,"hex"))}static calculateTarget(t){const r=((4278190080&t)>>24)-3,n=8388607&t,i=e.alloc(32,0);return i.writeUIntBE(n,29-r,3),i}static calculateMerkleRoot(t,r){if(a([{getHash:u.Function}],t),0===t.length)throw c;if(r&&!h(t))throw f;const n=t.map(e=>e.getHash(r)),s=(0,o.fastMerkleRoot)(n,i.hash256);return r?i.hash256(e.concat([s,t[0].ins[0].witness[0]])):s}getWitnessCommit(){if(!h(this.transactions))return null;const t=this.transactions[0].outs.filter(t=>t.script.slice(0,6).equals(e.from("6a24aa21a9ed","hex"))).map(e=>e.script.slice(6,38));if(0===t.length)return null;const r=t[t.length-1];return r instanceof e&&32===r.length?r:null}hasWitnessCommit(){return this.witnessCommit instanceof e&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(e=this.transactions)instanceof Array&&e.some(e=>"object"===typeof e&&e.ins instanceof Array&&e.ins.some(e=>"object"===typeof e&&e.witness instanceof Array&&e.witness.length>0));var e}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(e,t=!0){return e||!this.transactions?80:80+n.varuint.encodingLength(this.transactions.length)+this.transactions.reduce((e,r)=>e+r.byteLength(t),0)}getHash(){return i.hash256(this.toBuffer(!0))}getId(){return(0,n.reverseBuffer)(this.getHash()).toString("hex")}getUTCDate(){const e=new Date(0);return e.setUTCSeconds(this.timestamp),e}toBuffer(t){const r=e.allocUnsafe(this.byteLength(t)),i=new n.BufferWriter(r);return i.writeInt32(this.version),i.writeSlice(this.prevHash),i.writeSlice(this.merkleRoot),i.writeUInt32(this.timestamp),i.writeUInt32(this.bits),i.writeUInt32(this.nonce),t||!this.transactions||(n.varuint.encode(this.transactions.length,r,i.offset),i.offset+=n.varuint.encode.bytes,this.transactions.forEach(e=>{const t=e.byteLength();e.toBuffer(r,i.offset),i.offset+=t})),r}toHex(e){return this.toBuffer(e).toString("hex")}checkTxRoots(){const e=this.hasWitnessCommit();return!(!e&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!e||this.__checkWitnessCommit()))}checkProofOfWork(){const e=(0,n.reverseBuffer)(this.getHash()),t=p.calculateTarget(this.bits);return e.compare(t)<=0}__checkMerkleRoot(){if(!this.transactions)throw c;const e=p.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(e)}__checkWitnessCommit(){if(!this.transactions)throw c;if(!this.hasWitnessCommit())throw f;const e=p.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(e)}}function h(e){return e instanceof Array&&e[0]&&e[0].ins&&e[0].ins instanceof Array&&e[0].ins[0]&&e[0].ins[0].witness&&e[0].ins[0].witness instanceof Array&&e[0].ins[0].witness.length>0}t.Block=p}).call(this,r(22).Buffer)},4189:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.fastMerkleRoot=void 0,t.fastMerkleRoot=function(t,r){if(!Array.isArray(t))throw TypeError("Expected values Array");if("function"!==typeof r)throw TypeError("Expected digest Function");let n=t.length;const i=t.concat();for(;n>1;){let t=0;for(let o=0;o<n;o+=2,++t){const s=i[o],u=o+1===n?s:i[o+1],a=e.concat([s,u]);i[t]=r(a)}n=t}return i[0]}}).call(this,r(22).Buffer)},4190:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.Psbt=void 0;const n=r(3823),i=r(3292),o=r(3590),s=r(3821),u=r(3455),a=r(3203),c=r(3383),f=r(3587),p=r(3145),h=r(3384),l=r(3591),d=r(3592),y={network:a.bitcoin,maximumFeeRate:5e3};class w{static fromBase64(t,r={}){const n=e.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r={}){const n=e.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(e,t={}){const r=n.Psbt.fromBuffer(e,g),i=new w(t,r);var o,s;return o=i.__CACHE.__TX,s=i.__CACHE,o.ins.forEach(e=>{v(s,e)}),i}constructor(e={},t=new n.Psbt(new E)){this.data=t,this.opts=Object.assign({},y,e),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(e,t,r,n)=>Object.defineProperty(e,t,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(e){this.setVersion(e)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(e){this.setLocktime(e)}get txInputs(){return this.__CACHE.__TX.ins.map(e=>({hash:(0,u.cloneBuffer)(e.hash),index:e.index,sequence:e.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(e=>{let t;try{t=(0,s.fromOutputScript)(e.script,this.opts.network)}catch(r){}return{script:(0,u.cloneBuffer)(e.script),value:e.value,address:t}})}combine(...e){return this.data.combine(...e.map(e=>e.data)),this}clone(){const e=w.fromBuffer(this.data.toBuffer());return e.opts=JSON.parse(JSON.stringify(this.opts)),e}setMaximumFeeRate(e){T(e),this.opts.maximumFeeRate=e}setVersion(e){T(e),I(this.data.inputs,"setVersion");const t=this.__CACHE;return t.__TX.version=e,t.__EXTRACTED_TX=void 0,this}setLocktime(e){T(e),I(this.data.inputs,"setLocktime");const t=this.__CACHE;return t.__TX.locktime=e,t.__EXTRACTED_TX=void 0,this}setInputSequence(e,t){T(t),I(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=e)throw new Error("Input index too high");return r.__TX.ins[e].sequence=t,r.__EXTRACTED_TX=void 0,this}addInputs(e){return e.forEach(e=>this.addInput(e)),this}addInput(e){if(arguments.length>1||!e||void 0===e.hash||void 0===e.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");(0,l.checkTaprootInputFields)(e,e,"addInput"),I(this.data.inputs,"addInput"),e.witnessScript&&j(e.witnessScript);const t=this.__CACHE;this.data.addInput(e);v(t,t.__TX.ins[t.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&K(this.__CACHE,n,r),t.__FEE=void 0,t.__FEE_RATE=void 0,t.__EXTRACTED_TX=void 0,this}addOutputs(e){return e.forEach(e=>this.addOutput(e)),this}addOutput(e){if(arguments.length>1||!e||void 0===e.value||void 0===e.address&&void 0===e.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");I(this.data.inputs,"addOutput");const{address:t}=e;if("string"===typeof t){const{network:r}=this.opts,n=(0,s.toOutputScript)(t,r);e=Object.assign(e,{script:n})}(0,l.checkTaprootOutputFields)(e,e,"addOutput");const r=this.__CACHE;return this.data.addOutput(e),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(e){if(!this.data.inputs.every(b))throw new Error("Not finalized");const t=this.__CACHE;if(e||function(e,t,r){const n=t.__FEE_RATE||e.getFeeRate(),i=t.__EXTRACTED_TX.virtualSize(),o=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(o/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,t,this.opts),t.__EXTRACTED_TX)return t.__EXTRACTED_TX;const r=t.__TX.clone();return V(this.data.inputs,r,t,!0),r}getFeeRate(){return N("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return N("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,o.checkForInput)(this.data.inputs,0),q(this.data.inputs.length).forEach(e=>this.finalizeInput(e)),this}finalizeInput(e,t){const r=(0,o.checkForInput)(this.data.inputs,e);return(0,l.isTaprootInput)(r)?this._finalizeTaprootInput(e,r,void 0,t):this._finalizeInput(e,r,t)}finalizeTaprootInput(e,t,r=l.tapScriptFinalizer){const n=(0,o.checkForInput)(this.data.inputs,e);if((0,l.isTaprootInput)(n))return this._finalizeTaprootInput(e,n,t,r);throw new Error(`Cannot finalize input #${e}. Not Taproot.`)}_finalizeInput(e,t,r=B){const{script:n,isP2SH:i,isP2WSH:o,isSegwit:s}=function(e,t,r){const n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!t.redeemScript,i.isP2WSH=!!t.witnessScript,t.witnessScript)i.script=t.witnessScript;else if(t.redeemScript)i.script=t.redeemScript;else if(t.nonWitnessUtxo){const o=F(r,t,e),s=n.ins[e].index;i.script=o.outs[s].script}else t.witnessUtxo&&(i.script=t.witnessUtxo.script);(t.witnessScript||(0,d.isP2WPKH)(i.script))&&(i.isSegwit=!0);return i}(e,t,this.__CACHE);if(!n)throw new Error("No script found for input #"+e);!function(e){if(!e.sighashType||!e.partialSig)return;const{partialSig:t,sighashType:r}=e;t.forEach(e=>{const{hashType:t}=p.signature.decode(e.signature);if(r!==t)throw new Error("Signature sighash does not match input sighash type")})}(t);const{finalScriptSig:u,finalScriptWitness:a}=r(e,t,n,s,i,o);if(u&&this.data.updateInput(e,{finalScriptSig:u}),a&&this.data.updateInput(e,{finalScriptWitness:a}),!u&&!a)throw new Error("Unknown error finalizing input #"+e);return this.data.clearFinalizedInput(e),this}_finalizeTaprootInput(e,t,r,n=l.tapScriptFinalizer){if(!t.witnessUtxo)throw new Error(`Cannot finalize input #${e}. Missing withness utxo.`);if(t.tapKeySig){const r=c.p2tr({output:t.witnessUtxo.script,signature:t.tapKeySig}),n=(0,d.witnessStackToScriptWitness)(r.witness);this.data.updateInput(e,{finalScriptWitness:n})}else{const{finalScriptWitness:i}=n(e,t,r);this.data.updateInput(e,{finalScriptWitness:i})}return this.data.clearFinalizedInput(e),this}getInputType(t){const r=(0,o.checkForInput)(this.data.inputs,t),n=G(D(t,r,this.__CACHE),t,"input",r.redeemScript||function(t){if(!t)return;const r=p.decompile(t);if(!r)return;const n=r[r.length-1];if(!e.isBuffer(n)||W(n)||(i=n,p.isCanonicalScriptSignature(i)))return;var i;if(!p.decompile(n))return;return n}(r.finalScriptSig),r.witnessScript||function(e){if(!e)return;const t=L(e),r=t[t.length-1];if(W(r))return;if(!p.decompile(r))return;return r}(r.finalScriptWitness));return("raw"===n.type?"":n.type+"-")+X(n.meaningfulScript)}inputHasPubkey(e,t){return function(e,t,r,n){const i=D(r,t,n),{meaningfulScript:o}=G(i,r,"input",t.redeemScript,t.witnessScript);return(0,d.pubkeyInScript)(e,o)}(t,(0,o.checkForInput)(this.data.inputs,e),e,this.__CACHE)}inputHasHDKey(e,t){const r=(0,o.checkForInput)(this.data.inputs,e),n=_(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(e,t){return function(e,t,r,n){const i=n.__TX.outs[r].script,{meaningfulScript:o}=G(i,r,"output",t.redeemScript,t.witnessScript);return(0,d.pubkeyInScript)(e,o)}(t,(0,o.checkForOutput)(this.data.outputs,e),e,this.__CACHE)}outputHasHDKey(e,t){const r=(0,o.checkForOutput)(this.data.outputs,e),n=_(t);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(e){(0,o.checkForInput)(this.data.inputs,0);return q(this.data.inputs.length).map(t=>this.validateSignaturesOfInput(t,e)).reduce((e,t)=>!0===t&&e,!0)}validateSignaturesOfInput(e,t,r){const n=this.data.inputs[e];return(0,l.isTaprootInput)(n)?this.validateSignaturesOfTaprootInput(e,t,r):this._validateSignaturesOfInput(e,t,r)}_validateSignaturesOfInput(e,t,r){const n=this.data.inputs[e],i=(n||{}).partialSig;if(!n||!i||i.length<1)throw new Error("No signatures to validate");if("function"!==typeof t)throw new Error("Need validator function to validate signatures");const o=r?i.filter(e=>e.pubkey.equals(r)):i;if(o.length<1)throw new Error("No signatures for this pubkey");const s=[];let u,a,c;for(const f of o){const r=p.signature.decode(f.signature),{hash:i,script:o}=c!==r.hashType?U(e,Object.assign({},n,{sighashType:r.hashType}),this.__CACHE,!0):{hash:u,script:a};c=r.hashType,u=i,a=o,k(f.pubkey,o,"verify"),s.push(t(f.pubkey,i,r.signature))}return s.every(e=>!0===e)}validateSignaturesOfTaprootInput(e,t,r){const n=this.data.inputs[e],i=(n||{}).tapKeySig,o=(n||{}).tapScriptSig;if(!n&&!i&&(!o||o.length))throw new Error("No signatures to validate");if("function"!==typeof t)throw new Error("Need validator function to validate signatures");const s=(r=r&&(0,l.toXOnly)(r))?C(e,n,this.data.inputs,r,this.__CACHE):function(e,t,r,n){const i=[];if(t.tapInternalKey){const r=(0,l.tweakInternalPubKey)(e,t);i.push(r)}if(t.tapScriptSig){const e=t.tapScriptSig.map(e=>e.pubkey);i.push(...e)}return i.map(i=>C(e,t,r,i,n)).flat()}(e,n,this.data.inputs,this.__CACHE);if(!s.length)throw new Error("No signatures for this pubkey");const u=s.find(e=>!!e.leafHash);if(i&&u){if(!t(u.pubkey,u.hash,i))return!1}if(o)for(const a of o){const e=s.find(e=>a.pubkey.equals(e.pubkey));if(e){if(!t(a.pubkey,e.hash,a.signature))return!1}}return!0}signAllInputsHD(e,t=[h.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const i of q(this.data.inputs.length))try{this.signInputHD(i,e,t),r.push(!0)}catch(n){r.push(!1)}if(r.every(e=>!1===e))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(e,t=[h.Transaction.SIGHASH_ALL]){return new Promise((r,n)=>{if(!e||!e.publicKey||!e.fingerprint)return n(new Error("Need HDSigner to sign input"));const i=[],o=[];for(const s of q(this.data.inputs.length))o.push(this.signInputHDAsync(s,e,t).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(o).then(()=>{if(i.every(e=>!1===e))return n(new Error("No inputs were signed"));r()})})}signInputHD(e,t,r=[h.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");return R(e,this.data.inputs,t).forEach(t=>this.signInput(e,t,r)),this}signInputHDAsync(e,t,r=[h.Transaction.SIGHASH_ALL]){return new Promise((n,i)=>{if(!t||!t.publicKey||!t.fingerprint)return i(new Error("Need HDSigner to sign input"));const o=R(e,this.data.inputs,t).map(t=>this.signInputAsync(e,t,r));return Promise.all(o).then(()=>{n()}).catch(i)})}signAllInputs(e,t){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const i of q(this.data.inputs.length))try{this.signInput(i,e,t),r.push(!0)}catch(n){r.push(!1)}if(r.every(e=>!1===e))throw new Error("No inputs were signed");return this}signAllInputsAsync(e,t){return new Promise((r,n)=>{if(!e||!e.publicKey)return n(new Error("Need Signer to sign input"));const i=[],o=[];for(const[s]of this.data.inputs.entries())o.push(this.signInputAsync(s,e,t).then(()=>{i.push(!0)},()=>{i.push(!1)}));return Promise.all(o).then(()=>{if(i.every(e=>!1===e))return n(new Error("No inputs were signed"));r()})})}signInput(e,t,r){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=(0,o.checkForInput)(this.data.inputs,e);return(0,l.isTaprootInput)(n)?this._signTaprootInput(e,n,t,void 0,r):this._signInput(e,t,r)}signTaprootInput(e,t,r,n){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const i=(0,o.checkForInput)(this.data.inputs,e);if((0,l.isTaprootInput)(i))return this._signTaprootInput(e,i,t,r,n);throw new Error(`Input #${e} is not of type Taproot.`)}_signInput(e,t,r=[h.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:i}=H(this.data.inputs,e,t.publicKey,this.__CACHE,r),o=[{pubkey:t.publicKey,signature:p.signature.encode(t.sign(n),i)}];return this.data.updateInput(e,{partialSig:o}),this}_signTaprootInput(e,t,r,n,i=[h.Transaction.SIGHASH_DEFAULT]){const o=this.checkTaprootHashesForSig(e,t,r,n,i),s=o.filter(e=>!e.leafHash).map(e=>(0,l.serializeTaprootSignature)(r.signSchnorr(e.hash),t.sighashType))[0],u=o.filter(e=>!!e.leafHash).map(e=>({pubkey:(0,l.toXOnly)(r.publicKey),signature:(0,l.serializeTaprootSignature)(r.signSchnorr(e.hash),t.sighashType),leafHash:e.leafHash}));return s&&this.data.updateInput(e,{tapKeySig:s}),u.length&&this.data.updateInput(e,{tapScriptSig:u}),this}signInputAsync(e,t,r){return Promise.resolve().then(()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const n=(0,o.checkForInput)(this.data.inputs,e);return(0,l.isTaprootInput)(n)?this._signTaprootInputAsync(e,n,t,void 0,r):this._signInputAsync(e,t,r)})}signTaprootInputAsync(e,t,r,n){return Promise.resolve().then(()=>{if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const i=(0,o.checkForInput)(this.data.inputs,e);if((0,l.isTaprootInput)(i))return this._signTaprootInputAsync(e,i,t,r,n);throw new Error(`Input #${e} is not of type Taproot.`)})}_signInputAsync(e,t,r=[h.Transaction.SIGHASH_ALL]){const{hash:n,sighashType:i}=H(this.data.inputs,e,t.publicKey,this.__CACHE,r);return Promise.resolve(t.sign(n)).then(r=>{const n=[{pubkey:t.publicKey,signature:p.signature.encode(r,i)}];this.data.updateInput(e,{partialSig:n})})}async _signTaprootInputAsync(e,t,r,n,i=[h.Transaction.SIGHASH_DEFAULT]){const o=this.checkTaprootHashesForSig(e,t,r,n,i),s=[],u=o.filter(e=>!e.leafHash)[0];if(u){const e=Promise.resolve(r.signSchnorr(u.hash)).then(e=>({tapKeySig:(0,l.serializeTaprootSignature)(e,t.sighashType)}));s.push(e)}const a=o.filter(e=>!!e.leafHash);if(a.length){const e=a.map(e=>Promise.resolve(r.signSchnorr(e.hash)).then(n=>({tapScriptSig:[{pubkey:(0,l.toXOnly)(r.publicKey),signature:(0,l.serializeTaprootSignature)(n,t.sighashType),leafHash:e.leafHash}]})));s.push(...e)}return Promise.all(s).then(t=>{t.forEach(t=>this.data.updateInput(e,t))})}checkTaprootHashesForSig(e,t,r,n,i){if("function"!==typeof r.signSchnorr)throw new Error(`Need Schnorr Signer to sign taproot input #${e}.`);const o=C(e,t,this.data.inputs,r.publicKey,this.__CACHE,n,i);if(!o||!o.length)throw new Error(`Can not sign for input #${e} with the key ${r.publicKey.toString("hex")}`);return o}toBuffer(){return S(this.__CACHE),this.data.toBuffer()}toHex(){return S(this.__CACHE),this.data.toHex()}toBase64(){return S(this.__CACHE),this.data.toBase64()}updateGlobal(e){return this.data.updateGlobal(e),this}updateInput(e,t){return t.witnessScript&&j(t.witnessScript),(0,l.checkTaprootInputFields)(this.data.inputs[e],t,"updateInput"),this.data.updateInput(e,t),t.nonWitnessUtxo&&K(this.__CACHE,this.data.inputs[e],e),this}updateOutput(e,t){const r=this.data.outputs[e];return(0,l.checkTaprootOutputFields)(r,t,"updateOutput"),this.data.updateOutput(e,t),this}addUnknownKeyValToGlobal(e){return this.data.addUnknownKeyValToGlobal(e),this}addUnknownKeyValToInput(e,t){return this.data.addUnknownKeyValToInput(e,t),this}addUnknownKeyValToOutput(e,t){return this.data.addUnknownKeyValToOutput(e,t),this}clearFinalizedInput(e){return this.data.clearFinalizedInput(e),this}}t.Psbt=w;const g=e=>new E(e);class E{constructor(t=e.from([2,0,0,0,0,0,0,0,0,0])){this.tx=h.Transaction.fromBuffer(t),function(e){if(!e.ins.every(e=>e.script&&0===e.script.length&&e.witness&&0===e.witness.length))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(void 0===t.hash||void 0===t.index||!e.isBuffer(t.hash)&&"string"!==typeof t.hash||"number"!==typeof t.index)throw new Error("Error adding input.");const r="string"===typeof t.hash?(0,u.reverseBuffer)(e.from(t.hash,"hex")):t.hash;this.tx.addInput(r,t.index,t.sequence)}addOutput(t){if(void 0===t.script||void 0===t.value||!e.isBuffer(t.script)||"number"!==typeof t.value)throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}}function S(e){if(!1!==e.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function m(e,t,r){if(!t)return!1;let n;if(n=r?r.map(e=>{const r=function(e){if(65===e.length){const t=1&e[64],r=e.slice(0,33);return r[0]=2|t,r}return e.slice()}(e);return t.find(e=>e.pubkey.equals(r))}).filter(e=>!!e):t,n.length>e)throw new Error("Too many signatures");return n.length===e}function b(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function _(e){return t=>!!t.masterFingerprint.equals(e.fingerprint)&&!!e.derivePath(t.path).publicKey.equals(t.pubkey)}function T(e){if("number"!==typeof e||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function I(e,t){e.forEach(e=>{if((0,l.isTaprootInput)(e)?(0,l.checkTaprootInputForSigs)(e,t):(0,d.checkInputForSig)(e,t))throw new Error("Can not modify transaction, signatures exist.")})}function k(e,t,r){if(!(0,d.pubkeyInScript)(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function v(t,r){const n=(0,u.reverseBuffer)(e.from(r.hash)).toString("hex")+":"+r.index;if(t.__TX_IN_CACHE[n])throw new Error("Duplicate input detected.");t.__TX_IN_CACHE[n]=1}function P(e,t){return(r,n,i,o)=>{const s=e({redeem:{output:i}}).output;if(!n.equals(s))throw new Error(`${t} for ${o} #${r} doesn't match the scriptPubKey in the prevout`)}}const O=P(c.p2sh,"Redeem script"),A=P(c.p2wsh,"Witness script");function N(e,t,r,n){if(!r.every(b))throw new Error("PSBT must be finalized to calculate "+t);if("__FEE_RATE"===e&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===e&&n.__FEE)return n.__FEE;let i,o=!0;return n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,o=!1):i=n.__TX.clone(),V(r,i,n,o),"__FEE_RATE"===e?n.__FEE_RATE:"__FEE"===e?n.__FEE:void 0}function B(e,t,r,n,i,o){const s=X(r);if(!function(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return m(1,e.partialSig);case"multisig":const r=c.p2ms({output:t});return m(r.m,e.partialSig,r.pubkeys);default:return!1}}(t,r,s))throw new Error("Can not finalize input #"+e);return function(e,t,r,n,i,o){let s,u;const a=function(e,t,r){let n;switch(t){case"multisig":const t=function(e,t){return c.p2ms({output:e}).pubkeys.map(e=>(t.filter(t=>t.pubkey.equals(e))[0]||{}).signature).filter(e=>!!e)}(e,r);n=c.p2ms({output:e,signatures:t});break;case"pubkey":n=c.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=c.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=c.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(e,t,r),f=o?c.p2wsh({redeem:a}):null,p=i?c.p2sh({redeem:f||a}):null;n?(u=f?(0,d.witnessStackToScriptWitness)(f.witness):(0,d.witnessStackToScriptWitness)(a.witness),p&&(s=p.input)):s=p?p.input:a.input;return{finalScriptSig:s,finalScriptWitness:u}}(r,s,t.partialSig,n,i,o)}function H(e,t,r,n,i){const s=(0,o.checkForInput)(e,t),{hash:u,sighashType:a,script:c}=U(t,s,n,!1,i);return k(r,c,"sign"),{hash:u,sighashType:a}}function U(e,t,r,n,i){const o=r.__TX,s=t.sighashType||h.Transaction.SIGHASH_ALL;let u,a;if(x(s,i),t.nonWitnessUtxo){const n=F(r,t,e),i=o.ins[e].hash,s=n.getHash();if(!i.equals(s))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);const u=o.ins[e].index;a=n.outs[u]}else{if(!t.witnessUtxo)throw new Error("Need a Utxo input item for signing");a=t.witnessUtxo}const{meaningfulScript:f,type:p}=G(a.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(p)>=0)u=o.hashForWitnessV0(e,f,a.value,s);else if((0,d.isP2WPKH)(f)){const t=c.p2pkh({hash:f.slice(2)}).output;u=o.hashForWitnessV0(e,t,a.value,s)}else{if(void 0===t.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: `+f.toString("hex"));!n&&r.__UNSAFE_SIGN_NONSEGWIT,u=o.hashForSignature(e,f,s)}return{script:f,sighashType:s,hash:u}}function C(e,t,r,n,i,o,s){const u=i.__TX,a=t.sighashType||h.Transaction.SIGHASH_DEFAULT;x(a,s);const c=r.map((e,t)=>M(t,e,i)),p=c.map(e=>e.script),y=c.map(e=>e.value),w=[];if(t.tapInternalKey&&!o){const r=(0,l.tweakInternalPubKey)(e,t);if((0,l.toXOnly)(n).equals(r)){const t=u.hashForWitnessV1(e,p,y,a);w.push({pubkey:n,hash:t})}}const g=(t.tapLeafScript||[]).filter(e=>(0,d.pubkeyInScript)(n,e.script)).map(e=>{const t=(0,f.tapleafHash)({output:e.script,version:e.leafVersion});return Object.assign({hash:t},e)}).filter(e=>!o||o.equals(e.hash)).map(t=>{const r=u.hashForWitnessV1(e,p,y,h.Transaction.SIGHASH_DEFAULT,t.hash);return{pubkey:n,hash:r,leafHash:t.hash}});return w.concat(g)}function x(e,t){if(t&&t.indexOf(e)<0){const t=function(e){let t=e&h.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&e){case h.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case h.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case h.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE"}return t}(e);throw new Error("Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: "+t)}}function R(e,t,r){const n=(0,o.checkForInput)(t,e);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=n.bip32Derivation.map(e=>e.masterFingerprint.equals(r.fingerprint)?e:void 0).filter(e=>!!e);if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map(e=>{const t=r.derivePath(e.path);if(!e.pubkey.equals(t.publicKey))throw new Error("pubkey did not match bip32Derivation");return t})}function L(e){let t=0;function r(){const r=i.decode(e,t);return t+=i.decode.bytes,r}function n(){return n=r(),t+=n,e.slice(t-n,t);var n}return function(){const e=r(),t=[];for(let r=0;r<e;r++)t.push(n());return t}()}function K(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;const n=h.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const i=e,o=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){const e=i.__NON_WITNESS_UTXO_BUF_CACHE[o],t=i.__NON_WITNESS_UTXO_TX_CACHE[o];if(void 0!==e)return e;{const e=t.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[o]=e,e}},set(e){i.__NON_WITNESS_UTXO_BUF_CACHE[o]=e}})}function V(e,t,r,n){let i=0;e.forEach((e,o)=>{if(n&&e.finalScriptSig&&(t.ins[o].script=e.finalScriptSig),n&&e.finalScriptWitness&&(t.ins[o].witness=L(e.finalScriptWitness)),e.witnessUtxo)i+=e.witnessUtxo.value;else if(e.nonWitnessUtxo){const n=F(r,e,o),s=t.ins[o].index,u=n.outs[s];i+=u.value}});const o=t.outs.reduce((e,t)=>e+t.value,0),s=i-o;if(s<0)throw new Error("Outputs are spending more than Inputs");const u=t.virtualSize();r.__FEE=s,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(s/u)}function F(e,t,r){const n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||K(e,t,r),n[r]}function D(e,t,r){const{script:n}=M(e,t,r);return n}function M(e,t,r){if(void 0!==t.witnessUtxo)return{script:t.witnessUtxo.script,value:t.witnessUtxo.value};if(void 0!==t.nonWitnessUtxo){const n=F(r,t,e).outs[r.__TX.ins[e].index];return{script:n.script,value:n.value}}throw new Error("Can't find pubkey in input without Utxo data")}function W(e){return 33===e.length&&p.isCanonicalPubKey(e)}function G(e,t,r,n,i){const o=(0,d.isP2SHScript)(e),s=o&&n&&(0,d.isP2WSHScript)(n),u=(0,d.isP2WSHScript)(e);if(o&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||s)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let a;return s?(a=i,O(t,e,n,r),A(t,n,i,r),j(a)):u?(a=i,A(t,e,i,r),j(a)):o?(a=n,O(t,e,n,r)):a=e,{meaningfulScript:a,type:s?"p2sh-p2wsh":o?"p2sh":u?"p2wsh":"raw"}}function j(e){if((0,d.isP2WPKH)(e)||(0,d.isP2SHScript)(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function X(e){return(0,d.isP2WPKH)(e)?"witnesspubkeyhash":(0,d.isP2PKH)(e)?"pubkeyhash":(0,d.isP2MS)(e)?"multisig":(0,d.isP2PK)(e)?"pubkey":"nonstandard"}function q(e){return[...Array(e).keys()]}}).call(this,r(22).Buffer)},4191:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3824);function i(e,t,r){return n=>{if(e.has(n))return;const i=r.filter(e=>e.key.toString("hex")===n)[0];t.push(i),e.add(n)}}function o(e){return e.globalMap.unsignedTx}function s(e){const t=new Set;return e.forEach(e=>{const r=e.key.toString("hex");if(t.has(r))throw new Error("Combine: KeyValue Map keys should be unique");t.add(r)}),t}t.combine=function(e){const t=e[0],r=n.psbtToKeyVals(t),u=e.slice(1);if(0===u.length)throw new Error("Combine: Nothing to combine");const a=o(t);if(void 0===a)throw new Error("Combine: Self missing transaction");const c=s(r.globalKeyVals),f=r.inputKeyVals.map(s),p=r.outputKeyVals.map(s);for(const h of u){const e=o(h);if(void 0===e||!e.toBuffer().equals(a.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");const t=n.psbtToKeyVals(h);s(t.globalKeyVals).forEach(i(c,r.globalKeyVals,t.globalKeyVals));t.inputKeyVals.map(s).forEach((e,n)=>e.forEach(i(f[n],r.inputKeyVals[n],t.inputKeyVals[n])));t.outputKeyVals.map(s).forEach((e,n)=>e.forEach(i(p[n],r.outputKeyVals[n],t.outputKeyVals[n])))}return n.psbtFromKeyVals(a,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})}},4192:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3588),i=r(3589),o=r(3292),s=r(3126);function u(t,r,n){if(!r.equals(e.from([n])))throw new Error(`Format Error: Invalid ${t} key: ${r.toString("hex")}`)}function a(e,{globalMapKeyVals:t,inputKeyVals:r,outputKeyVals:o}){const a={unsignedTx:e};let c=0;for(const i of t)switch(i.key[0]){case s.GlobalTypes.UNSIGNED_TX:if(u("global",i.key,s.GlobalTypes.UNSIGNED_TX),c>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");c++;break;case s.GlobalTypes.GLOBAL_XPUB:void 0===a.globalXpub&&(a.globalXpub=[]),a.globalXpub.push(n.globals.globalXpub.decode(i));break;default:a.unknownKeyVals||(a.unknownKeyVals=[]),a.unknownKeyVals.push(i)}const f=r.length,p=o.length,h=[],l=[];for(const d of i.range(f)){const e={};for(const t of r[d])switch(n.inputs.checkPubkey(t),t.key[0]){case s.InputTypes.NON_WITNESS_UTXO:if(u("input",t.key,s.InputTypes.NON_WITNESS_UTXO),void 0!==e.nonWitnessUtxo)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");e.nonWitnessUtxo=n.inputs.nonWitnessUtxo.decode(t);break;case s.InputTypes.WITNESS_UTXO:if(u("input",t.key,s.InputTypes.WITNESS_UTXO),void 0!==e.witnessUtxo)throw new Error("Format Error: Input has multiple WITNESS_UTXO");e.witnessUtxo=n.inputs.witnessUtxo.decode(t);break;case s.InputTypes.PARTIAL_SIG:void 0===e.partialSig&&(e.partialSig=[]),e.partialSig.push(n.inputs.partialSig.decode(t));break;case s.InputTypes.SIGHASH_TYPE:if(u("input",t.key,s.InputTypes.SIGHASH_TYPE),void 0!==e.sighashType)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");e.sighashType=n.inputs.sighashType.decode(t);break;case s.InputTypes.REDEEM_SCRIPT:if(u("input",t.key,s.InputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");e.redeemScript=n.inputs.redeemScript.decode(t);break;case s.InputTypes.WITNESS_SCRIPT:if(u("input",t.key,s.InputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");e.witnessScript=n.inputs.witnessScript.decode(t);break;case s.InputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(n.inputs.bip32Derivation.decode(t));break;case s.InputTypes.FINAL_SCRIPTSIG:u("input",t.key,s.InputTypes.FINAL_SCRIPTSIG),e.finalScriptSig=n.inputs.finalScriptSig.decode(t);break;case s.InputTypes.FINAL_SCRIPTWITNESS:u("input",t.key,s.InputTypes.FINAL_SCRIPTWITNESS),e.finalScriptWitness=n.inputs.finalScriptWitness.decode(t);break;case s.InputTypes.POR_COMMITMENT:u("input",t.key,s.InputTypes.POR_COMMITMENT),e.porCommitment=n.inputs.porCommitment.decode(t);break;case s.InputTypes.TAP_KEY_SIG:u("input",t.key,s.InputTypes.TAP_KEY_SIG),e.tapKeySig=n.inputs.tapKeySig.decode(t);break;case s.InputTypes.TAP_SCRIPT_SIG:void 0===e.tapScriptSig&&(e.tapScriptSig=[]),e.tapScriptSig.push(n.inputs.tapScriptSig.decode(t));break;case s.InputTypes.TAP_LEAF_SCRIPT:void 0===e.tapLeafScript&&(e.tapLeafScript=[]),e.tapLeafScript.push(n.inputs.tapLeafScript.decode(t));break;case s.InputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(n.inputs.tapBip32Derivation.decode(t));break;case s.InputTypes.TAP_INTERNAL_KEY:u("input",t.key,s.InputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=n.inputs.tapInternalKey.decode(t);break;case s.InputTypes.TAP_MERKLE_ROOT:u("input",t.key,s.InputTypes.TAP_MERKLE_ROOT),e.tapMerkleRoot=n.inputs.tapMerkleRoot.decode(t);break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}h.push(e)}for(const d of i.range(p)){const e={};for(const t of o[d])switch(n.outputs.checkPubkey(t),t.key[0]){case s.OutputTypes.REDEEM_SCRIPT:if(u("output",t.key,s.OutputTypes.REDEEM_SCRIPT),void 0!==e.redeemScript)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");e.redeemScript=n.outputs.redeemScript.decode(t);break;case s.OutputTypes.WITNESS_SCRIPT:if(u("output",t.key,s.OutputTypes.WITNESS_SCRIPT),void 0!==e.witnessScript)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");e.witnessScript=n.outputs.witnessScript.decode(t);break;case s.OutputTypes.BIP32_DERIVATION:void 0===e.bip32Derivation&&(e.bip32Derivation=[]),e.bip32Derivation.push(n.outputs.bip32Derivation.decode(t));break;case s.OutputTypes.TAP_INTERNAL_KEY:u("output",t.key,s.OutputTypes.TAP_INTERNAL_KEY),e.tapInternalKey=n.outputs.tapInternalKey.decode(t);break;case s.OutputTypes.TAP_TREE:u("output",t.key,s.OutputTypes.TAP_TREE),e.tapTree=n.outputs.tapTree.decode(t);break;case s.OutputTypes.TAP_BIP32_DERIVATION:void 0===e.tapBip32Derivation&&(e.tapBip32Derivation=[]),e.tapBip32Derivation.push(n.outputs.tapBip32Derivation.decode(t));break;default:e.unknownKeyVals||(e.unknownKeyVals=[]),e.unknownKeyVals.push(t)}l.push(e)}return{globalMap:a,inputs:h,outputs:l}}t.psbtFromBuffer=function(e,t){let r=0;function n(){const t=o.decode(e,r);r+=o.encodingLength(t);const n=e.slice(r,r+t);return r+=t,n}function u(){return{key:n(),value:n()}}function c(){if(r>=e.length)throw new Error("Format Error: Unexpected End of PSBT");const t=0===e.readUInt8(r);return t&&r++,t}if(1886610036!==function(){const t=e.readUInt32BE(r);return r+=4,t}())throw new Error("Format Error: Invalid Magic Number");if(255!==function(){const t=e.readUInt8(r);return r+=1,t}())throw new Error("Format Error: Magic Number must be followed by 0xff separator");const f=[],p={};for(;!c();){const e=u(),t=e.key.toString("hex");if(p[t])throw new Error("Format Error: Keys must be unique for global keymap: key "+t);p[t]=1,f.push(e)}const h=f.filter(e=>e.key[0]===s.GlobalTypes.UNSIGNED_TX);if(1!==h.length)throw new Error("Format Error: Only one UNSIGNED_TX allowed");const l=t(h[0].value),{inputCount:d,outputCount:y}=l.getInputOutputCounts(),w=[],g=[];for(const o of i.range(d)){const e={},t=[];for(;!c();){const r=u(),n=r.key.toString("hex");if(e[n])throw new Error("Format Error: Keys must be unique for each input: input index "+o+" key "+n);e[n]=1,t.push(r)}w.push(t)}for(const o of i.range(y)){const e={},t=[];for(;!c();){const r=u(),n=r.key.toString("hex");if(e[n])throw new Error("Format Error: Keys must be unique for each output: output index "+o+" key "+n);e[n]=1,t.push(r)}g.push(t)}return a(l,{globalMapKeyVals:f,inputKeyVals:w,outputKeyVals:g})},t.checkKeyBuffer=u,t.psbtFromKeyVals=a}).call(this,r(22).Buffer)},4193:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(79!==e.key.length||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!==0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");const t=e.key.slice(1),r={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(const n of(i=e.value.length/4-1,[...Array(i).keys()])){const t=e.value.readUInt32LE(4*n+4),i=!!(2147483648&t),o=2147483647&t;r.path+="/"+o.toString(10)+(i?"'":"")}var i;return r},t.encode=function(t){const r=e.from([n.GlobalTypes.GLOBAL_XPUB]),i=e.concat([r,t.extendedPubkey]),o=t.path.split("/"),s=e.allocUnsafe(4*o.length);t.masterFingerprint.copy(s,0);let u=4;return o.slice(1).forEach(e=>{const t="'"===e.slice(-1);let r=2147483647&parseInt(t?e.slice(0,-1):e,10);t&&(r+=2147483648),s.writeUInt32LE(r,u),u+=4}),{key:i,value:s}},t.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }",t.check=function(t){const r=t.extendedPubkey,n=t.masterFingerprint,i=t.path;return e.isBuffer(r)&&78===r.length&&[2,3].indexOf(r[45])>-1&&e.isBuffer(n)&&4===n.length&&"string"===typeof i&&!!i.match(/^m(\/\d+'?)*$/)},t.canAddToArray=function(e,t,r){const n=t.extendedPubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.extendedPubkey.equals(t.extendedPubkey)).length)}}).call(this,r(22).Buffer)},4194:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.encode=function(t){return{key:e.from([n.GlobalTypes.UNSIGNED_TX]),value:t.toBuffer()}}}).call(this,r(22).Buffer)},4195:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value},t.encode=function(t){return{key:e.from([n.InputTypes.FINAL_SCRIPTSIG]),value:t}},t.expected="Buffer",t.check=function(t){return e.isBuffer(t)},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptSig}}).call(this,r(22).Buffer)},4196:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value},t.encode=function(t){return{key:e.from([n.InputTypes.FINAL_SCRIPTWITNESS]),value:t}},t.expected="Buffer",t.check=function(t){return e.isBuffer(t)},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.finalScriptWitness}}).call(this,r(22).Buffer)},4197:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value},t.encode=function(t){return{key:e.from([n.InputTypes.NON_WITNESS_UTXO]),value:t}},t.expected="Buffer",t.check=function(t){return e.isBuffer(t)},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.nonWitnessUtxo}}).call(this,r(22).Buffer)},4198:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(34!==e.key.length&&66!==e.key.length||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}},t.encode=function(t){const r=e.from([n.InputTypes.PARTIAL_SIG]);return{key:e.concat([r,t.pubkey]),value:t.signature}},t.expected="{ pubkey: Buffer; signature: Buffer; }",t.check=function(t){return e.isBuffer(t.pubkey)&&e.isBuffer(t.signature)&&[33,65].includes(t.pubkey.length)&&[2,3,4].includes(t.pubkey[0])&&function(t){if(!e.isBuffer(t)||t.length<9)return!1;if(48!==t[0])return!1;if(t.length!==t[1]+3)return!1;if(2!==t[2])return!1;const r=t[3];if(r>33||r<1)return!1;if(2!==t[3+r+1])return!1;const n=t[3+r+2];return!(n>33||n<1)&&t.length===3+r+2+n+2}(t.signature)},t.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.pubkey.equals(t.pubkey)).length)}}).call(this,r(22).Buffer)},4199:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")},t.encode=function(t){return{key:e.from([n.InputTypes.POR_COMMITMENT]),value:e.from(t,"utf8")}},t.expected="string",t.check=function(e){return"string"===typeof e},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.porCommitment}}).call(this,r(22).Buffer)},4200:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)},t.encode=function(t){const r=e.from([n.InputTypes.SIGHASH_TYPE]),i=e.allocUnsafe(4);return i.writeUInt32LE(t,0),{key:r,value:i}},t.expected="number",t.check=function(e){return"number"===typeof e},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.sighashType}}).call(this,r(22).Buffer)},4201:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);function i(t){return e.isBuffer(t)&&(64===t.length||65===t.length)}t.decode=function(e){if(e.key[0]!==n.InputTypes.TAP_KEY_SIG||1!==e.key.length)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!i(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value},t.encode=function(t){return{key:e.from([n.InputTypes.TAP_KEY_SIG]),value:t}},t.expected="Buffer",t.check=i,t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapKeySig}}).call(this,r(22).Buffer)},4202:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!==0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));const t=e.value[e.value.length-1];if((254&e.key[1])!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));const r=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:r,leafVersion:t}},t.encode=function(t){const r=e.from([n.InputTypes.TAP_LEAF_SCRIPT]),i=e.from([t.leafVersion]);return{key:e.concat([r,t.controlBlock]),value:e.concat([t.script,i])}},t.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }",t.check=function(t){return e.isBuffer(t.controlBlock)&&(t.controlBlock.length-1)%32===0&&(254&t.controlBlock[0])===t.leafVersion&&e.isBuffer(t.script)},t.canAddToArray=function(e,t,r){const n=t.controlBlock.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.controlBlock.equals(t.controlBlock)).length)}}).call(this,r(22).Buffer)},4203:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);function i(t){return e.isBuffer(t)&&32===t.length}t.decode=function(e){if(e.key[0]!==n.InputTypes.TAP_MERKLE_ROOT||1!==e.key.length)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!i(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value},t.encode=function(t){return{key:e.from([n.InputTypes.TAP_MERKLE_ROOT]),value:t}},t.expected="Buffer",t.check=i,t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapMerkleRoot}}).call(this,r(22).Buffer)},4204:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126);t.decode=function(e){if(e.key[0]!==n.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(65!==e.key.length)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(64!==e.value.length&&65!==e.value.length)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1,33),leafHash:e.key.slice(33),signature:e.value}},t.encode=function(t){const r=e.from([n.InputTypes.TAP_SCRIPT_SIG]);return{key:e.concat([r,t.pubkey,t.leafHash]),value:t.signature}},t.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }",t.check=function(t){return e.isBuffer(t.pubkey)&&e.isBuffer(t.leafHash)&&e.isBuffer(t.signature)&&32===t.pubkey.length&&32===t.leafHash.length&&(64===t.signature.length||65===t.signature.length)},t.canAddToArray=function(e,t,r){const n=t.pubkey.toString("hex")+t.leafHash.toString("hex");return!r.has(n)&&(r.add(n),0===e.filter(e=>e.pubkey.equals(t.pubkey)&&e.leafHash.equals(t.leafHash)).length)}}).call(this,r(22).Buffer)},4205:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126),i=r(3589),o=r(3292);t.decode=function(e){if(e.key[0]!==n.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));const t=i.readUInt64LE(e.value,0);let r=8;const s=o.decode(e.value,r);r+=o.encodingLength(s);const u=e.value.slice(r);if(u.length!==s)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:u,value:t}},t.encode=function(t){const{script:r,value:s}=t,u=o.encodingLength(r.length),a=e.allocUnsafe(8+u+r.length);return i.writeUInt64LE(a,s,0),o.encode(r.length,a,8),r.copy(a,8+u),{key:e.from([n.InputTypes.WITNESS_UTXO]),value:a}},t.expected="{ script: Buffer; value: number; }",t.check=function(t){return e.isBuffer(t.script)&&"number"===typeof t.value},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.witnessUtxo}}).call(this,r(22).Buffer)},4206:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3126),i=r(3292);t.decode=function(e){if(e.key[0]!==n.OutputTypes.TAP_TREE||1!==e.key.length)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0;const r=[];for(;t<e.value.length;){const n=e.value[t++],o=e.value[t++],s=i.decode(e.value,t);t+=i.encodingLength(s),r.push({depth:n,leafVersion:o,script:e.value.slice(t,t+s)}),t+=s}return{leaves:r}},t.encode=function(t){const r=e.from([n.OutputTypes.TAP_TREE]),o=[].concat(...t.leaves.map(t=>[e.of(t.depth,t.leafVersion),i.encode(t.script.length),t.script]));return{key:r,value:e.concat(o)}},t.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }",t.check=function(t){return Array.isArray(t.leaves)&&t.leaves.every(t=>t.depth>=0&&t.depth<=128&&(254&t.leafVersion)===t.leafVersion&&e.isBuffer(t.script))},t.canAdd=function(e,t){return!!e&&!!t&&void 0===e.tapTree}}).call(this,r(22).Buffer)},4207:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeChecker=function(e){return function(t){let r;if(e.includes(t.key[0])&&(r=t.key.slice(1),33!==r.length&&65!==r.length||![2,3,4].includes(r[0])))throw new Error("Format Error: invalid pubkey in key 0x"+t.key.toString("hex"));return r}}},4208:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.makeConverter=function(t){return{decode:function(e){if(e.key[0]!==t)throw new Error("Decode Error: could not decode redeemScript with key 0x"+e.key.toString("hex"));return e.value},encode:function(r){return{key:e.from([t]),value:r}},check:function(t){return e.isBuffer(t)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.redeemScript}}}}).call(this,r(22).Buffer)},4209:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3292),i=r(3825),o=e=>32===e.length;t.makeConverter=function(t){const r=i.makeConverter(t,o);return{decode:function(e){const t=n.decode(e.value),i=n.encodingLength(t),o=r.decode({key:e.key,value:e.value.slice(i+32*t)}),s=new Array(t);for(let r=0,n=i;r<t;r++,n+=32)s[r]=e.value.slice(n,n+32);return Object.assign({},o,{leafHashes:s})},encode:function(t){const i=r.encode(t),o=n.encodingLength(t.leafHashes.length),s=e.allocUnsafe(o);n.encode(t.leafHashes.length,s);const u=e.concat([s,...t.leafHashes,i.value]);return Object.assign({},i,{value:u})},check:function(t){return Array.isArray(t.leafHashes)&&t.leafHashes.every(t=>e.isBuffer(t)&&32===t.length)&&r.check(t)},expected:"{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }",canAddToArray:r.canAddToArray}}}).call(this,r(22).Buffer)},4210:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.makeConverter=function(t){return{decode:function(e){if(e.key[0]!==t||1!==e.key.length)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+e.key.toString("hex"));if(32!==e.value.length)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return e.value},encode:function(r){return{key:e.from([t]),value:r}},check:function(t){return e.isBuffer(t)&&32===t.length},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.tapInternalKey}}}}).call(this,r(22).Buffer)},4211:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.makeConverter=function(t){return{decode:function(e){if(e.key[0]!==t)throw new Error("Decode Error: could not decode witnessScript with key 0x"+e.key.toString("hex"));return e.value},encode:function(r){return{key:e.from([t]),value:r}},check:function(t){return e.isBuffer(t)},expected:"Buffer",canAdd:function(e,t){return!!e&&!!t&&void 0===e.witnessScript}}}}).call(this,r(22).Buffer)},4212:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const n=r(3588),i=r(3589);t.psbtToBuffer=function({globalMap:t,inputs:r,outputs:n}){const{globalKeyVals:o,inputKeyVals:s,outputKeyVals:a}=u({globalMap:t,inputs:r,outputs:n}),c=i.keyValsToBuffer(o),f=t=>0===t.length?[e.from([0])]:t.map(i.keyValsToBuffer),p=f(s),h=f(a),l=e.allocUnsafe(5);return l.writeUIntBE(482972169471,0,5),e.concat([l,c].concat(p,h))};const o=(e,t)=>e.key.compare(t.key);function s(e,t){const r=new Set,n=Object.entries(e).reduce((e,[n,i])=>{if("unknownKeyVals"===n)return e;const o=t[n];if(void 0===o)return e;const s=(Array.isArray(i)?i:[i]).map(o.encode);return s.map(e=>e.key.toString("hex")).forEach(e=>{if(r.has(e))throw new Error("Serialize Error: Duplicate key: "+e);r.add(e)}),e.concat(s)},[]),i=e.unknownKeyVals?e.unknownKeyVals.filter(e=>!r.has(e.key.toString("hex"))):[];return n.concat(i).sort(o)}function u({globalMap:e,inputs:t,outputs:r}){return{globalKeyVals:s(e,n.globals),inputKeyVals:t.map(e=>s(e,n.inputs)),outputKeyVals:r.map(e=>s(e,n.outputs))}}t.psbtToKeyVals=u}).call(this,r(22).Buffer)}}]);