(this.webpackJsonp=this.webpackJsonp||[]).push([[77],{3138:function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},3165:function(e,t,n){var r=n(951),i=n(2075),o=n(3200),a=n(764),s=n(661),d=n(3202),c=n(2077),u=n(2073),l=c((function(e,t){var n={};if(null==e)return n;var c=!1;t=r(t,(function(t){return t=a(t,e),c||(c=t.length>1),t})),s(e,u(e),n),c&&(n=i(n,7,d));for(var l=t.length;l--;)o(n,t[l]);return n}));e.exports=l},3200:function(e,t,n){var r=n(764),i=n(3138),o=n(3201),a=n(660);e.exports=function(e,t){return t=r(t,e),null==(e=o(e,t))||delete e[a(i(t))]}},3201:function(e,t,n){var r=n(956),i=n(2074);e.exports=function(e,t){return t.length<2?e:r(e,i(t,0,-1))}},3202:function(e,t,n){var r=n(572);e.exports=function(e){return r(e)?void 0:e}},4157:function(e,t,n){var r=n(2127),i=n(1215),o=n(1165),a=n(1164),s=o((function(e,t){return a(e)?r(e,i(t,1,a,!0)):[]}));e.exports=s},4158:function(e,t,n){var r=n(4159),i=n(975),o=n(568),a=n(4160),s=n(173);e.exports=function(e,t,n){var d=s(e)?r:a,c=arguments.length<3;return d(e,o(t,4),n,c,i)}},4159:function(e,t){e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},4160:function(e,t){e.exports=function(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}},4161:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return k})),n.d(t,"c",(function(){return N})),n.d(t,"d",(function(){return F}));var r=n(2),i=n.n(r),o=n(3),a=n.n(o),s=n(13),d=n(84),c=n(127),u=n(55),l=n(26),f=n(3817),p=n(47),h=n(3098),y=n(11),v=n(253),m=n(175),g=n(19),x=n(210);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n,r){return P.apply(this,arguments)}function P(){return(P=a()((function*(e,t,n,r){var i,o,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0;try{o=yield e.evmGetAddress(t,n,w({path:r,showOnOneKey:a,chainId:d},s))}catch(c){throw new g.p(c)}if(o.success&&null!=(i=o.payload)&&i.address)return v.b({address:o.payload.address,impl:y.I});throw Object(h.a)(o.payload)}))).apply(this,arguments)}function I(e){if(!e.success)throw Object(h.a)(e.payload);return e.payload}function k(e){return A.apply(this,arguments)}function A(){return(A=a()((function*(t){var n=t.HardwareSDK,r=t.connectId,i=t.deviceId,o=t.passphraseState,a=t.path,s=t.message,d=t.chainId;if(s.type===x.c.TYPED_DATA_V1)throw u.b.provider.unsupportedMethod("Sign message method="+s.type+" not supported for this device");if(s.type===x.c.ETH_SIGN||s.type===x.c.PERSONAL_SIGN){var c;try{if(!Object(p.e)(s.message))throw new Error("not hex string");c=e.from(s.message.replace("0x",""),"hex")}catch(N){c=e.from("")}var l=s.message;0===c.length&&(l=e.from(s.message,"utf-8").toString("hex"));var y=yield n.evmSignMessage(r,i,w({path:a,messageHex:l,chainId:d},o));if(!y.success)throw Object(h.a)(y.payload);var v=I(y);return"0x"+((null==v?void 0:v.signature)||"")}if(s.type===x.c.TYPED_DATA_V3||s.type===x.c.TYPED_DATA_V4){var m=s.type===x.c.TYPED_DATA_V4,g=JSON.parse(s.message),T=f.TypedDataUtils.sanitizeData(g),b=f.TypedDataUtils.hashStruct("EIP712Domain",T.domain,T.types,m).toString("hex"),P=f.TypedDataUtils.hashStruct(T.primaryType,T.message,T.types,m).toString("hex"),k=yield n.evmSignTypedData(r,i,w({path:a,metamaskV4Compat:!!m,data:g,domainHash:b,messageHash:P,chainId:d},o));if(!k.success)throw Object(h.a)(k.payload);var A=I(k);return"0x"+((null==A?void 0:A.signature)||"")}throw u.b.rpc.methodNotFound("Sign message method="+s.type+" not found")}))).apply(this,arguments)}function N(e,t,n,r,i,o,a){return O.apply(this,arguments)}function O(){return(O=a()((function*(e,t,n,r,i,o,a){var u,f,p,y,v=o.outputs[0];if("undefined"===typeof v.tokenAddress?(p=v.address,y=Object(m.b)(v.value)):(p=v.tokenAddress,y="0x0"),"undefined"===typeof o.feeLimit||"undefined"===typeof o.nonce)throw new g.q("Incomplete unsigned tx.");var x,T,b,P,I=null==(u=o.payload)?void 0:u.EIP1559Enabled;I?x={to:p,value:y,gasLimit:Object(m.b)(o.feeLimit),nonce:"0x"+o.nonce.toString(16),data:(null==(T=o.payload)?void 0:T.data)||"0x",chainId:parseInt(i),maxFeePerGas:Object(m.b)(o.payload.maxFeePerGas),maxPriorityFeePerGas:Object(m.b)(o.payload.maxPriorityFeePerGas)}:x={to:p,value:y,gasPrice:Object(m.b)(null!=(b=o.feePricePerUnit)?b:new l.BigNumber(0)),gasLimit:Object(m.b)(o.feeLimit),nonce:"0x"+o.nonce.toString(16),data:(null==(P=o.payload)?void 0:P.data)||"0x",chainId:parseInt(i)};var k,A,N,O,F={to:x.to,value:x.value,gasPrice:x.gasPrice,gasLimit:x.gasLimit,nonce:parseInt(x.nonce,16),data:x.data,chainId:x.chainId};I&&(F.type=2,F.maxFeePerGas=null!=(k=null==(A=x)?void 0:A.maxFeePerGas)?k:void 0,F.maxPriorityFeePerGas=null!=(N=null==(O=x)?void 0:O.maxPriorityFeePerGas)?N:void 0);try{f=yield e.evmSignTransaction(t,n,w({path:r,transaction:x},a))}catch(G){throw new g.p(G)}if(f.success){var E=f.payload,S=E.v,D=E.r,j=E.s,R=Object(s.splitSignature)({v:Number(S),r:D,s:j}),C=Object(c.serialize)(F,R);return{txid:Object(d.keccak256)(C),rawTx:C}}throw Object(h.a)(f.payload)}))).apply(this,arguments)}function F(e,t,n,r,i,o,a,s,d){return E.apply(this,arguments)}function E(){return(E=a()((function*(e,t,n,r,i,o,a,s,d){if(t!==y.I||"address"!==r)return Promise.resolve([]);var c,u=n.length>1;try{c=u?yield e.evmGetAddress(o,a,w({bundle:n.map((function(e){return{path:e,showOnOneKey:!1,chainId:d}}))},s)):yield e.evmGetAddress(o,a,w({path:n[0],showOnOneKey:!1,chainId:d},s))}catch(l){throw new g.p(l)}if(c.success)return c.payload instanceof Array?c.payload.map((function(e){var n=e.path,r=e.address;return{path:n,info:v.b({address:r,impl:t})}})):[{path:c.payload.path,info:v.b({address:c.payload.address,impl:t})}];throw Object(h.a)(c.payload)}))).apply(this,arguments)}}).call(this,n(22).Buffer)},5677:function(e,t,n){"use strict";n.r(t),n.d(t,"IDecodedTxEvmType",(function(){return je})),n.d(t,"default",(function(){return Ge}));var r=n(3165),i=n.n(r),o=n(781),a=n.n(o),s=n(4157),d=n.n(s),c=n(788),u=n.n(c),l=n(112),f=n.n(l),p=n(146),h=n.n(p),y=n(15),v=n.n(y),m=n(4158),g=n.n(m),x=n(16),T=n.n(x),w=n(2),b=n.n(w),P=n(10),I=n.n(P),k=n(3),A=n.n(k),N=n(6),O=n.n(N),F=n(9),E=n.n(F),S=n(12),D=n.n(S),j=n(5),R=n.n(j),C=n(303),G=n(26),_=n.n(G),B=n(126),L=n.n(B),V=n(606),K=n(117),U=n(136),M=n(47),H=n(36),W=n(11),q=n(20),J=n(175),z=n(19),Y=n(1103),Z=n(184),X=n(468),Q=n(961),$=n(950),ee=n(716),te=n(210),ne=n(56),re=n(465),ie=n(3093),oe=n(324),ae=n(486),se=n(495),de=n(3098),ce=n(253),ue=n(4161),le=n(310),fe=n(89),pe=n(3094),he=n(109);function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function me(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R()(e);if(t){var i=R()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D()(this,n)}}var ge=function(e){E()(n,e);var t=me(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=A()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getAccountPath(),r=yield this.getNetworkChainId(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,s=yield this.getWalletPassphraseState();return ue.c(t,o,a,n,r,e,s)}));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=A()((function*(e,t){var n=yield this.getHardwareSDKInstance(),r=yield this.getAccountPath(),i=yield this.getNetworkChainId(),o=yield this.getHardwareInfo(),a=o.connectId,s=o.deviceId,d=yield this.getWalletPassphraseState();return Promise.all(e.map((function(e){return ue.b({HardwareSDK:n,connectId:a,deviceId:s,passphraseState:d,path:r,message:e,chainId:Number(i)})})))}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=A()((function*(e){var t,n=this,r=yield this.getHardwareSDKInstance(),i=yield this.getNetworkChainId(),o=yield this.getHardwareInfo(),a=o.connectId,s=o.deviceId,d=yield this.getWalletPassphraseState(),c=e.indexes,u=e.names,l=e.type,f=e.template,p=e.coinType,h=Object(le.g)(f),y=h.pathPrefix,v=h.pathSuffix,m=f===(yield this.vault.getAccountNameInfoMap()).ledgerLive.template,g=c.map((function(e){return y+"/"+v.replace("{index}",""+e)}));if("SEARCH_ACCOUNTS"===l){var x,T={path:y,showOnOneKey:!1,chainId:Number(i)};m&&(T={bundle:g.map((function(e){return{path:e,showOnOneKey:!1,chainId:Number(i)}})),useBatch:!0});try{x=yield r.evmGetPublicKey(a,s,ve(ve({},T),d))}catch(j){throw q.a.engine.error(j),new z.p(j)}if(!x.success)throw Object(de.a)(x.payload);if(m)t=yield Promise.all(x.payload.map(function(){var e=A()((function*(e){return{path:e.path,info:ce.b({address:yield n.engine.providerManager.addressFromPub(n.networkId,e.publicKey),impl:W.I})}}));return function(t){return e.apply(this,arguments)}}()));else{var w=x.payload.xpub,b=he.a.utils.HDNode.fromExtendedKey(w);t=c.map((function(e){return{path:y+"/"+v.replace("{index}",""+e),info:ce.b({address:b.derivePath(""+e).address,impl:W.I})}}))}}else t=yield ue.d(r,W.I,g,"address",l,a,s,d,Number(i));var P=[],I=0,k=yield this.getNetworkImpl(),N=Object(Z.b)(k,f).prefix,O=Object(Z.a)(k).ledgerLive.template===f;for(var F of t){var E=F.path,S=F.info,D=(u||[])[I]||N+" #"+(c[I]+1);P.push({id:O?this.walletId+"--"+E+"--LedgerLive":this.walletId+"--"+E,name:D,type:fe.b.SIMPLE,path:E,coinType:p,pub:"",address:S,template:f}),I+=1}return P}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=A()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getNetworkChainId(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState();return yield ue.a(t,i,o,e.path,e.showOnOneKey,a,Number(n))}));return function(t){return e.apply(this,arguments)}}(),O()(n)}(pe.a),xe=n(428);function Te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R()(e);if(t){var i=R()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D()(this,n)}}var we=function(e){E()(n,e);var t=Te(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=A()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new z.q("EVM signers number should be 1.");if(t[0]!==r.address)throw new z.q("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new z.q("Unable to get signer.");return(n={})[r.address]=new $.b(i,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=A()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=e.coinType,o=e.template,a=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,s=Object(le.g)(o),d=s.pathPrefix,c=s.pathSuffix,u=Object(xe.d)("secp256k1",a,t,d,n.map((function(e){return c.replace("{index}",e.toString())})));if(u.length!==n.length)throw new z.q("Unable to get publick key.");var l=[],f=0,p=yield this.getNetworkImpl(),h=Object(Z.b)(p,o).prefix;for(var y of u){var v=y.path,m=y.extendedKey.key.toString("hex"),g=yield this.engine.providerManager.addressFromPub(this.networkId,m),x=(r||[])[f]||h+" #"+(n[f]+1),T=Object(Z.a)(p).ledgerLive.template===o;l.push({id:T?this.walletId+"--"+v+"--LedgerLive":this.walletId+"--"+v,name:x,type:fe.b.SIMPLE,path:v,coinType:i,pub:m,address:g,template:o}),f+=1}return l}));return function(t){return e.apply(this,arguments)}}(),O()(n)}(n(3095).a),be=n(514);function Pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R()(e);if(t){var i=R()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D()(this,n)}}var Ie=function(e){E()(n,e);var t=Pe(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=A()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new z.q("EVM signers number should be 1.");if(t[0]!==r.address)throw new z.q("Wrong address required for signing.");var i=Object.values(yield this.getPrivateKeys(e)),o=I()(i,1)[0];return(n={})[r.address]=new $.b(o,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=A()((function*(e){var t=e.name,n=e.privateKey;if(32!==n.length)throw new z.q("Invalid private key.");var r=be.c.publicFromPrivate(n).toString("hex"),i=yield this.engine.providerManager.addressFromPub(this.networkId,r);return Promise.resolve([{id:"imported--"+W.n+"--"+r,name:t||"",type:fe.b.SIMPLE,path:"",coinType:W.n,pub:r,address:i}])}));return function(t){return e.apply(this,arguments)}}(),O()(n)}(n(3096).a);function ke(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R()(e);if(t){var i=R()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D()(this,n)}}var Ae=function(e){E()(n,e);var t=ke(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=A()((function*(e,t){var n,r=null==(n=e.payload)?void 0:n.encodedTx,i=yield this.getDbAccount();return q.a.sendTx.info("KeyringWatching > signTransaction >>>>> ",i.address,r),Promise.resolve({txid:"1111",rawTx:"11118888"})}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=A()((function*(e){var t=e.name,n=e.target,r=e.accountIdPrefix,i=yield this.engine.providerManager.verifyAddress(this.networkId,n),o=i.normalizedAddress;if(!i.isValid||"undefined"===typeof o)throw new z.f;return Promise.resolve([{id:r+"--"+W.n+"--"+o,name:t||"",type:fe.b.SIMPLE,path:"",coinType:W.n,pub:"",address:o}])}));return function(t){return e.apply(this,arguments)}}(),O()(n)}(n(3097).a),Ne=n(2093),Oe=["to","value","data","gas","gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","nonce"],Fe=["gas","gasLimit"];function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){b()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function De(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R()(e);if(t){var i=R()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return D()(this,n)}}var je,Re=[H.a.optimism,H.a.toptimism];function Ce(e){var t,n,r,i,o,a;return{feeLimit:null==(t=e.feeLimit)?void 0:t.toFixed(),feePricePerUnit:null==(n=e.feePricePerUnit)?void 0:n.toFixed(),maxPriorityFeePerGas:null==(r=e.payload)||null==(i=r.maxPriorityFeePerGas)?void 0:i.toFixed(),maxFeePerGas:null==(o=e.payload)||null==(a=o.maxFeePerGas)?void 0:a.toFixed()}}!function(e){e.NativeTransfer="NativeTransfer",e.TokenTransfer="TokenTransfer",e.TokenApprove="TokenApprove",e.Swap="Swap",e.NftTransfer="NftTransfer",e.Transaction="Transaction",e.ContractDeploy="ContractDeploy"}(je||(je={}));var Ge=function(e){E()(n,e);var t=De(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).settings=Ne.default,e.keyringMap={hd:we,hw:ge,imported:Ie,watching:Ae,external:Ae},e.decodeTxMemoizee=L()(function(){var t=A()((function*(t,n){return e.decodeTx(t,n)}));return function(e,n){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,normalizer:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return JSON.stringify(t)},max:1,maxAge:Object(M.b)({minute:3})}),e.isContractAddress=L()(function(){var t=A()((function*(t){try{yield e.validateAddress(t);var n=yield e.getJsonRPCClient();return yield n.isContract(t)}catch(r){return Promise.resolve(!1)}}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:50}),e}var r=n.prototype;return r.getEthersProvider=function(){var e=A()((function*(){var e,t,n=yield this.getNetwork(),r=n.rpcURL;return this._ethersProvider&&(null==(e=this._ethersProvider)||null==(t=e.connection)?void 0:t.url)===r||(this._ethersProvider=new he.a.providers.JsonRpcProvider(n.rpcURL)),this._ethersProvider}));return function(){return e.apply(this,arguments)}}(),r.getJsonRPCClient=function(){var e=A()((function*(){return yield this.engine.providerManager.getClient(this.networkId)}));return function(){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){throw new Error("decodedTxToLegacy in EVM not implemented.")},r.decodeTx=function(){var e=A()((function*(e,t){var n=yield this.legacyDecodeTx(e,t);return yield this.decodedTxLegacyToModern({decodedTxLegacy:n,encodedTx:e,payload:t})}));return function(t,n){return e.apply(this,arguments)}}(),r.decodeBatchTransferTx=function(){var e=A()((function*(e,t,n){var r,i=ae.b.getDecoder(this.engine),o=yield this.helper.parseToNativeTx(t);Number.isFinite(o.chainId)||(o.chainId=Number(yield this.getNetworkChainId()));var a=i.parseBatchTransfer(o),s=I()(a,1)[0];if(!s)return null;var d=[],c=yield this.getNetwork(),u=yield this.getAccountAddress();switch(s.name){case"disperseEther":for(var l=s.args[0],f=s.args[1],p=yield this.engine.getNativeTokenInfo(this.networkId),h=0;h<l.length;h+=1)d.push({type:ne.a.NATIVE_TRANSFER,direction:yield this.buildTxActionDirection({from:t.from,to:l[h],address:u}),nativeTransfer:yield this.buildNativeTransferAction({fromAddress:t.from,toAddress:l[h],amount:new _.a(f[h].toString()).shiftedBy(-p.decimals).toFixed(),value:f[h].toString()})});break;case"disperseToken":case"disperseTokenSimple":var y=s.args[0],v=s.args[1],m=s.args[2],g=yield this.engine.ensureTokenInDB(this.networkId,y);if(!g)break;for(var x=0;x<v.length;x+=1)d.push({type:ne.a.TOKEN_TRANSFER,direction:yield this.buildTxActionDirection({from:t.from,to:v[x],address:u}),tokenTransfer:yield this.buildTokenTransferAction({info:{token:g,from:t.from,recipient:v[x],amount:new _.a(m[x].toString()).shiftedBy(-g.decimals).toFixed(),amountValue:m[x].toString()}})});break;case"disperseNFT":for(var T=s.args[0],w=s.args[1],b=s.args[2],P=s.args[3],k=0;k<P.length;k+=1){var A,N=(null==n||null==(A=n.nftInfos)?void 0:A[k].asset)||(yield Object(X.d)({accountId:this.accountId,networkId:this.networkId,contractAddress:w[k],tokenId:new _.a(b[k].toString()).toFixed(),local:!0}));N&&d.push({type:ne.a.NFT_TRANSFER,direction:yield this.buildTxActionDirection({from:t.from,to:T,address:u}),nftTransfer:yield this.buildNFTTransferAcion({asset:N,amount:new _.a(P[k].toString()).toFixed(),from:t.from,to:T})})}break;default:return null}var O,F=e.gasInfo,E=new _.a(F.gasLimit).toFixed();return O=F.maxFeePerGas?{eip1559:!0,limit:E,price:{baseFee:"0",maxPriorityFeePerGas:new _.a(F.maxPriorityFeePerGas).shiftedBy(-c.feeDecimals).toFixed(),maxPriorityFeePerGasValue:F.maxPriorityFeePerGas,maxFeePerGas:new _.a(F.maxFeePerGas).shiftedBy(-c.feeDecimals).toFixed(),maxFeePerGasValue:F.maxFeePerGas,gasPrice:new _.a(F.gasPrice||F.maxFeePerGas).shiftedBy(-c.feeDecimals).toFixed(),gasPriceValue:F.gasPrice||F.maxFeePerGas}}:{limit:E,price:new _.a(F.gasPrice).shiftedBy(-c.feeDecimals).toFixed(),priceValue:F.gasPrice},{txid:e.txHash,owner:u,signer:t.from||u,nonce:new _.a(null!=(r=t.nonce)?r:0).toNumber(),actions:[].concat(d),status:ne.c.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:t,feeInfo:O,payload:n,extraInfo:null}}));return function(t,n,r){return e.apply(this,arguments)}}(),r.legacyDecodeTx=function(){var e=A()((function*(e,t){var n=yield this.helper.parseToNativeTx(e);return Number.isFinite(n.chainId)||(n.chainId=Number(yield this.getNetworkChainId())),ae.b.getDecoder(this.engine).decodeTx({vault:this,rawTx:n,payload:t})}));return function(t,n){return e.apply(this,arguments)}}(),r.decodedTxLegacyToModern=function(){var e=A()((function*(e){var t=e.decodedTxLegacy,n=e.encodedTx,r=e.payload,i=e.interactInfo;if(n.to===Q.a[this.networkId]){var o=yield this.decodeBatchTransferTx(t,n,r);if(o)return o}var a,s=yield this.getAccountAddress(),d=yield this.getNetwork(),c=yield this.engine.getNativeTokenInfo(this.networkId),u={type:ne.a.UNKNOWN,direction:yield this.buildTxActionDirection({from:t.fromAddress,to:t.toAddress,address:s}),unknownAction:{extraInfo:{}}};if(n.value){var l=new _.a(n.value);!l.isNaN()&&l.gt(0)&&(a={type:ne.a.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:c,from:n.from||t.fromAddress,to:n.to,amount:l.shiftedBy(-d.decimals).toFixed(),amountValue:l.toFixed(),extraInfo:null}})}if(t.txType===ae.a.NATIVE_TRANSFER&&(u.type=ne.a.NATIVE_TRANSFER,u.nativeTransfer=yield this.buildNativeTransferAction(t),a=void 0),t.txType===ae.a.TOKEN_TRANSFER&&(u.type=ne.a.TOKEN_TRANSFER,u.tokenTransfer=yield this.buildTokenTransferAction(t)),t.txType===ae.a.TOKEN_APPROVE){var f,p=t.info;u.type=ne.a.TOKEN_APPROVE,u.tokenApprove={tokenInfo:p.token,owner:null!=(f=n.from)?f:s,spender:p.spender,amount:p.amount,amountValue:p.value,isMax:p.isUInt256Max,extraInfo:null}}if(t.txType===ae.a.ERC721_TRANSFER||t.txType===ae.a.ERC1155_TRANSFER){var h=null;if(null!=r&&r.nftInfo)h=null==r?void 0:r.nftInfo;else if(t.contractCallInfo){var y=t.contractCallInfo,v=y.args||[],m=I()(v,4),g=m[0],x=m[1],T=m[2],w=m[3],b=yield Object(X.d)({accountId:this.accountId,networkId:this.networkId,contractAddress:y.contractAddress,tokenId:T,local:!0});b&&(h={from:g,to:x,amount:new _.a(w).toFixed(),asset:b})}h&&(u.type=ne.a.NFT_TRANSFER,u.nftTransfer=yield this.buildNFTTransferAcion(h))}"InternalSwap"===(null==r?void 0:r.type)&&null!=r&&r.swapInfo&&(u.internalSwap=Se(Se({},r.swapInfo),{},{extraInfo:null}),u.type=ne.a.INTERNAL_SWAP,a=void 0),"InternalStake"===(null==r?void 0:r.type)&&null!=r&&r.stakeInfo&&(u.internalStake=Se(Se({},r.stakeInfo),{},{extraInfo:null}),u.type=ne.a.INTERNAL_STAKE,a=void 0);var P,k=t.gasInfo,A=new _.a(k.gasLimit).toFixed();return P=k.maxFeePerGas?{eip1559:!0,limit:A,price:{baseFee:"0",maxPriorityFeePerGas:new _.a(k.maxPriorityFeePerGas).shiftedBy(-d.feeDecimals).toFixed(),maxPriorityFeePerGasValue:k.maxPriorityFeePerGas,maxFeePerGas:new _.a(k.maxFeePerGas).shiftedBy(-d.feeDecimals).toFixed(),maxFeePerGasValue:k.maxFeePerGas,gasPrice:new _.a(k.gasPrice||k.maxFeePerGas).shiftedBy(-d.feeDecimals).toFixed(),gasPriceValue:k.gasPrice||k.maxFeePerGas}}:{limit:A,price:new _.a(k.gasPrice).shiftedBy(-d.feeDecimals).toFixed(),priceValue:k.gasPrice},{txid:t.txHash,owner:s,signer:t.fromAddress,nonce:t.nonce||0,actions:[u,a].filter(Boolean),status:ne.c.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:n,payload:r,feeInfo:P,interactInfo:i,extraInfo:{}}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=A()((function*(e){var t=yield this.getNetwork(),n=Boolean(e.token),r=e.amount,i=e.tokenId,o=e.isNFT,a=e.type,s=new _.a(r);if(s.isNaN()&&(s=new _.a("0")),n){var d,c;if(o&&a&&i){var u,l=Object(X.a)({type:a,from:e.from,to:e.to,id:i,amount:s.toFixed()});return{from:e.from,to:null!=(u=e.token)?u:"",value:"0x0",data:l}}var f=yield this.engine.ensureTokenInDB(this.networkId,null!=(d=e.token)?d:"");if(!f)throw new Error("Token not found: "+e.token);var p=Object(J.b)(s.shiftedBy(f.decimals)),h=""+oe.d.tokenTransfer+C.b.encode(["address","uint256"],[e.to,p]).slice(2);return{from:e.from,to:null!=(c=e.token)?c:"",value:"0x0",data:h}}var y=Object(J.b)(s.shiftedBy(t.decimals));return{from:e.from,to:e.to,value:y,data:"0x"}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var e=A()((function*(e,t,n){var r,i,o,a=yield this.getNetwork(),s=yield this.getDbAccount(),d=e[0],c=Boolean(d.token),u=d.tokenId,l=d.isNFT,f=d.type,p=void 0!==t?t+1:yield this.getNextNonce(a.id,s),h=Q.a[a.id];if(!h)throw new Error(a.name+" has not deployed a batch transfer contract");var y=new _.a(0);if(c)if(l&&f&&u)r=oe.b.disperseNFT,i=["address","address[]","uint256[]","uint256[]"],o=[d.to].concat(T()(g()(e,(function(e,t){return e[0].push(t.token||""),e[1].push(t.tokenId||""),e[2].push(new _.a("erc1155"===t.type?t.amount:0).toFixed()),e}),[[],[],[]])));else{var v,m=yield this.engine.ensureTokenInDB(this.networkId,null!=(v=d.token)?v:"");if(!m)throw new Error("Token not found: "+d.token);r=oe.b.disperseTokenSimple,i=["address","address[]","uint256[]"],o=[m.tokenIdOnNetwork].concat(T()(g()(e,(function(e,t){var n=new _.a(t.amount);return e[0].push(t.to),e[1].push(Object(J.b)(n.shiftedBy(m.decimals))),e}),[[],[]])))}else r=oe.b.disperseEther,i=["address[]","uint256[]"],o=g()(e,(function(e,t){var n=new _.a(t.amount).shiftedBy(a.decimals);return y=y.plus(n),e[0].push(t.to),e[1].push(n.toFixed()),e}),[[],[]]);return{from:d.from,to:h,data:""+r+C.b.encode(i,o).slice(2),value:c?"0x0":Object(J.b)(y),nonce:String(p)}}));return function(t,n,r){return e.apply(this,arguments)}}(),r.buildEncodedTxFromWrapperTokenDeposit=function(e){var t=e.amount,n=e.from,r=e.contract,i=oe.g.doposit,o=new _.a(t),a=Object(J.b)(o.shiftedBy(18));return{from:n,to:r,value:a,data:""+i+C.b.encode(["uint256"],[a]).slice(2)}},r.buildEncodedTxFromWrapperTokenWithdraw=function(e){var t=e.amount,n=e.from,r=e.contract,i=oe.g.withdraw,o=new _.a(t),a=Object(J.b)(o.shiftedBy(18));return{from:n,to:r,value:"0x0",data:""+i+C.b.encode(["uint256"],[a]).slice(2)}},r.buildEncodedTxFromApprove=function(){var e=A()((function*(e,t){var n=yield Promise.all([this.getNetwork(),this.engine.ensureTokenInDB(this.networkId,e.token),this.validateAddress(e.spender),this.getDbAccount()]),r=I()(n,4),i=r[0],o=r[1],a=r[2],s=r[3];if("undefined"===typeof o)throw new Error("Token not found: "+e.token);var d=void 0!==t?t+1:yield this.getNextNonce(i.id,s),c=new _.a(e.amount),u=Object(J.b)(c.isNaN()?new _.a(2).pow(256).minus(1):c.shiftedBy(o.decimals)),l=""+oe.d.tokenApprove+C.b.encode(["address","uint256"],[a,u]).slice(2);return{from:e.from,to:e.token,value:"0x0",data:l,nonce:String(d)}}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var e=A()((function*(e,t){var n=yield this.getNetwork(),r=yield this.getDbAccount(),i=void 0!==t?t+1:yield this.getNextNonce(n.id,r),o=e.map((function(e,t){return{from:e.from,to:e.to,data:""+("erc1155"===e.type?oe.c.setApprovalForAll:oe.e.setApprovalForAll)+C.b.encode(["address","bool"],[e.spender,e.approved]).slice(2),value:"0x0",nonce:i+t}}));return Promise.resolve(o)}));return function(t,n){return e.apply(this,arguments)}}(),r.updateEncodedTx=function(){var e=A()((function*(e,t,n){if(n.type===ne.d.tokenApprove){var r=t;return this.updateEncodedTxTokenApprove(e,r.amount)}return n.type===ne.d.transfer?this.updateEncodedTxTransfer(e,t):Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),r.updateEncodedTxTransfer=function(){var e=A()((function*(e,t){var n=yield this.legacyDecodeTx(e),r=t.amount,i=new _.a(r);if(n.txType===ae.a.NATIVE_TRANSFER){var o=yield this.getNetwork();e.value=Object(J.b)(i.shiftedBy(o.decimals))}if(n.txType===ae.a.TOKEN_TRANSFER){var a=n.info,s=Object(J.b)(i.shiftedBy(a.token.decimals)),d=""+oe.d.tokenTransfer+C.b.encode(["address","uint256"],[a.recipient,s]).slice(2);e.data=d}return e}));return function(t,n){return e.apply(this,arguments)}}(),r.updateEncodedTxTokenApprove=function(){var e=A()((function*(e,t){var n=oe.d.tokenApprove,r=yield this.legacyDecodeTx(e);if(r.txType!==ae.a.TOKEN_APPROVE)throw new Error("Not a approve transaction.");var i,o=r.info,a=o.token,s=o.spender;if(t===ae.d||t===ae.c)i=ae.c;else{var d=new _.a(t);if(d.isNaN())throw new Error("Invalid amount input: "+t);i=Object(J.b)(d.shiftedBy(a.decimals))}var c=""+n+C.b.encode(["address","uint256"],[s,i]).slice(2);return Se(Se({},e),{},{data:c})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=A()((function*(e){var t=yield this.getNetwork(),n=yield this.getDbAccount(),r=e.to,i=e.value,o=e.data,a=e.gas,s=e.gasLimit,d=e.gasPrice,c=e.maxFeePerGas,u=e.maxPriorityFeePerGas,l=e.nonce,f=v()(e,Oe);q.a.sendTx.info("buildUnsignedTxFromEncodedTx >>>> encodedTx",e);var p=null!=s?s:a,y=new _.a(null!=l?l:"NaN"),m=y.isNaN()?yield this.getNextNonce(t.id,n):y.toNumber(),g=Object($.d)({shiftFeeDecimals:!1,network:t,dbAccount:n,to:r,valueOnChain:i,extra:Se({data:o,feeLimit:h()(p)?void 0:new _.a(p),feePricePerUnit:h()(d)?void 0:new _.a(d),maxFeePerGas:c,maxPriorityFeePerGas:u,nonce:m},f)});q.a.sendTx.info("buildUnsignedTxFromEncodedTx >>>> fillUnsignedTx",g,Ce(g));var x=yield this.engine.providerManager.buildUnsignedTx(this.networkId,g);return q.a.sendTx.info("buildUnsignedTxFromEncodedTx >>>> buildUnsignedTx",x,Ce(x)),e.nonce=m,Se(Se({},x),{},{encodedTx:e})}));return function(t){return e.apply(this,arguments)}}(),r._toNormalAmount=function(e,t){var n=he.a.BigNumber.from(e);return he.a.utils.formatUnits(n,t)},r.fetchFeeInfo=function(){var e=A()((function*(e){var t,n,r,i,o,a,s,d,c=Se(Se({},e),{},{nonce:1,gasPrice:"1"}),l=c.gas,p=c.gasLimit,h=v()(c,Fe),y=yield this.getNetwork(),m=yield this.engine.getGasPrice(this.networkId),g=null==(t=this.settings.subNetworkSettings)?void 0:t[this.networkId];null!=g&&g.isIntegerGasPrice&&(m=m.map((function(e){return f()(e)?new _.a(e).toFixed(0):e})));var x,T=(yield this.decodeTxMemoizee(e)).actions;if(1===T.length&&(null==T||null==(n=T[0])?void 0:n.type)===ne.a.NATIVE_TRANSFER)try{x=yield this.buildUnsignedTxFromEncodedTx(Se(Se({},h),{},{value:"0x0"}))}catch(D){}if("undefined"===typeof x)try{x=yield this.buildUnsignedTxFromEncodedTx(h)}catch(j){throw q.a.common.error(j),j}var w="0";if(Re.includes(this.networkId)){var b,P,I=he.a.utils.serializeTransaction({value:e.value,data:e.data,gasLimit:"0x"+(null!=(b=null==(P=x)?void 0:P.feeLimit)?b:new _.a("0")).toString(16),to:e.to,chainId:10,gasPrice:"0xf4240",nonce:1}),k="0x49948e0e"+C.b.encode(["bytes"],[I]).slice(2),A=yield this.getJsonRPCClient(),N=yield A.rpc.call("eth_call",[{to:"0x420000000000000000000000000000000000000F",data:k},"latest"]);w=new _.a(N).shiftedBy(-y.feeDecimals).toFixed()}var O=Boolean((null==(r=m)?void 0:r.length)&&(null==(i=m)?void 0:i.every((function(e){return"object"===typeof e})))),F=new _.a(null!=(o=null!=(a=e.gas)?a:e.gasLimit)?o:0).toFixed(),E=e.gasPrice?this._toNormalAmount(e.gasPrice,y.feeDecimals):void 0;O&&(E=u()(Se({},m[0]),{maxPriorityFeePerGas:e.maxPriorityFeePerGas?this._toNormalAmount(e.maxPriorityFeePerGas,y.feeDecimals):void 0,maxFeePerGas:e.maxFeePerGas?this._toNormalAmount(e.maxFeePerGas,y.feeDecimals):void 0}));var S=_.a.max(null!=(s=null==(d=x)?void 0:d.feeLimit)?s:"0",null!=l?l:"0",null!=p?p:"0").toFixed();return{nativeSymbol:y.symbol,nativeDecimals:y.decimals,feeSymbol:y.feeSymbol,feeDecimals:y.feeDecimals,eip1559:O,limit:S,prices:m,defaultPresetIndex:"1",tx:{eip1559:O,limit:F,price:E},baseFeeValue:w}}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=A()((function*(e){var t=yield this.getNetwork(),n=e.encodedTx,r=e.feeInfoValue,i=Se({},n);if(h()(r.limit)||(i.gas=Object(J.b)(new _.a(r.limit)),i.gasLimit=Object(J.b)(new _.a(r.limit))),!h()(r.price))if(r.eip1559){var o=r.price;i.maxFeePerGas=Object(J.b)(new _.a(o.maxFeePerGas).shiftedBy(t.feeDecimals)),i.maxPriorityFeePerGas=Object(J.b)(new _.a(o.maxPriorityFeePerGas).shiftedBy(t.feeDecimals)),delete i.gasPrice}else i.gasPrice=Object(J.b)(new _.a(r.price).shiftedBy(t.feeDecimals));return Promise.resolve(i)}));return function(t){return e.apply(this,arguments)}}(),r.mmGetPublicKey=function(){var e=A()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=e.password;if("undefined"===typeof r)throw new z.q("password required");var i=(yield n.getSigners(r,[t.address]))[t.address];return this.engineProvider.mmGetPublicKey(i)}throw new z.l("Only software keryings support getting encryption key.")}));return function(t){return e.apply(this,arguments)}}(),r.mmDecrypt=function(){var e=A()((function*(e,t){var n=yield this.getDbAccount();if(n.id.startsWith("hd-")||n.id.startsWith("imported")){var r=this.keyring,i=t.password;if("undefined"===typeof i)throw new z.q("password required");var o=(yield r.getSigners(i,[n.address]))[n.address];return this.engineProvider.mmDecrypt(e,o)}throw new z.l("Only software keryings support mm decryption.")}));return function(t,n){return e.apply(this,arguments)}}(),r.personalECRecover=function(){var e=A()((function*(e,t){return this.engineProvider.ecRecover({type:te.c.PERSONAL_SIGN,message:e},t)}));return function(t,n){return e.apply(this,arguments)}}(),r.getTokenAllowance=function(){var e=A()((function*(e,t){var n=yield Promise.all([this.getDbAccount(),this.engine.ensureTokenInDB(this.networkId,e)]),r=I()(n,2),i=r[0],o=r[1];if("undefined"===typeof o)throw new Error;var a="0xdd62ed3e"+C.b.encode(["address","address"],[i.address,t]).slice(2),s=yield this.getJsonRPCClient(),d=yield s.rpc.call("eth_call",[{to:o.tokenIdOnNetwork,data:a},"latest"]);return new _.a(d).shiftedBy(-o.decimals)}));return function(t,n){return e.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var e=A()((function*(e,t){for(var n=[],r=0;r<t.length;r+=1){var i=t[r],o=yield Promise.all([this.getDbAccount(),this.engine.ensureTokenInDB(this.networkId,e)]),a=I()(o,2),s=a[0],d=a[1];if("undefined"===typeof d)throw new Error;var c="0xdd62ed3e"+C.b.encode(["address","address"],[s.address,i]).slice(2);n.push({to:d.tokenIdOnNetwork,data:c})}var u=yield this.getJsonRPCClient();return(yield u.batchEthCall(n)).map((function(e){return Number(e)}))}));return function(t,n){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=A()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,displayAddress:he.a.utils.getAddress(e.address),template:e.template}}));return function(){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=A()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),i=I()(r,1)[0];return"0x"+Object(K.a)(e,i).toString("hex")}throw new z.q("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.buildNativeTransferAction=function(){var e=A()((function*(e){return{tokenInfo:yield this.engine.getNativeTokenInfo(this.networkId),from:e.fromAddress,to:e.toAddress,amount:e.amount,amountValue:e.value,extraInfo:null}}));return function(t){return e.apply(this,arguments)}}(),r.buildTokenTransferAction=function(){var e=A()((function*(e){var t,n=yield this.getAccountAddress(),r=e.info;return{tokenInfo:r.token,from:null!=(t=r.from)?t:n,to:r.recipient,amount:r.amount,amountValue:r.value,extraInfo:null}}));return function(t){return e.apply(this,arguments)}}(),r.buildNFTTransferAcion=function(){var e=A()((function*(e){return Promise.resolve({asset:e.asset,amount:e.amount,send:e.from,receive:e.to,extraInfo:null})}));return function(t){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=A()((function*(e){var t=yield this.getJsonRPCClient();try{return yield t.rpc.call(e.method,e.params)}catch(n){throw Object($.c)(n)}}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){return new V.a(e)},r.fetchTokenInfos=function(e){return this.engine.providerManager.getTokenInfos(this.networkId,e)},r.getAccountNonce=function(){var e=A()((function*(){return yield Object(se.b)(yield this.getAccountAddress(),this)}));return function(){return e.apply(this,arguments)}}(),r.updatePendingTxs=function(){var e=A()((function*(e){var t=ae.b.getDecoder(this.engine),n=e.filter((function(e){return"rawTx"in e})).filter((function(e){return e.status===ee.a.PENDING})).map(function(){var e=A()((function*(e){return{entry:e,decodedItem:yield t.decodeHistoryEntry(e)}}));return function(t){return e.apply(this,arguments)}}());if(!n.length)return{};var r=yield Promise.all(n),i=yield this.getTransactionStatuses(r.map((function(e){return e.decodedItem.txHash}))),o=r[0].decodedItem.fromAddress,a=yield Object(se.b)(o,this),s={};return i.forEach((function(e,t){var n=r[t],i=n.entry,o=n.decodedItem,d=i.id,c=o.nonce;e===U.a.NOT_FOUND||e===U.a.INVALID?!h()(c)&&c<a&&(s[d]=ee.a.DROPPED):e===U.a.CONFIRM_AND_SUCCESS?s[d]=ee.a.SUCCESS:e===U.a.CONFIRM_BUT_FAILED&&(s[d]=ee.a.FAILED)})),Object.keys(s).length>0&&(yield this.engine.dbApi.updateHistoryEntryStatuses(s)),s}));return function(t){return e.apply(this,arguments)}}(),r.mergeDecodedTx=function(){var e=A()((function*(e){var t,n=e.decodedTx,r=(e.encodedTx,e.historyTx),i=(e.rawTx,e.covalentTx),o=(e.rpcReceiptTx,e.nftTxs),a=e.isCovalentApiAvailable,s=yield this.getNetwork();r&&(n=Se(Se({},r.decodedTx),{},{encodedTx:null!=(t=n.encodedTx)?t:r.decodedTx.encodedTx}));if(i){var d,c,u=new Date(i.block_signed_at).getTime();n.updatedAt=u,n.createdAt=null!=(d=n.createdAt)?d:u,n.status=i.successful?ne.c.Confirmed:ne.c.Failed,n.signer=i.from_address||n.signer,n.outputActions=(null==(c=i.parsedDecodedTx)?void 0:c.outputActions)||n.outputActions;var l=new _.a(i.gas_price).toFixed(),f=Object(re.d)({value:l,network:s}),p=new _.a(i.gas_offered).toFixed(),h=new _.a(i.gas_spent).toFixed(),y={priceValue:l,price:f,limit:p,limitUsed:h};if(n.feeInfo=n.feeInfo||y,n&&n.feeInfo&&(n.feeInfo.limitUsed=h,n.feeInfo.limit=p,n.feeInfo.eip1559)){var v=n.feeInfo.price;v.gasPrice=f,v.gasPriceValue=l}n.isFinal=!0}n.status!==ne.c.Pending&&(a||n.createdAt&&Date.now()-n.createdAt>W.y.SET_IS_FINAL_EXPIRED_IN&&(n.isFinal=!0));var m=yield this.getAccountAddress();return n=this.mergeNFTTx({address:m,decodedTx:n,nftTxs:o}),Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.mergeNFTTx=function(e){var t=e.address,n=e.decodedTx,r=e.nftTxs;if(r){var i,o=r.map((function(e){return Object(X.b)({transaction:e,address:t})})).filter(Boolean),a=null!=(i=n.outputActions)?i:[],s=null==a?void 0:a.filter((function(e){var t=e.tokenTransfer,n=e.tokenApprove,i=e.nftTransfer;if(t||n||i){var o,a=null!=(o=null==t?void 0:t.tokenInfo)?o:null==n?void 0:n.tokenInfo,s=null==i?void 0:i.asset;if(a){var d=a.tokenIdOnNetwork,c=a.id;if(r.find((function(e){return e.contractAddress===d&&e.tokenId===c})))return!1}if(s)if(r.find((function(e){return(e.contractAddress===s.contractAddress||e.tokenAddress===s.tokenAddress)&&(e.tokenId===s.tokenId||e.contractTokenId===s.contractTokenId)})))return!1}return!0}));n.outputActions=[].concat(T()(s),T()(o))}return n},r.fetchOnChainHistory=function(){var e=A()((function*(e){var t=this,n=e.tokenIdOnNetwork,r=e.localHistory,i=void 0===r?[]:r,o=i.filter((function(e){return e.decodedTx.isFinal})).map((function(e){return e.decodedTx.txid})),a=yield this.getNetworkChainId(),s=yield this.getAccountAddress(),c=yield this.getJsonRPCClient(),u=[],l=[],p=!1;try{var h=yield Y.a({chainId:a,address:s,contract:n});p=!0,u=(l=h.data.items).map((function(e){return e.tx_hash}))}catch(g){u=i.filter((function(e){return!!e.isLocalCreated})).map((function(e){return e.decodedTx.txid}))}var y=(u=(u=d()(u,o)).filter(Boolean)).map((function(e){return["eth_getTransactionByHash",[e]]})),v=[];if(y.length)try{v=yield c.rpc.batchCall(y)}catch(g){}var m=yield Object(X.k)(s,this.networkId);return(yield Promise.all(u.map(function(){var e=A()((function*(e,r){var o,a,d,c,u=v.find((function(t){return(null==t?void 0:t.hash)===e})),h=Boolean(u);u&&h&&u.input&&!u.data&&(u.data=u.input);var y,x=i.find((function(t){return t.decodedTx.txid===e}));if(null!=x&&null!=(o=x.decodedTx)&&o.isFinal)return null;(u=u||(null==x||null==(a=x.decodedTx)?void 0:a.encodedTx))&&(f()(u.nonce)&&(u.nonce=null!=(y=new _.a(u.nonce).toNumber())?y:0));var T=l.find((function(t){return t.tx_hash===e}));T&&(T=yield Y.d({covalentTx:T,address:s,vault:t,encodedTx:u}));var w=null==(d=T)?void 0:d.parsedDecodedTx;if(w=null==(c=T)?void 0:c.parsedDecodedTx,u)try{w=yield t.decodeTx(u,null)}catch(g){}if(!w)return null;var b=m[e];return(w=yield t.mergeDecodedTx({decodedTx:w,encodedTx:u,historyTx:x,covalentTx:T,nftTxs:b,isCovalentApiAvailable:p})).tokenIdOnNetwork=n,t.buildHistoryTx({decodedTx:w,encodedTx:u,historyTxToMerge:x})}));return function(t,n){return e.apply(this,arguments)}}()))).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var e=A()((function*(e){try{var t=e.decodedTx,n=t.encodedTx;if(!n)return!1;var r=n.from.toLowerCase(),i=n.to.toLowerCase(),o=(yield this.getAccountAddress()).toLocaleLowerCase();if(r===o||i===o)return!1;for(var a=t.outputActions||t.actions,s=0;s<a.length;s+=1){var d,c,u,l,f=a[s];if(f.type!==ne.a.TOKEN_TRANSFER)return!1;if(f.type===ne.a.TOKEN_TRANSFER&&null!=(d=f.tokenTransfer)&&d.amount&&!new _.a(null==(c=f.tokenTransfer)?void 0:c.amount).isZero())return!1;if(f.type===ne.a.TOKEN_TRANSFER&&null!=(u=f.tokenTransfer)&&u.amount&&new _.a(null==(l=f.tokenTransfer)?void 0:l.amount).isZero()&&[f.tokenTransfer.from.toLocaleLowerCase(),f.tokenTransfer.to.toLocaleLowerCase()].includes(r))return!1}return!0}catch(p){return!1}}));return function(t){return e.apply(this,arguments)}}(),r.fixAddressCase=function(e){return Promise.resolve(a()(e||""))},r.getAccountNameInfoMap=function(){var e=A()((function*(){var e=yield this.getNetwork(),t=Object(Z.a)(e.impl);return e.id!==H.a.etc&&(t=i()(t,"etcNative")),t}));return function(){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=A()((function*(e){var t=e.accounts;return e.networkId!==H.a.etc?t.filter((function(e){return e.coinType!==W.m})):Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(e){var t=e.previousNetwork,n=e.newNetwork,r=e.activeAccountId,i=(null==t?void 0:t.id)===H.a.etc,o=(null==n?void 0:n.id)===H.a.etc,a=(null==n?void 0:n.impl)===W.I&&!o,s=(null==t?void 0:t.impl)===W.I&&!i,d=null==r?void 0:r.indexOf("m/44'/61'/0'/"),c=i&&a&&!!d;return Promise.resolve({shouldChangeActiveAccount:c,shouldReloadAccountList:!c&&(o&&s)})},r.canAutoCreateNextAccount=function(){var e=A()((function*(e){return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),O()(n)}(ie.a)}}]);